---
title: 生成客户端
description: 使用 Codama CLI 为 Solana 程序生成客户端的完整指南。
---

[Codama](https://github.com/codama-idl/codama)
从程序的 IDL 文件生成 TypeScript 和 Rust 客户端。生成的客户端包括调用指令和获取账户的函数，省去了手动序列化和反序列化程序账户或指令数据的需求。

<Callout type="warn">
  Codama
  正在积极开发中，可能会发生变化。请参考快速参考中的链接仓库以获取最新信息。
</Callout>

## 快速参考

### CLI 命令

| Command       | Description                |
| ------------- | -------------------------- |
| `codama init` | 生成 codama 配置文件       |
| `codama run`  | 根据配置文件生成程序客户端 |

### 客户端生成器

| Package                                                                                                  | Description                                                                    |
| -------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| [`@codama/renderers-js`](https://github.com/codama-idl/renderers-js)                                     | 生成 [`@solana/kit`](https://www.solanakit.com) 兼容的 TypeScript 客户端       |
| [`@codama/renderers-rust`](https://github.com/codama-idl/renderers-rust)                                 | 生成 [`solana_sdk`](https://github.com/anza-xyz/solana-sdk) 兼容的 Rust 客户端 |
| [`@codama/nodes-from-anchor`](https://github.com/codama-idl/codama/tree/main/packages/nodes-from-anchor) | 将 Anchor IDL 转换为 Codama IDL 以生成客户端                                   |

### 其他资源

| 资源                                                                                                       | 描述                                                                |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| [Codama](https://github.com/codama-idl/codama)                                                             | Codama GitHub                                                       |
| [Codama CLI](https://github.com/codama-idl/codama/blob/main/packages/cli/README.md)                        | Codama CLI GitHub                                                   |
| [Codama Macros](https://github.com/codama-idl/codama-rs)                                                   | Codama Macros GitHub。使用 Codama 宏从原生 Rust 程序生成 Codama IDL |
| [Codama Macros Example Program](https://github.com/lorisleiva/codama-demo-2025-08/tree/main/3-from-macros) | 展示 Codama 宏用法的示例程序                                        |

## 示例

此示例演示了从 [Anchor 程序 IDL](https://www.anchor-lang.com/docs/basics/idl)
生成客户端的过程。

<ScrollyCoding>

## !!steps 设置项目文件

请跟随操作，新建一个名为 `example` 的目录，并添加 `idl.json` 文件和代码片段中的
`package.json` 文件。

<Callout type="info">

此示例使用了一个计数器程序 IDL。
[查看源码](https://github.com/solana-developers/anchor-web3js-nextjs/blob/main/program/programs/counter/src/lib.rs)。

在 Anchor 项目中，IDL 位于 `target/idl/<program_name>.json`，运行 `anchor build`
后生成。

</Callout>

```json !! title="example/idl.json"
{
  "address": "8PY1q5J3Aq2z7TBDLBrVjv77mYzjXSCz6iHQaFEFw9hY",
  "metadata": {
    "name": "counter",
    "version": "0.1.0",
    "spec": "0.1.0",
    "description": "Created with Anchor"
  },
  "instructions": [
    {
      "name": "decrement",
      "discriminator": [106, 227, 168, 59, 248, 27, 150, 101],
      "accounts": [
        {
          "name": "user",
          "writable": true,
          "signer": true
        },
        {
          "name": "counter",
          "writable": true,
          "pda": {
            "seeds": [
              {
                "kind": "const",
                "value": [99, 111, 117, 110, 116, 101, 114]
              }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              {
                "kind": "const",
                "value": [118, 97, 117, 108, 116]
              },
              {
                "kind": "account",
                "path": "user"
              }
            ]
          }
        },
        {
          "name": "system_program",
          "address": "11111111111111111111111111111111"
        }
      ],
      "args": []
    },
    {
      "name": "increment",
      "discriminator": [11, 18, 104, 9, 104, 174, 59, 33],
      "accounts": [
        {
          "name": "user",
          "writable": true,
          "signer": true
        },
        {
          "name": "counter",
          "writable": true,
          "pda": {
            "seeds": [
              {
                "kind": "const",
                "value": [99, 111, 117, 110, 116, 101, 114]
              }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              {
                "kind": "const",
                "value": [118, 97, 117, 108, 116]
              },
              {
                "kind": "account",
                "path": "user"
              }
            ]
          }
        },
        {
          "name": "system_program",
          "address": "11111111111111111111111111111111"
        }
      ],
      "args": []
    }
  ],
  "accounts": [
    {
      "name": "Counter",
      "discriminator": [255, 176, 4, 245, 188, 253, 124, 25]
    }
  ],
  "errors": [
    {
      "code": 6000,
      "name": "UnderflowError",
      "msg": "Counter cannot be decremented below zero"
    }
  ],
  "types": [
    {
      "name": "Counter",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "count",
            "type": "u64"
          }
        ]
      }
    }
  ]
}
```

```json !! title="example/package.json"
{
  "name": "example",
  "version": "1.0.0",
  "type": "module",
  "devDependencies": {
    "@types/node": "^24.10.0",
    "tsx": "^4.20.6",
    "typescript": "^5.9.3"
  }
}
```

## !!steps 创建 Codama 配置文件

Codama 使用配置文件来指定 IDL 文件的位置、要生成的客户端语言以及生成代码的输出位置。通过运行以下命令创建此配置：

```terminal
$ npx codama init
```

这会引导你回答一些问题，在项目根目录下创建 `codama.json`
文件，并安装所需的 Codama 依赖。

```shell title="example output"
Welcome to Codama!
✔ Where is your IDL located? (Supports Codama and Anchor IDLs). … idl.json
✔ Which script preset would you like to use? › Generate JavaScript client, Generate Rust client
✔ [js] Where should the JavaScript code be generated? … clients/js/src/generated
✔ [rust] Where is the Rust client crate located? … clients/rust
✔ [rust] Where should the Rust code be generated? … clients/rust/src/generated
▲ Your configuration requires additional dependencies.
▲ Install command: pnpm install @codama/nodes-from-anchor @codama/renderers-js @codama/renderers-rust
✔ Install dependencies? … yes
→ Installing
  ├─ @codama/nodes-from-anchor
  ├─ @codama/renderers-js
  └─ @codama/renderers-rust
✔ Dependencies installed successfully.

✔ Configuration file created.
  └─ Path: /example/codama.json
```

```json !! title="example/codama.json"
{
  "idl": "idl.json",
  "before": [],
  "scripts": {
    "js": {
      "from": "@codama/renderers-js",
      "args": ["clients/js/src/generated"]
    },
    "rust": {
      "from": "@codama/renderers-rust",
      "args": [
        "clients/rust/src/generated",
        {
          "crateFolder": "clients/rust",
          "formatCode": true
        }
      ]
    }
  }
}
```

```json !! title="example/package.json"
{
  "name": "example",
  "version": "1.0.0",
  "type": "module",
  "devDependencies": {
    "@types/node": "^24.10.0",
    "tsx": "^4.20.6",
    "typescript": "^5.9.3"
  },
  "dependencies": {
    "@codama/nodes-from-anchor": "^1.2.9",
    "@codama/renderers-js": "^1.4.3",
    "@codama/renderers-rust": "^1.2.7"
  }
}
```

## !!steps 生成客户端

配置文件创建完成后，运行生成命令以生成客户端：

```terminal
$ npx codama run --all
```

<WithMentions>

这将在 codama 配置文件中指定的 [文件路径](mention:path) 中生成程序客户端。

```json title="codama.json"
{
  "idl": "idl.json",
  "before": [],
  "scripts": {
    "js": {
      "from": "@codama/renderers-js",
      // !mark
      // !mention path
      "args": ["clients/js/src/generated"]
    },
    "rust": {
      "from": "@codama/renderers-rust",
      "args": [
        // !mark
        // !mention path
        "clients/rust/src/generated",
        {
          "crateFolder": "clients/rust",
          "formatCode": true
        }
      ]
    }
  }
}
```

</WithMentions>

<Callout type="info">并非所有生成的文件都显示在相应的代码片段中。</Callout>

```ts !! title="example/clients/js/src/generated/index.ts"
/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

export * from "./accounts";
export * from "./errors";
export * from "./instructions";
export * from "./programs";
```

```rs !! title="example/clients/rust/src/generated/mod.rs"
//! This code was AUTOGENERATED using the codama library.
//! Please DO NOT EDIT THIS FILE, instead use visitors
//! to add features, then rerun codama to update it.
//!
//! <https://github.com/codama-idl/codama>
//!

pub mod accounts;
pub mod errors;
pub mod instructions;
pub mod programs;
pub mod shared;

pub(crate) use programs::*;
```

</ScrollyCoding>

## 使用生成的客户端

生成的客户端包含与您的程序交互的源代码，但不包括
`package.json`（用于 TypeScript）或 `Cargo.toml`（用于 Rust）文件。

您需要新建 `package.json` 和 `Cargo.toml`
文件，或将生成客户端所需的依赖添加到项目现有文件中。

### 集成到您的应用程序中

直接将客户端生成到应用的源码目录中，然后将所需依赖添加到现有的 `package.json` 或
`Cargo.toml` 文件中。

在构建客户端代码不需要共享或发布的应用程序时使用此方法。

### 独立的包或 Crates

为每个客户端分别创建 TypeScript 包或 Rust crate。例如，在 `clients/js/` 中添加
`package.json`，在 `clients/rust/` 中添加 `Cargo.toml`。

使用此方法将客户端作为可重用的库（npm 或 crates.io）发布，或在单一代码库中跨多个应用程序共享客户端。
