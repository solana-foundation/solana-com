---
title: أذونات الإنفاق
description: تفويض إنفاق الرموز لأطراف ثالثة للمدفوعات الآلية والمضمونة
---

تدعم برامج الرموز في سولانا **التفويض**—منح حساب آخر إذنًا لتحويل الرموز من حساب
الرموز الخاص بك حتى حد معين. يتيح ذلك حالات استخدام مثل المدفوعات الآلية وخدمات
الضمان ومعالجة المدفوعات من طرف ثالث دون التخلي عن حيازة أموالك.

## كيف يعمل التفويض

عندما توافق على مفوض، فإنك تمنح حسابًا معينًا صلاحية تحويل الرموز نيابة عنك:

- **يحتفظ المالك بالحيازة**: لا تزال تمتلك الرموز ويمكنك التحويل أو الإلغاء في
  أي وقت
- **إنفاق محدود**: يمكن للمفوض فقط تحويل ما يصل إلى المبلغ المعتمد
- **مفوض واحد لكل حساب**: يمكن أن يكون لكل حساب رموز مفوض نشط واحد فقط
- **الموافقة الجديدة تحل محل القديمة**: الموافقة على مفوض جديد تلغي تلقائيًا
  المفوض السابق

<Callout type="info">
  التفويض غير احتجازي. يمكن للمفوض إنفاق الرموز حتى الحد المسموح، لكن لا يمكنه
  الوصول إلى الحساب أو استنزافه بما يتجاوز المبلغ المعتمد. يمكن للمالك الإلغاء
  في أي وقت.
</Callout>

## حالات الاستخدام التجارية

| حالة الاستخدام          | كيف يساعد التفويض                                                      |
| ----------------------- | ---------------------------------------------------------------------- |
| **معالجات الدفع**       | يمنح التاجر المعالج إذنًا لتسوية المعاملات                             |
| **كشوف الرواتب الآلية** | تعتمد الخزانة خدمة كشوف الرواتب لصرف الرواتب                           |
| **خدمات الضمان**        | يفوض المشتري وكيل الضمان للإفراج المشروط                               |
| **منصات التداول**       | يوافق المستخدم على تنفيذ البورصة للصفقات نيابة عنه                     |
| **إصدار البطاقات**      | يوافق المستخدم على مصدر البطاقة لخصم المشتريات من حساب الرموز الخاص به |

## الموافقة على مفوض

منح حساب آخر إذنًا لإنفاق الرموز من حسابك:

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
import { getApproveCheckedInstruction } from "@solana-program/token";

// Approve delegate to spend up to 1,000 USDC (6 decimals)
const approveInstruction = getApproveCheckedInstruction({
  source: tokenAccountAddress, // Your token account
  mint: usdcMintAddress, // USDC mint
  delegate: delegateAddress, // Account receiving permission
  owner: ownerKeypair, // You (must sign)
  amount: 1_000_000_000n, // 1,000 USDC in base units
  decimals: 6
});
```

```bash !! title="CLI"
spl-token approve <TOKEN_ACCOUNT> <AMOUNT> <DELEGATE_ADDRESS>
# Example: Approve 1000 USDC to a delegate
spl-token approve 7v45Foih... 1000 DeLe9ate...
```

</CodeTabs>

**المعاملات:**

- `source`: حساب الرمز الذي يمنح الإذن
- `delegate`: الحساب الذي سيحصل على إذن الإنفاق
- `owner`: المالك الحالي لحساب الرمز (يجب أن يوقع المعاملة)
- `amount`: الحد الأقصى من الرموز التي يمكن للمفوض تحويلها
- `decimals`: الكسور العشرية للرمز للتحقق (يمنع أخطاء الكسور العشرية)

## إلغاء تفويض المفوض

إزالة جميع أذونات الإنفاق من المفوض الحالي:

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
import { getRevokeInstruction } from "@solana-program/token";

const revokeInstruction = getRevokeInstruction({
  source: tokenAccountAddress, // Your token account
  owner: ownerKeypair // You (must sign)
});
```

```bash !! title="CLI"
spl-token revoke <TOKEN_ACCOUNT>
```

</CodeTabs>

<Callout type="caution">
  يزيل الإلغاء **جميع** أذونات المفوض—لا يوجد إلغاء جزئي. إذا كنت بحاجة إلى
  تقليل الحد، وافق على نفس المفوض بمبلغ أقل.
</Callout>

## التحقق من حالة التفويض

الاستعلام عن حساب رمز لمعرفة المفوض الحالي والرصيد المتبقي:

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
import { fetchToken } from "@solana-program/token";

const tokenAccount = await fetchToken(rpc, tokenAccountAddress);

if (tokenAccount.data.delegate) {
  console.log("Delegate:", tokenAccount.data.delegate);
  console.log("Remaining allowance:", tokenAccount.data.delegatedAmount);
} else {
  console.log("No delegate set");
}
```

```bash !! title="CLI"
spl-token display <TOKEN_ACCOUNT>
# Look for "Delegate" and "Delegated Amount" fields
```

</CodeTabs>

## التحويل كمفوض

عند العمل كمفوض، استخدم تحويلاً قياسيًا ولكن وقع باستخدام keypair المفوض بدلاً
من المالك:

```ts title="Transfer as Delegate"
import { getTransferCheckedInstruction } from "@solana-program/token";

const transferInstruction = getTransferCheckedInstruction({
  source: ownerTokenAccount, // The account you have permission to spend from
  mint: usdcMintAddress,
  destination: recipientTokenAccount,
  authority: delegateKeypair, // You (the delegate) sign, not the owner
  amount: 100_000_000n, // 100 USDC
  decimals: 6
});
```

سينجح التحويل إذا:

- كان لدى الحساب المصدر رصيد كافٍ
- وقع المفوض على المعاملة

كل عملية تحويل تقلل من الرصيد المتبقي المسموح به. عندما يصل الرصيد المسموح به
إلى الصفر، لن يتمكن المفوض من تحويل الرموز بعد الآن.

## اعتبارات الأمان

**لأصحاب الحسابات:**

- وافق فقط على المفوضين الموثوقين
- حدد الحد الأدنى الضروري لحد الإنفاق
- ألغِ التفويضات عندما لا تعود هناك حاجة إليها
- راقب حساباتك بحثًا عن عمليات تحويل غير متوقعة

**لمقدمي الخدمات (المفوضين):**

- وضح بشكل واضح حد الإنفاق المطلوب للمستخدمين
- نفذ إدارة مفاتيح مناسبة لحساب المفوض الخاص بك
- تتبع استهلاك الرصيد المسموح به لطلب إعادة الموافقة قبل نفاد الحدود

## التفويض مقابل الحفظ

| الجانب            | التفويض               | الحفظ الكامل                  |
| ----------------- | --------------------- | ----------------------------- |
| ملكية الرموز      | يحتفظ بها المستخدم    | ينقلها المستخدم إلى الحافظ    |
| التحكم في الإنفاق | محدود بالمبلغ المعتمد | وصول كامل إلى الأموال المحولة |
| الإلغاء           | فوري، من قبل المالك   | يتطلب تعاون الحافظ            |
| التعرض للمخاطر    | محدود بالمبلغ المعتمد | الرصيد بالكامل                |
| الثقة المطلوبة    | محدودة                | عالية                         |

يوفر التفويض حلاً وسطًا—يتيح المدفوعات الآلية مع الحد من التعرض للمخاطر بالمبلغ
المعتمد.

## موارد ذات صلة

- [الموافقة على المفوض](/docs/tokens/basics/approve-delegate) — تفاصيل تقنية حول
  تعليمة الموافقة
