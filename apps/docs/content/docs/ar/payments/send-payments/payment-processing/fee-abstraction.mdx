---
title: تجريد الرسوم
description: تعرف على كيفية عمل رعاية الرسوم وتنفيذ تجريد الرسوم باستخدام Kora.
---

تتطلب كل معاملة على سولانا عملة SOL لدفع رسوم الشبكة. لكن المستخدمين القادمين
إلى تطبيق الدفع الخاص بك يتوقعون التعامل بالعملات المستقرة - وليس إدارة رصيد رمز
ثانٍ. يزيل تجريد الرسوم هذا الاحتكاك من خلال قيام شخص آخر بدفع الرسوم.

يغطي هذا الدليل مستويين:

1. **كيفية عمل رعاية الرسوم** — البنية الأساسية لسولانا
2. **تجريد الرسوم على نطاق واسع باستخدام Kora** — خدمة تجريد رسوم جاهزة للإنتاج

## كيفية عمل رعاية الرسوم

تحتوي معاملات سولانا على دافع رسوم محدد - الحساب الذي يدفع رسوم الشبكة.
افتراضيًا، هذا هو الموقّع الأول. لكن يمكنك تحديد حساب مختلف كدافع للرسوم، مما
يسمح لطرف ثالث ("الراعي") بتغطية الرسوم نيابة عن المرسل.

يجب على كل من المرسل والراعي التوقيع على المعاملة:

- يوقع **المرسل** للترخيص بنقل رموزه
- يوقع **الراعي** للترخيص بدفع رسوم الشبكة

<Callout>
  راجع [كيفية عمل المدفوعات على سولانا](/docs/payments/how-payments-work)
  لمفاهيم الدفع الأساسية.
</Callout>

توضح الخطوات أدناه التدفق الأساسي. راجع [العرض التوضيحي](#demo) للحصول على كود
كامل قابل للتشغيل.

<ScrollyCoding>

## !!steps إنشاء حساب راعٍ

قم بإنشاء زوج مفاتيح منفصل للراعي الذي سيدفع رسوم المعاملات. يحتاج الراعي إلى
SOL للرسوم لكنه لا يحتاج إلى الاحتفاظ بالرموز التي يتم نقلها.

<CodePlaceholder title="رعاية رسوم المعاملة" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;
```

## !!steps إنشاء تعليمات النقل

قم بإنشاء تعليمات نقل الرمز مع المرسل كسلطة. يمتلك المرسل الرموز ويجب عليه
التوقيع على النقل.

<CodePlaceholder title="رسوم المعاملة الممولة" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

// !focus(1:6)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Sender signs for the transfer
  amount: 250_000n // adjusted for the mint's decimals
});
```

## !!steps الإرسال مع الممول كدافع للرسوم

استخدم `prepareAndSend` مع كل من `authority` (المرسل الذي يوقع على التحويل) و
`feePayer` (الممول الذي يدفع الرسوم). يجب على كليهما التوقيع على المعاملة.

<CodePlaceholder title="رسوم المعاملة الممولة" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender,
  amount: 250_000n
});

// !focus(1:6)
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Signs the transfer instruction
  // !mark
  feePayer: sponsor, // Pays the transaction fees
  instructions: [transferInstruction],
  version: 0
});
```

</ScrollyCoding>

### عرض توضيحي

<CodeTabs flags="r">

```ts !! title="Demo"
// !collapse(1:14) collapsed
// Click ">" icon on left to expand demo imports
import { createClient, lamports } from "@solana/client";
import { generateKeypair } from "@solana/client/server";
import type { ServerKeypair } from "@solana/client/server";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_2022_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token-2022";

// Generate keypairs for sender, recipient, and sponsor (fee payer)
const sender = (await generateKeypair()).signer;
const recipient = (await generateKeypair()).signer;
// !mark
const sponsor = (await generateKeypair()).signer;

console.log("Sender Address:", sender.address);
console.log("Recipient Address:", recipient.address);
console.log("Sponsor Address (Fee Payer):", sponsor.address);

// Demo Setup: Create client, mint account, token accounts, and fund with initial tokens
const { client, mint } = await demoSetup(sender, recipient, sponsor);

console.log("\nMint Address:", mint.address);

// Derive the Associated Token Accounts addresses (ATAs) for sender and recipient
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipientAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient Token Account:", recipientAta.toString());

// =============================================================================
// Sponsored Token Payment Demo
// =============================================================================

// Create instruction to transfer tokens from sender to recipient
// Transferring 250,000 base units = 0.25 tokens (with 6 decimals)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Pass signer, not just address
  amount: 250_000n // 0.25 tokens
});

// Prepare and send transaction with sponsor as fee payer using @solana/client
// The sponsor pays transaction fees, sender signs for the transfer
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Sender signs the transfer instruction
  // !mark
  feePayer: sponsor, // Sponsor pays the transaction fees (different account)
  instructions: [transferInstruction],
  version: 0
});

console.log("\n=== Sponsored Token Payment Complete ===");
console.log("Transaction Signature:", signature.toString());

// Fetch final token account balances using @solana/client SPL token helper
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipientBalance = await splToken.fetchBalance(recipient.address);

console.log("\nSender Token Account Balance:", senderBalance);
console.log("Recipient Token Account Balance:", recipientBalance);

// Fetch transaction details
const transaction = await client.runtime.rpc
  .getTransaction(signature, {
    encoding: "jsonParsed",
    maxSupportedTransactionVersion: 0
  })
  .send();

const feePayer = transaction?.transaction.message.accountKeys?.[0];
console.log("\nNote: The first account in accountKeys is always the fee payer");
console.log("Fee Payer Address:", feePayer);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
// !collapse(1:1000) collapsed

/**
 * Sets up for a sponsored token transfer demo:
 * - Creates @solana/client instance
 * - Airdrops SOL to sponsor for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and recipient
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair (will be funded and used as mint authority)
 * @param recipient - The recipient's keypair
 * @param sponsor - The sponsor's keypair (will pay all transaction fees)
 * @returns Returns client instance and mint address
 */
async function demoSetup(
  sender: ServerKeypair["signer"],
  recipient: ServerKeypair["signer"],
  sponsor: ServerKeypair["signer"]
) {
  // Create @solana/client instance pointing to local validator
  const client = createClient({
    endpoint: "http://localhost:8899",
    websocketEndpoint: "ws://localhost:8900",
    commitment: "confirmed",
    logger: () => {} // Disable all logs
  });

  // Fund sponsor with SOL for transaction fees using @solana/client actions
  await client.actions.requestAirdrop(
    sponsor.address,
    lamports(1_000_000_000n)
  );

  // Generate keypair to use as address of mint
  const mint = (await generateKeypair()).signer;

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await client.runtime.rpc
    .getMinimumBalanceForRentExemption(space)
    .send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program (sponsor pays the rent)
  const createAccountInstruction = getCreateAccountInstruction({
    payer: sponsor,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token 2022 program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 6,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA (sponsor pays)
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient's ATA (sponsor pays)
  const createRecipientAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: recipient.address
    });

  // Create instruction to mint initial tokens to sender
  // Sender is the mint authority and must sign
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender, // Pass signer, not just address
    amount: 1_000_000n // Mint 1.00 tokens (1,000,000 base units with 6 decimals)
  });

  // Combine all instructions and send using @solana/client transaction helper
  const setupInstructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipientAtaInstruction, // Create recipient's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Prepare and send transaction using @solana/client with sponsor as fee payer
  await client.transaction.prepareAndSend({
    authority: sender,
    feePayer: sponsor, // Sponsor pays all transaction fees
    instructions: setupInstructions,
    version: 0
  });

  return {
    client,
    mint
  };
}
```

</CodeTabs>

<Callout type="caution">
  عندما تنشئ حساب رمز لمستخدم نهائي، يمكنه إغلاقه واستعادة SOL المستخدم للإيجار.
  فكر في فرض رسوم على المستخدمين مقابل إنشاء الحساب بالعملات المستقرة، أو ضع هذه
  التكلفة في الاعتبار ضمن اقتصاديات منتجك.
</Callout>

## تجريد الرسوم على نطاق واسع مع Kora

بدائية دافع الرسوم قوية، لكن بناء نظام بدون رسوم للإنتاج يتطلب المزيد: إدارة
محافظ الممولين، والتعامل مع تحويلات الرموز (حتى يتمكن المستخدمون من "دفع" الرسوم
بـ USDC)، وتحديد المعدل، وضوابط الأمان.

[Kora](https://launch.solana.com/products/kora) يتعامل مع هذا التعقيد. إنه خادم
JSON-RPC يوفر تجريد الرسوم بحيث لا يحتاج المستخدمون أبدًا إلى SOL. يمكنك تمويل
الرسوم بالكامل أو قبول دفع الرسوم بأي رمز.

انشر Kora بأمر واحد:

```bash
cargo install kora-cli
kora --config path/to/kora.toml rpc start --signers-config path/to/signers.toml
```

ثم استخدم عميل Kora للتوقيع وإرسال المعاملات:

```bash
pnpm add @solana/kora
```

```typescript
import { KoraClient } from "@solana/kora";

const kora = new KoraClient({ rpcUrl: "https://your-kora-instance" });

const { signature } = await kora.signAndSendTransaction({
  transaction: base64EncodedTransaction
});
```

### موارد Kora

<Cards>
  <Card
    title="البدء السريع مع Kora"
    href="https://launch.solana.com/docs/kora/getting-started/quick-start"
  >
    شغّل Kora محليًا في دقائق.
  </Card>
  <Card
    title="عرض توضيحي كامل للمعاملة"
    href="https://launch.solana.com/docs/kora/guides/full-demo"
  >
    دليل تنفيذ كامل لمعاملة تجريد الرسوم.
  </Card>
  <Card
    title="مرجع API"
    href="https://launch.solana.com/docs/kora/json-rpc-api"
  >
    طرق JSON-RPC وتوثيق SDK.
  </Card>
  <Card
    title="دليل مشغل العقدة"
    href="https://launch.solana.com/docs/kora/operators"
  >
    انشر وقم بتكوين نسختك الخاصة من Kora.
  </Card>
</Cards>
