---
title: Abstraksi biaya
description:
  Pelajari cara kerja sponsorship biaya dan implementasikan abstraksi biaya
  dengan Kora.
---

Setiap transaksi Solana memerlukan SOL untuk membayar biaya jaringan. Namun
pengguna yang datang ke aplikasi pembayaran Anda mengharapkan untuk bertransaksi
dalam stablecoin—bukan mengelola saldo token kedua. Abstraksi biaya
menghilangkan hambatan ini dengan meminta orang lain membayar biayanya.

Panduan ini mencakup dua tingkat:

1. **Cara kerja sponsorship biaya** — primitif Solana yang mendasarinya
2. **Abstraksi biaya dalam skala besar dengan Kora** — layanan abstraksi biaya
   yang siap produksi

## Cara kerja sponsorship biaya

Transaksi Solana memiliki pembayar biaya yang ditentukan—akun yang membayar
biaya jaringan. Secara default, ini adalah penandatangan pertama. Namun Anda
dapat menentukan akun yang berbeda sebagai pembayar biaya, memungkinkan pihak
ketiga ("sponsor") untuk menanggung biaya atas nama pengirim.

Baik pengirim maupun sponsor harus menandatangani transaksi:

- **Pengirim** menandatangani untuk mengotorisasi transfer token mereka
- **Sponsor** menandatangani untuk mengotorisasi pembayaran biaya jaringan

<Callout>
  Lihat [Cara kerja pembayaran di Solana](/docs/payments/how-payments-work)
  untuk konsep pembayaran inti.
</Callout>

Langkah-langkah di bawah ini menunjukkan alur inti. Lihat [Demo](#demo) untuk
kode lengkap yang dapat dijalankan.

<ScrollyCoding>

## !!steps Buat akun sponsor

Buat keypair terpisah untuk sponsor yang akan membayar biaya transaksi. Sponsor
memerlukan SOL untuk biaya tetapi tidak perlu memegang token yang sedang
ditransfer.

<CodePlaceholder title="Biaya transaksi sponsor" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;
```

## !!steps Buat instruksi transfer

Buat instruksi transfer token dengan pengirim sebagai otoritas. Pengirim
memiliki token dan harus menandatangani transfer.

<CodePlaceholder title="Biaya transaksi sponsor" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

// !focus(1:6)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Sender signs for the transfer
  amount: 250_000n // adjusted for the mint's decimals
});
```

## !!steps Kirim dengan sponsor sebagai pembayar biaya

Gunakan `prepareAndSend` dengan `authority` (pengirim yang menandatangani
transfer) dan `feePayer` (sponsor yang membayar biaya). Keduanya harus
menandatangani transaksi.

<CodePlaceholder title="Biaya transaksi sponsor" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender,
  amount: 250_000n
});

// !focus(1:6)
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Signs the transfer instruction
  // !mark
  feePayer: sponsor, // Pays the transaction fees
  instructions: [transferInstruction],
  version: 0
});
```

</ScrollyCoding>

### Demo

<CodeTabs flags="r">

```ts !! title="Demo"
// !collapse(1:14) collapsed
// Click ">" icon on left to expand demo imports
import { createClient, lamports } from "@solana/client";
import { generateKeypair } from "@solana/client/server";
import type { ServerKeypair } from "@solana/client/server";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_2022_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token-2022";

// Generate keypairs for sender, recipient, and sponsor (fee payer)
const sender = (await generateKeypair()).signer;
const recipient = (await generateKeypair()).signer;
// !mark
const sponsor = (await generateKeypair()).signer;

console.log("Sender Address:", sender.address);
console.log("Recipient Address:", recipient.address);
console.log("Sponsor Address (Fee Payer):", sponsor.address);

// Demo Setup: Create client, mint account, token accounts, and fund with initial tokens
const { client, mint } = await demoSetup(sender, recipient, sponsor);

console.log("\nMint Address:", mint.address);

// Derive the Associated Token Accounts addresses (ATAs) for sender and recipient
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipientAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient Token Account:", recipientAta.toString());

// =============================================================================
// Sponsored Token Payment Demo
// =============================================================================

// Create instruction to transfer tokens from sender to recipient
// Transferring 250,000 base units = 0.25 tokens (with 6 decimals)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Pass signer, not just address
  amount: 250_000n // 0.25 tokens
});

// Prepare and send transaction with sponsor as fee payer using @solana/client
// The sponsor pays transaction fees, sender signs for the transfer
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Sender signs the transfer instruction
  // !mark
  feePayer: sponsor, // Sponsor pays the transaction fees (different account)
  instructions: [transferInstruction],
  version: 0
});

console.log("\n=== Sponsored Token Payment Complete ===");
console.log("Transaction Signature:", signature.toString());

// Fetch final token account balances using @solana/client SPL token helper
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipientBalance = await splToken.fetchBalance(recipient.address);

console.log("\nSender Token Account Balance:", senderBalance);
console.log("Recipient Token Account Balance:", recipientBalance);

// Fetch transaction details
const transaction = await client.runtime.rpc
  .getTransaction(signature, {
    encoding: "jsonParsed",
    maxSupportedTransactionVersion: 0
  })
  .send();

const feePayer = transaction?.transaction.message.accountKeys?.[0];
console.log("\nNote: The first account in accountKeys is always the fee payer");
console.log("Fee Payer Address:", feePayer);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
// !collapse(1:1000) collapsed

/**
 * Sets up for a sponsored token transfer demo:
 * - Creates @solana/client instance
 * - Airdrops SOL to sponsor for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and recipient
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair (will be funded and used as mint authority)
 * @param recipient - The recipient's keypair
 * @param sponsor - The sponsor's keypair (will pay all transaction fees)
 * @returns Returns client instance and mint address
 */
async function demoSetup(
  sender: ServerKeypair["signer"],
  recipient: ServerKeypair["signer"],
  sponsor: ServerKeypair["signer"]
) {
  // Create @solana/client instance pointing to local validator
  const client = createClient({
    endpoint: "http://localhost:8899",
    websocketEndpoint: "ws://localhost:8900",
    commitment: "confirmed",
    logger: () => {} // Disable all logs
  });

  // Fund sponsor with SOL for transaction fees using @solana/client actions
  await client.actions.requestAirdrop(
    sponsor.address,
    lamports(1_000_000_000n)
  );

  // Generate keypair to use as address of mint
  const mint = (await generateKeypair()).signer;

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await client.runtime.rpc
    .getMinimumBalanceForRentExemption(space)
    .send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program (sponsor pays the rent)
  const createAccountInstruction = getCreateAccountInstruction({
    payer: sponsor,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token 2022 program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 6,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA (sponsor pays)
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient's ATA (sponsor pays)
  const createRecipientAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: recipient.address
    });

  // Create instruction to mint initial tokens to sender
  // Sender is the mint authority and must sign
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender, // Pass signer, not just address
    amount: 1_000_000n // Mint 1.00 tokens (1,000,000 base units with 6 decimals)
  });

  // Combine all instructions and send using @solana/client transaction helper
  const setupInstructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipientAtaInstruction, // Create recipient's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Prepare and send transaction using @solana/client with sponsor as fee payer
  await client.transaction.prepareAndSend({
    authority: sender,
    feePayer: sponsor, // Sponsor pays all transaction fees
    instructions: setupInstructions,
    version: 0
  });

  return {
    client,
    mint
  };
}
```

</CodeTabs>

<Callout type="caution">
  Ketika Anda membuat token account untuk pengguna akhir, mereka dapat
  menutupnya dan mengklaim kembali SOL yang digunakan untuk rent. Pertimbangkan
  untuk menagih pengguna untuk pembuatan akun dalam stablecoin, atau masukkan
  biaya ini ke dalam ekonomi produk Anda.
</Callout>

## Abstraksi biaya dalam skala besar dengan Kora

Primitif pembayar biaya sangat powerful, tetapi membangun sistem gasless
produksi memerlukan lebih banyak: mengelola dompet sponsor, menangani konversi
token (sehingga pengguna dapat "membayar" biaya dalam USDC), pembatasan rate,
dan kontrol keamanan.

[Kora](https://launch.solana.com/products/kora) menangani kompleksitas ini. Ini
adalah server JSON-RPC yang menyediakan abstraksi biaya sehingga pengguna tidak
pernah memerlukan SOL. Anda dapat sepenuhnya mensponsori biaya atau menerima
pembayaran biaya dalam token apa pun.

Deploy Kora dengan satu perintah:

```bash
cargo install kora-cli
kora --config path/to/kora.toml rpc start --signers-config path/to/signers.toml
```

Kemudian gunakan klien Kora untuk menandatangani dan mengirim transaksi:

```bash
pnpm add @solana/kora
```

```typescript
import { KoraClient } from "@solana/kora";

const kora = new KoraClient({ rpcUrl: "https://your-kora-instance" });

const { signature } = await kora.signAndSendTransaction({
  transaction: base64EncodedTransaction
});
```

### Sumber daya Kora

<Cards>
  <Card
    title="Kora quick start"
    href="https://launch.solana.com/docs/kora/getting-started/quick-start"
  >
    Jalankan Kora secara lokal dalam hitungan menit.
  </Card>
  <Card
    title="Demo transaksi lengkap"
    href="https://launch.solana.com/docs/kora/guides/full-demo"
  >
    Panduan implementasi transaksi abstraksi biaya lengkap.
  </Card>
  <Card
    title="Referensi API"
    href="https://launch.solana.com/docs/kora/json-rpc-api"
  >
    Metode JSON-RPC dan dokumentasi SDK.
  </Card>
  <Card
    title="Panduan operator node"
    href="https://launch.solana.com/docs/kora/operators"
  >
    Deploy dan konfigurasi instance Kora Anda sendiri.
  </Card>
</Cards>
