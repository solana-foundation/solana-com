---
title: Programma's implementeren
description:
  Aangepaste programma's uploaden naar de Solana blockchain met behulp van de
  Solana CLI.
---

Deze handleiding gaat ervan uit dat je kennis hebt van de volgende onderwerpen:

- [Solana accountmodel](/core/accounts)
- [Solana programma's in het algemeen](/core/programs)
- [Ontwikkelen van aangepaste Solana programma's](/programs/rust/)

| Taak                                 | Commando                                                                                      |
| ------------------------------------ | --------------------------------------------------------------------------------------------- |
| Programma bouwen                     | `cargo build-sbf`                                                                             |
| Nieuw programma deployen             | `solana program deploy <path_to_program.so>`                                                  |
| Bestaand programma updaten           | `solana program deploy <path_to_program.so>` (hetzelfde als deployen)                         |
| Programma-info tonen                 | `solana program show <program-id>`                                                            |
| Programma-autoriteit overdragen      | `solana program set-upgrade-authority <program-id> --new-upgrade-authority <path_to_keypair>` |
| Programma onveranderbaar maken       | `solana program set-upgrade-authority <program-id> --final`                                   |
| Programma sluiten                    | `solana program close <program-id> --bypass-warning`                                          |
| Wallet-saldo controleren             | `solana balance`                                                                              |
| Airdrop aanvragen (devnet/localhost) | `solana airdrop 2`                                                                            |

Er is momenteel een lopende overgang van loader-v3 (program subcommand) naar
loader-v4 (program **-v4** subcommand) omdat loader-v3 wordt uitgefaseerd.

Gebruik voor nieuwe implementaties `solana program-v4 deploy` in plaats van
`solana program deploy`.

Om een bestaand programma te migreren (wat in wezen het opnieuw implementeren
is):

```shell
solana program migrate ./target/deploy/your_program-keypair.json
```

## Voorbereiding

Eerst moet het programma worden gebouwd (gecompileerd, gelinkt, gestript).

```shell
cargo +solana build --target sbpf-solana-solana --release
```

Deze stap moet vóór elke (her)implementatie worden uitgevoerd.

Controleer of er voldoende fondsen beschikbaar zijn op het standaard
betaalaccount in verhouding tot de grootte van het uitvoerbare bestand:

```shell
du -h ./target/deploy/your_program.so
solana balance
```

Daarnaast heeft elk programma een programma-account en een programma-ID, wat het
adres is van dat programma-account. Het volgende genereert een keypair voor het
programma-account:

```shell
solana-keygen new -o ./target/deploy/your_program-keypair.json
```

```terminal
$ solana-keygen new
```

Dit maakt standaard een keypair aan op `~/.config/solana/id.json`.

```shell
cargo-build-sbf
```

## Initiële implementatie

Nu kan het uitvoerbare bestand worden geüpload naar het programma-account:

Kies naar welk Solana-cluster je wilt deployen. Gebruik het
`solana config get`-commando om je huidige configuratie te controleren:

```terminal
$ solana config get
Config File: ~/.config/solana/cli/config.yml
RPC URL: http://localhost:8899
WebSocket URL: ws://localhost:8900/ (computed)
Keypair Path: ~/.config/solana/id.json
Commitment: confirmed
```

```shell
solana program deploy ./target/deploy/your_program.so --program-id ./target/deploy/your_program-keypair.json
```

```terminal
$ solana config set --url mainnet-beta
$ solana config set --url devnet
$ solana config set --url localhost
$ solana config set --url testnet
$ solana config set --url "https://your-rpc-url.com"
```

```shell
solana program-v4 deploy ./target/deploy/your_program.so --program-keypair ./target/deploy/your_program-keypair.json
```

## Herplaatsing

Het uploaden van een andere executable naar hetzelfde program account zal het
overschrijven/vervangen. Voor herplaatsingen is echter alleen de program ID
(pubkey van het program keypair) nodig, niet het volledige keypair, omdat de
ondertekenaar de upgrade authority keypair is.

### Loader-v3

Voor devnet of localhost kun je je wallet financieren met het
`solana airdrop`-commando:

```terminal
$ solana airdrop 2
Requesting airdrop of 2 SOL
Signature: 5zQKxvRdgJDA8fRGPdKfGxRLnLpwmNnMXGYxfBqFSUPqc5BTmFPrTG8vnC4HvKDVY8zQ8aQxZxcEE7WFpGhZGVAA
2 SOL
```

Als de oude executable korter was dan de nieuwe, kan het nodig zijn om eerst het
programdata account te vergroten:

```terminal
$ solana balance
2 SOL
```

### Loader-v4

Merk op dat de initiële plaatsing `program-keypair` gebruikte, terwijl de
herplaatsing `program-id` gebruikt:

```shell
solana program-v4 deploy ./target/deploy/your_program.so --program-id ./target/deploy/your_program-keypair.json
```

## Een upload prioriteren

Om een programma te bouwen, gebruik je het `cargo build-sbf`-commando:

```terminal
$ cargo build-sbf
```

## Een upload hervatten

Het is mogelijk dat een upload vastloopt of wordt afgebroken.

### Loader-v3

Als de programma-implementatie mislukt, blijft er een tussenliggend
bufferaccount hangen dat een saldo bevat dat niet nul is. Om dit saldo terug te
krijgen, kun je een mislukte implementatie hervatten door dezelfde
tussenliggende buffer te gebruiken voor een nieuwe aanroep naar `deploy`.

```rs !! title="src/lib.rs"
use solana_program::{
    account_info::AccountInfo, entrypoint, entrypoint::ProgramResult, msg, pubkey::Pubkey,
};

entrypoint!(process_instruction);

pub fn process_instruction(
    _program_id: &Pubkey,
    _accounts: &[AccountInfo],
    _instruction_data: &[u8],
) -> ProgramResult {
    msg!("Hello, Solana!");
    Ok(())
}
```

```toml !! title="Cargo.toml"
[package]
name = "hello_world"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib", "lib"]

[dependencies]
solana-program = "2.2.0"
```

Om het keypair te herstellen:

Bouw je programma met het `cargo build-sbf`-commando:

```terminal
$ cargo build-sbf
```

Dit maakt twee belangrijke bestanden aan in `target/deploy/`:

1. `hello_world-keypair.json`: Een keypair-bestand waarvan de publieke sleutel
   wordt gebruikt als je programma-ID
2. `hello_world.so`: Het gecompileerde programma-executable

```json !! title="target/deploy/hello_world-keypair.json"
[
  203, 253, 43, 62, 165, 111, 94, 222, 105, 225, 218, 85, 143, 9, 114, 96, 243,
  181, 114, 89, 72, 230, 124, 85, 59, 165, 198, 23, 240, 212, 23, 154, 229, 241,
  153, 61, 153, 105, 79, 204, 193, 163, 33, 65, 82, 183, 49, 240, 224, 137, 248,
  24, 128, 25, 192, 197, 118, 235, 239, 67, 85, 156, 219, 231
]
```

```txt !! title="target/deploy/hello_world.so"
[binary executable file]
```

```shell
solana program deploy ./target/deploy/your_program.so --program-id ./target/deploy/your_program-keypair.json --start-offset <BYTES_UPLOADED_SO_FAR>
```

## Afronding

Dit is een **onomkeerbare** actie.

Een programma kan onveranderlijk worden gemaakt door de upgrade-autoriteit te
verwijderen.

```terminal
$ wc -c < ./target/deploy/hello_world.so
18504
```

```shell
solana program set-upgrade-authority ./target/deploy/your_program-keypair.json --final
```

```terminal
$ solana rent 18504
Rent-exempt minimum: 0.12967872 SOL
```

```shell
solana program finalize --program-id ./target/deploy/your_program-keypair.json
```

In plaats van programma's te overschrijven, is het ook mogelijk om gebruikers de
keuze te geven welke versie van een programma ze willen gebruiken door een
gekoppelde lijst van afgeronde programma's te maken:

Gebruik het `solana program deploy`-commando om je programma te deployen:

```terminal
$ solana program deploy ./target/deploy/hello_world.so
Program Id: 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
Signature: 2BYwsqRP7ZwBNQvJp3S8bphTJ4zKW5JBPVMqCTE5KyLkP8xHzAyUEeC4LdTgjJdGBKHWNCkRF8Mf1T1WkLFyEu8W
```

Voor programma's die zijn geïmplementeerd onder loader-v3 kunnen alleen hun
programdata account, de buffer accounts en de fondsen die daarin zijn
vergrendeld worden teruggevorderd. Het programma-account samen met de
programma-ID en fondsen die specifiek in het programma-account zijn vergrendeld,
zitten vast.

Programma's die zijn geïmplementeerd onder loader-v4 kunnen worden gesloten,
waardoor hun programma-account, hun programma-ID en hun vergrendelde fondsen
weer beschikbaar komen voor ander gebruik.

### Loader-v3

```terminal
$ solana program deploy ./target/deploy/hello_world.so --program-id ./custom-keypair.json
```

Je kunt nieuwe keypairs genereren met het `solana-keygen`-commando:

```terminal
$ solana-keygen new -o ./custom-keypair.json
```

```shell
solana program close ./target/deploy/your_program-keypair.json
```

Om alle buffer accounts te sluiten die gekoppeld zijn aan de huidige autoriteit:

Update je programma met hetzelfde `solana program deploy` commando:

1. Breng wijzigingen aan in je programmacode
2. Herbouw je programma: `cargo build-sbf`
3. Deploy de update:

```terminal
$ solana program deploy ./target/deploy/hello_world.so
Program Id: 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
Signature: 3zKnXDfEm1R8hVcEmTnNFYUaFjVVbLJrKdFj5hBMXoBRfz8xGyDhCYgKr9YY5KxKYPEUQQVfwEPNz9hQGvYhLNBJ
```

## Metadata inspecteren

Het `show` subcommando toont de metadata van een programma.

Een voorbeelduitvoer ziet er als volgt uit:

```terminal
$ solana program extend 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE 1000
Extended Program Id 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE by 1000 bytes
```

- `Program Id` is het adres dat kan worden gerefereerd in het `program_id` veld
  van een instructie bij het aanroepen van een programma.
- `Owner`: De loader waarmee dit programma is geïmplementeerd.
- `ProgramData Address` is de programdata account die gekoppeld is aan de
  programma-account en die de uitvoerbare code van het programma bevat (alleen
  loader-v3).
- `Status`: `retracted`, `deployed` of `finalized` (alleen loader-v4).
- `Authority` is de upgrade-autoriteit van het programma.
- `Last Deployed In Slot` is de slot waarin het programma voor het laatst is
  geïmplementeerd.
- `Data Length` is de grootte van de ruimte die is gereserveerd voor
  implementaties. De werkelijke ruimte die door het momenteel geïmplementeerde
  programma wordt gebruikt, kan minder zijn.

### Loader-v3

Om een specifiek programma te bekijken:

```shell
solana program show ./target/deploy/your_program-keypair.json
```

Om je programma-metadata te controleren, gebruik je het `solana program show`
commando:

```terminal
$ solana program show 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
```

Om alle buffer accounts te tonen, ongeacht de autoriteit:

```shell
solana program show --buffers --all
```

```txt
$ solana program show 7283x8k8fyBcfaFLyPsxbd2VV1AMmZFP7FNoyTXVKJw7
# !tooltip[/Program Id/] program-id
Program Id: 7283x8k8fyBcfaFLyPsxbd2VV1AMmZFP7FNoyTXVKJw7
# !tooltip[/Owner/] owner
Owner: BPFLoaderUpgradeab1e11111111111111111111111
# !tooltip[/ProgramData Address/] program-data-address
ProgramData Address: Gqn7YQVCP8NtYV1qkEqR4Udhj8EJ3fkikvS7HskCNQ7c
# !tooltip[/Authority/] authority
Authority: 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1
# !tooltip[/Last Deployed In Slot/] last-deployed-in-slot
Last Deployed In Slot: 6573
# !tooltip[/Data Length/] data-length
Data Length: 18504 (0x4848) bytes
# !tooltip[/Balance/] balance
Balance: 0.12999192 SOL
```

```shell
solana program show --programs --buffer-authority ~/.config/solana/authority-keypair.json
solana program show --buffers --buffer-authority ~/.config/solana/authority-keypair.json
```

### Loader-v4

Om een specifiek programma te bekijken:

```shell
solana program-v4 show --program-id ./target/deploy/your_program-keypair.json
```

Om de lijst met programma's te bekijken die zijn geïmplementeerd met de
standaardautoriteit:

```shell
solana program-v4 show --all
```

Om de lijst met programma's te bekijken die zijn geïmplementeerd met een
specifieke autoriteit:

```shell
solana program-v4 show --authority ~/.config/solana/authority-keypair.json
```

## Het uitvoerbare bestand downloaden

Soms is het nuttig om een programma te downloaden en te vergelijken om er zeker
van te zijn dat het een bekend uitvoerbaar bestand bevat. Het gedownloade
bestand kan worden ingekort, gehasht en vergeleken met de hash van het originele
programmabestand.

### Loader-v3

```shell
solana program dump ./target/deploy/your_program-keypair.json ./target/deploy/your_program.so
```

### Loader-v4

```shell
solana program download ./target/deploy/your_program.so --program-id ./target/deploy/your_program-keypair.json
```

## Geavanceerd: overdracht van autoriteit

Het recht om een bepaald programma te wijzigen ligt bij de autoriteit ervan.
Deze autoriteit kan worden overgedragen aan een andere keypair zonder het
programma keypair te wijzigen, zodat de programma-ID hetzelfde blijft. Bovendien
kan één autoriteit meerdere program accounts beheren.

Om de programma-autoriteit over te dragen naar een ander account, gebruik je het
`solana program set-upgrade-authority` commando:

```terminal
$ solana program set-upgrade-authority 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --new-upgrade-authority ./new-authority-keypair.json
```

Eerst moet er een keypair voor de autoriteit worden gegenereerd:

```shell
solana-keygen new -o ~/.config/solana/authority-keypair.json
```

Om je programma onveranderlijk te maken, gebruik je het
`solana program set-upgrade-authority` commando met de `--final` vlag om de
programma-autoriteit te verwijderen:

```terminal
$ solana program set-upgrade-authority 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --final
Account Type: Program
Authority: none
```

```shell
solana program deploy ./target/deploy/your_program.so --upgrade-authority ~/.config/solana/authority-keypair.json
```

Of na implementatie en met gebruik van de standaard keypair als huidige
autoriteit:

Om je programma te sluiten en de SOL die aan het programma-account is toegewezen
terug te vorderen, gebruik je het `solana program close` commando:

```terminal
$ solana program close 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --bypass-warning
Closed Program Id 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE, 0.12999192 SOL reclaimed
```

```shell
solana program set-upgrade-authority ./target/deploy/your_program-keypair.json --upgrade-authority ~/.config/solana/authority-keypair.json --new-upgrade-authority ~/.config/solana/new_authority-keypair.json
```

### Loader-v4

De autoriteit kan tijdens de implementatie worden gespecificeerd:

```shell
solana program-v4 deploy ./target/deploy/your_program.so --program-keypair ./target/deploy/your_program-keypair.json --authority ~/.config/solana/authority-keypair.json
```

```terminal
$ solana program show --programs
```

```shell
solana program-v4 transfer-authority --program-id ./target/deploy/your_program-keypair.json --new-authority ~/.config/solana/authority-keypair.json
```

```txt
Program Id                                       | Slot       | Authority                                      | Balance
-------------------------------------------------|------------|------------------------------------------------|-------------
7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE     | 249885434  | 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1   | 0.12999192
3KSGCk4m5hqJkTjPHBXUCPcqMwJnK3VmkqEsFUKKGJPK     | 249883212  | 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1   | 0.28654328
```

```shell
solana program-v4 transfer-authority --program-id ./target/deploy/your_program-keypair.json --authority ~/.config/solana/authority-keypair.json --new-authority ~/.config/solana/new_authority-keypair.json
```

Om een gedeployd programma te downloaden, gebruik je het `solana program dump`
commando:

```terminal
$ solana program dump 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE ./downloaded_program.so
Wrote program to ./downloaded_program.so
```

Houd er rekening mee dat het gebruik van buffer accounts ongeveer twee keer
zoveel fondsen vereist tijdens het uploadproces, omdat twee accounts
tegelijkertijd elk een uitvoerbaar bestand bevatten.

Eerst moet er een keypair voor het buffer account worden aangemaakt:

```shell
solana-keygen new -o ~/.config/solana/buffer-keypair.json
```

Het buffer account kan worden hergebruikt voor verschillende uploads en is niet
gebonden aan een specifiek program account.

```terminal
$ solana program deploy ./target/deploy/hello_world.so \
    --with-compute-unit-price 10000 \
    --max-sign-attempts 10 \
    --use-rpc
```

```shell
solana program write-buffer ./target/deploy/your_program.so --buffer ~/.config/solana/buffer-keypair.json
solana program deploy --program-id ./target/deploy/your_program-keypair.json --buffer ~/.config/solana/buffer-keypair.json
```

- **`--with-compute-unit-price`**: Stel de prioriteitsvergoeding in
  micro-lamports (0,000001 SOL) per compute-eenheid in. Controleer de
  [Helius Priority Fee API](https://docs.helius.dev/guides/priority-fee-api)
  voor actuele tarieven. Een prioriteitsvergoeding is een extra vergoeding die
  wordt betaald aan de huidige leider om je transactie te prioriteren.
- **`--max-sign-attempts`**: Aantal keren opnieuw proberen met een nieuwe
  blockhash als transacties verlopen. (Standaard: 5)
- **`--use-rpc`**: Stuur transacties naar de geconfigureerde RPC. Deze vlag
  vereist een [stake-weighted](/developers/guides/advanced/stake-weighted-qos)
  RPC-verbinding van providers zoals [Triton](https://triton.one/) of
  [Helius](https://www.helius.dev/).
