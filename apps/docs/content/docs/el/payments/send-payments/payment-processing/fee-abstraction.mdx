---
title: Αφαίρεση προμηθειών
description:
  Μάθετε πώς λειτουργεί η χορηγία προμηθειών και υλοποιήστε την αφαίρεση
  προμηθειών με το Kora.
---

Κάθε συναλλαγή στο Solana απαιτεί SOL για την πληρωμή των προμηθειών δικτύου.
Αλλά οι χρήστες που έρχονται στην εφαρμογή πληρωμών σας αναμένουν να
συναλλάσσονται σε stablecoins—όχι να διαχειρίζονται ένα δεύτερο υπόλοιπο token.
Η αφαίρεση προμηθειών εξαλείφει αυτή την τριβή επιτρέποντας σε κάποιον άλλον να
πληρώσει τις προμήθειες.

Αυτός ο οδηγός καλύπτει δύο επίπεδα:

1. **Πώς λειτουργεί η χορηγία προμηθειών** — το υποκείμενο πρωτόκολλο του Solana
2. **Αφαίρεση προμηθειών σε κλίμακα με το Kora** — μια υπηρεσία αφαίρεσης
   προμηθειών έτοιμη για παραγωγή

## Πώς λειτουργεί η χορηγία προμηθειών

Οι συναλλαγές στο Solana έχουν έναν καθορισμένο πληρωτή προμηθειών—τον
λογαριασμό που πληρώνει την προμήθεια δικτύου. Από προεπιλογή, αυτός είναι ο
πρώτος υπογράφων. Αλλά μπορείτε να ορίσετε έναν διαφορετικό λογαριασμό ως
πληρωτή προμηθειών, επιτρέποντας σε ένα τρίτο μέρος (τον "χορηγό") να καλύψει
τις προμήθειες εκ μέρους του αποστολέα.

Τόσο ο αποστολέας όσο και ο χορηγός πρέπει να υπογράψουν τη συναλλαγή:

- Ο **αποστολέας** υπογράφει για να εξουσιοδοτήσει τη μεταφορά των tokens του
- Ο **χορηγός** υπογράφει για να εξουσιοδοτήσει την πληρωμή της προμήθειας
  δικτύου

<Callout>
  Δείτε το [Πώς λειτουργούν οι πληρωμές στο
  Solana](/docs/payments/how-payments-work) για βασικές έννοιες πληρωμών.
</Callout>

Τα παρακάτω βήματα δείχνουν τη βασική ροή. Δείτε το [Demo](#demo) για πλήρη
εκτελέσιμο κώδικα.

<ScrollyCoding>

## !!steps Δημιουργία λογαριασμού χορηγού

Δημιουργήστε ένα ξεχωριστό ζεύγος κλειδιών για τον χορηγό που θα πληρώνει τις
προμήθειες συναλλαγών. Ο χορηγός χρειάζεται SOL για τις προμήθειες αλλά δεν
χρειάζεται να κατέχει τα tokens που μεταφέρονται.

<CodePlaceholder title="Χορηγία προμήθειας συναλλαγής" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;
```

## !!steps Δημιουργία εντολής μεταφοράς

Δημιουργήστε την εντολή μεταφοράς token με τον αποστολέα ως εξουσιοδοτημένο. Ο
αποστολέας κατέχει τα tokens και πρέπει να υπογράψει τη μεταφορά.

<CodePlaceholder title="Χρέωση συναλλαγής χορηγού" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

// !focus(1:6)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Sender signs for the transfer
  amount: 250_000n // adjusted for the mint's decimals
});
```

## !!steps Αποστολή με χορηγό ως πληρωτή χρέωσης

Χρησιμοποιήστε `prepareAndSend` με τόσο τον `authority` (τον αποστολέα που
υπογράφει τη μεταφορά) όσο και τον `feePayer` (τον χορηγό που πληρώνει τις
χρεώσεις). Και οι δύο πρέπει να υπογράψουν τη συναλλαγή.

<CodePlaceholder title="Χρέωση συναλλαγής χορηγού" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender,
  amount: 250_000n
});

// !focus(1:6)
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Signs the transfer instruction
  // !mark
  feePayer: sponsor, // Pays the transaction fees
  instructions: [transferInstruction],
  version: 0
});
```

</ScrollyCoding>

### Demo

<CodeTabs flags="r">

```ts !! title="Demo"
// !collapse(1:14) collapsed
// Click ">" icon on left to expand demo imports
import { createClient, lamports } from "@solana/client";
import { generateKeypair } from "@solana/client/server";
import type { ServerKeypair } from "@solana/client/server";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_2022_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token-2022";

// Generate keypairs for sender, recipient, and sponsor (fee payer)
const sender = (await generateKeypair()).signer;
const recipient = (await generateKeypair()).signer;
// !mark
const sponsor = (await generateKeypair()).signer;

console.log("Sender Address:", sender.address);
console.log("Recipient Address:", recipient.address);
console.log("Sponsor Address (Fee Payer):", sponsor.address);

// Demo Setup: Create client, mint account, token accounts, and fund with initial tokens
const { client, mint } = await demoSetup(sender, recipient, sponsor);

console.log("\nMint Address:", mint.address);

// Derive the Associated Token Accounts addresses (ATAs) for sender and recipient
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipientAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient Token Account:", recipientAta.toString());

// =============================================================================
// Sponsored Token Payment Demo
// =============================================================================

// Create instruction to transfer tokens from sender to recipient
// Transferring 250,000 base units = 0.25 tokens (with 6 decimals)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Pass signer, not just address
  amount: 250_000n // 0.25 tokens
});

// Prepare and send transaction with sponsor as fee payer using @solana/client
// The sponsor pays transaction fees, sender signs for the transfer
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Sender signs the transfer instruction
  // !mark
  feePayer: sponsor, // Sponsor pays the transaction fees (different account)
  instructions: [transferInstruction],
  version: 0
});

console.log("\n=== Sponsored Token Payment Complete ===");
console.log("Transaction Signature:", signature.toString());

// Fetch final token account balances using @solana/client SPL token helper
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipientBalance = await splToken.fetchBalance(recipient.address);

console.log("\nSender Token Account Balance:", senderBalance);
console.log("Recipient Token Account Balance:", recipientBalance);

// Fetch transaction details
const transaction = await client.runtime.rpc
  .getTransaction(signature, {
    encoding: "jsonParsed",
    maxSupportedTransactionVersion: 0
  })
  .send();

const feePayer = transaction?.transaction.message.accountKeys?.[0];
console.log("\nNote: The first account in accountKeys is always the fee payer");
console.log("Fee Payer Address:", feePayer);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
// !collapse(1:1000) collapsed

/**
 * Sets up for a sponsored token transfer demo:
 * - Creates @solana/client instance
 * - Airdrops SOL to sponsor for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and recipient
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair (will be funded and used as mint authority)
 * @param recipient - The recipient's keypair
 * @param sponsor - The sponsor's keypair (will pay all transaction fees)
 * @returns Returns client instance and mint address
 */
async function demoSetup(
  sender: ServerKeypair["signer"],
  recipient: ServerKeypair["signer"],
  sponsor: ServerKeypair["signer"]
) {
  // Create @solana/client instance pointing to local validator
  const client = createClient({
    endpoint: "http://localhost:8899",
    websocketEndpoint: "ws://localhost:8900",
    commitment: "confirmed",
    logger: () => {} // Disable all logs
  });

  // Fund sponsor with SOL for transaction fees using @solana/client actions
  await client.actions.requestAirdrop(
    sponsor.address,
    lamports(1_000_000_000n)
  );

  // Generate keypair to use as address of mint
  const mint = (await generateKeypair()).signer;

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await client.runtime.rpc
    .getMinimumBalanceForRentExemption(space)
    .send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program (sponsor pays the rent)
  const createAccountInstruction = getCreateAccountInstruction({
    payer: sponsor,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token 2022 program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 6,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA (sponsor pays)
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient's ATA (sponsor pays)
  const createRecipientAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: recipient.address
    });

  // Create instruction to mint initial tokens to sender
  // Sender is the mint authority and must sign
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender, // Pass signer, not just address
    amount: 1_000_000n // Mint 1.00 tokens (1,000,000 base units with 6 decimals)
  });

  // Combine all instructions and send using @solana/client transaction helper
  const setupInstructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipientAtaInstruction, // Create recipient's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Prepare and send transaction using @solana/client with sponsor as fee payer
  await client.transaction.prepareAndSend({
    authority: sender,
    feePayer: sponsor, // Sponsor pays all transaction fees
    instructions: setupInstructions,
    version: 0
  });

  return {
    client,
    mint
  };
}
```

</CodeTabs>

<Callout type="caution">
  Όταν δημιουργείτε ένα token account για έναν τελικό χρήστη, μπορεί να το
  κλείσει και να ανακτήσει το SOL που χρησιμοποιήθηκε για rent. Σκεφτείτε να
  χρεώνετε τους χρήστες για τη δημιουργία λογαριασμού σε stablecoins, ή να
  συνυπολογίζετε αυτό το κόστος στα οικονομικά του προϊόντος σας.
</Callout>

## Αφαίρεση χρεώσεων σε κλίμακα με το Kora

Το primitive του πληρωτή χρέωσης είναι ισχυρό, αλλά η κατασκευή ενός production
συστήματος χωρίς χρεώσεις απαιτεί περισσότερα: διαχείριση πορτοφολιών χορηγών,
χειρισμό μετατροπών tokens (ώστε οι χρήστες να μπορούν να "πληρώνουν" χρεώσεις
σε USDC), περιορισμό ρυθμού και ελέγχους ασφαλείας.

Το [Kora](https://launch.solana.com/products/kora) χειρίζεται αυτήν την
πολυπλοκότητα. Είναι ένας JSON-RPC server που παρέχει αφαίρεση χρεώσεων ώστε οι
χρήστες να μην χρειάζονται ποτέ SOL. Μπορείτε να χορηγήσετε πλήρως τις χρεώσεις
ή να δεχτείτε πληρωμή χρεώσεων σε οποιοδήποτε token.

Αναπτύξτε το Kora με μία μόνο εντολή:

```bash
cargo install kora-cli
kora --config path/to/kora.toml rpc start --signers-config path/to/signers.toml
```

Στη συνέχεια χρησιμοποιήστε το Kora client για να υπογράψετε και να στείλετε
συναλλαγές:

```bash
pnpm add @solana/kora
```

```typescript
import { KoraClient } from "@solana/kora";

const kora = new KoraClient({ rpcUrl: "https://your-kora-instance" });

const { signature } = await kora.signAndSendTransaction({
  transaction: base64EncodedTransaction
});
```

### Πόροι Kora

<Cards>
  <Card
    title="Γρήγορη εκκίνηση Kora"
    href="https://launch.solana.com/docs/kora/getting-started/quick-start"
  >
    Θέστε το Kora σε λειτουργία τοπικά σε λίγα λεπτά.
  </Card>
  <Card
    title="Πλήρες demo συναλλαγής"
    href="https://launch.solana.com/docs/kora/guides/full-demo"
  >
    Πλήρης οδηγός υλοποίησης συναλλαγής με αφαίρεση χρεώσεων.
  </Card>
  <Card
    title="Αναφορά API"
    href="https://launch.solana.com/docs/kora/json-rpc-api"
  >
    Μέθοδοι JSON-RPC και τεκμηρίωση SDK.
  </Card>
  <Card
    title="Οδηγός διαχειριστή κόμβου"
    href="https://launch.solana.com/docs/kora/operators"
  >
    Αναπτύξτε και διαμορφώστε το δικό σας instance του Kora.
  </Card>
</Cards>
