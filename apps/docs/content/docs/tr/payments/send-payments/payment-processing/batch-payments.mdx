---
title: Toplu ödemeler
description:
  Tek bir işlemde birden fazla alıcıya nasıl ödeme yapılacağını öğrenin.
---

Bir Solana işlemi, bir veya daha fazla talimat içeren bir kapsayıcıdır. Her
talimat bir operasyondur—token transferi, hesap oluşturma, program çağırma. Ağ,
bir işlemdeki tüm talimatları sıralı ve atomik olarak yürütür: ya her talimat
başarılı olur ya da tüm işlem başarısız olur ve geri alınır.

Bu, birden fazla transferi tek bir işleme paketleyebileceğiniz anlamına gelir.
Üç alıcıya ödeme yapmak için üç ayrı işlem göndermek yerine, üç transfer
talimatı içeren tek bir işlem gönderirsiniz. Bu daha hızlıdır (üç yerine bir
onay) ve daha ucuzdur (üç yerine bir temel ücret). İşte ödemelerin (bu görselde
"drops" olarak adlandırılır) tek bir işlemde nasıl toplandığını ve daha büyük
toplu işi yönetmek için birden fazla işlemin nasıl gönderildiğini gösteren
açıklayıcı bir örnek.

![Toplu ödemeler diyagramı](/assets/docs/payments/qn-bulk-send.png)

_Kaynak:
[QuickNode - How to Send Bulk Transactions on Solana](https://www.quicknode.com/guides/solana-development/transactions/how-to-send-bulk-transactions-on-solana)_

İşlemler ve talimatlar hakkında daha fazla bilgi için
[İşlemler](/docs/core/transactions) ve [Talimatlar](/docs/core/instructions)
kılavuzlarına bakın.

Aşağıdaki adım adım anlatım, toplu ödemeler için tek bir işleme birden fazla
transfer talimatının nasıl yükleneceğini gösterir.

## Talimatları tek bir işlemde toplu hale getirme

Bir Solana işlemi, farklı alıcılara birden fazla transfer içerebilir. Bir kez
imzalarsınız, bir işlem ücreti ödersiniz ve tüm transferler birlikte
gerçekleşir. Herhangi bir transfer başarısız olursa, tüm işlem reddedilir.

<Callout>
  Temel ödeme kavramları için [Solana'da ödemeler nasıl
  çalışır](/docs/payments/how-payments-work) bölümüne bakın.
</Callout>

Birden fazla transferi toplu hale getirmek, her talimatı ayrı ayrı oluşturmayı
ve ardından bunları tek bir işlemde birleştirmeyi gerektirir.

Aşağıdaki adımlar temel akışı gösterir. Tam çalıştırılabilir kod için
[Demo](#demo) bölümüne bakın.

<ScrollyCoding>

## !!steps Token hesaplarını türet

İlk olarak, gönderen ve her alıcı için associated token account (ATA)
adreslerini türetin. ATA'lar, cüzdan ve mint'e dayalı deterministik adreslerdir.

<CodePlaceholder title="Toplu ödemeler" />

```ts !! title="Batch Payments"
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient1Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient1.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient2Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient2.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});
```

## !!steps Transfer talimatları oluştur

Her alıcı için ayrı bir transfer talimatı oluşturun. Her talimat şunları
belirtir:

- kaynak token hesabı adresi
- hedef token hesabı adresi
- yetki (kaynak token hesabı sahibi adresi)
- temel birimlerdeki miktar (mint'in ondalık basamaklarına göre ayarlanmış)

<CodePlaceholder title="Toplu ödemeler" />

```ts !! title="Batch Payments"
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient1Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient1.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient2Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient2.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

// !focus(1:12)
const transfer1Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient1Ata,
  authority: sender.address,
  amount: 250_000n
});

const transfer2Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient2Ata,
  authority: sender.address,
  amount: 250_000n
});
```

## !!steps Tek işlem olarak gönder

Tüm transfer talimatlarını tek bir işleme ekleyin. Bu, tüm transferleri atomik
olarak yürütür; ya tüm transferler başarılı olur ya da tüm işlem başarısız olur.

```ts !! title="Batch Payments"
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient1Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient1.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient2Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient2.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const transfer1Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient1Ata,
  authority: sender.address,
  amount: 250_000n
});

const transfer2Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient2Ata,
  authority: sender.address,
  amount: 250_000n
});

// !focus(1:5)
const signature = await client.transaction.prepareAndSend({
  authority: sender,
  // !mark
  instructions: [transfer1Instruction, transfer2Instruction],
  version: 0
});
```

## !!steps Bakiyeleri doğrula

Toplu transferden sonra, `splToken` yardımcısını kullanarak tüm tarafların token
bakiyelerini doğrulayın.

<CodePlaceholder title="Toplu ödemeler" />

```ts !! title="Batch Payments"
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient1Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient1.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipient2Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient2.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const transfer1Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient1Ata,
  authority: sender.address,
  amount: 250_000n
});

const transfer2Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient2Ata,
  authority: sender.address,
  amount: 250_000n
});

const signature = await client.transaction.prepareAndSend({
  authority: sender,
  instructions: [transfer1Instruction, transfer2Instruction],
  version: 0
});

// !focus(1:8)
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipient1Balance = await splToken.fetchBalance(recipient1.address);
const recipient2Balance = await splToken.fetchBalance(recipient2.address);
```

</ScrollyCoding>

### Demo

<CodeTabs flags="r">

```ts !! title="Demo"
// !collapse(1:14) collapsed
// Click ">" icon on left to expand demo imports
import { createClient, lamports } from "@solana/client";
import { generateKeypair } from "@solana/client/server";
import type { ServerKeypair } from "@solana/client/server";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_2022_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token-2022";

// Generate keypairs for sender and two recipients
const sender = (await generateKeypair()).signer;
const recipient1 = (await generateKeypair()).signer;
const recipient2 = (await generateKeypair()).signer;

console.log("Sender Address:", sender.address);
console.log("Recipient 1 Address:", recipient1.address);
console.log("Recipient 2 Address:", recipient2.address);

// Demo Setup: Create client, mint account, token accounts, and fund with initial tokens
const { client, mint } = await demoSetup(sender, recipient1, recipient2);

console.log("\nMint Address:", mint.address);

// Derive the Associated Token Accounts addresses (ATAs) for sender and recipients
// !mark(1:5)
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

// !mark(1:5)
const [recipient1Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient1.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

// !mark(1:5)
const [recipient2Ata] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient2.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient 1 Token Account:", recipient1Ata.toString());
console.log("Recipient 2 Token Account:", recipient2Ata.toString());

// =============================================================================
// Batch Token Payment Demo
// =============================================================================

// Create instructions to transfer tokens from sender to both recipients
// Transferring 250,000 base units = 0.25 tokens (with 6 decimals) to each
// !mark(1:6)
const transfer1Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient1Ata,
  authority: sender.address,
  amount: 250_000n // 0.25 tokens
});

// !mark(1:6)
const transfer2Instruction = getTransferInstruction({
  source: senderAta,
  destination: recipient2Ata,
  authority: sender.address,
  amount: 250_000n // 0.25 tokens
});

// Prepare and send both transfers in a single transaction using @solana/client
const signature = await client.transaction.prepareAndSend({
  authority: sender,
  // !mark
  instructions: [transfer1Instruction, transfer2Instruction],
  version: 0
});

console.log("\n=== Batch Token Payment Complete ===");
console.log("Transaction Signature:", signature.toString());

// Fetch final token account balances using @solana/client SPL token helper
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipient1Balance = await splToken.fetchBalance(recipient1.address);
const recipient2Balance = await splToken.fetchBalance(recipient2.address);

console.log("\nSender Token Account Balance:", senderBalance);
console.log("Recipient 1 Token Account Balance:", recipient1Balance);
console.log("Recipient 2 Token Account Balance:", recipient2Balance);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
// !collapse(1:1000) collapsed

/**
 * Sets up for a batch token transfer demo:
 * - Creates @solana/client instance
 * - Airdrops SOL to sender for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and both recipients
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair (will be funded and used as mint authority)
 * @param recipient1 - The first recipient's keypair
 * @param recipient2 - The second recipient's keypair
 * @returns Returns client instance and mint address
 */
async function demoSetup(
  sender: ServerKeypair["signer"],
  recipient1: ServerKeypair["signer"],
  recipient2: ServerKeypair["signer"]
) {
  // Create @solana/client instance pointing to local validator
  const client = createClient({
    endpoint: "http://localhost:8899",
    websocketEndpoint: "ws://localhost:8900",
    commitment: "confirmed",
    logger: () => {} // Disable all logs
  });

  // Fund sender with SOL for transaction fees using @solana/client actions
  await client.actions.requestAirdrop(sender.address, lamports(1_000_000_000n));

  // Generate keypair to use as address of mint
  const mint = (await generateKeypair()).signer;

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await client.runtime.rpc
    .getMinimumBalanceForRentExemption(space)
    .send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program
  const createAccountInstruction = getCreateAccountInstruction({
    payer: sender,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token 2022 program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 6,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sender,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient 1's ATA
  const createRecipient1AtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sender,
      mint: mint.address,
      owner: recipient1.address
    });

  // Create instruction for recipient 2's ATA
  const createRecipient2AtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sender,
      mint: mint.address,
      owner: recipient2.address
    });

  // Create instruction to mint initial tokens to sender
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender.address,
    amount: 1_000_000n // Mint 1.00 tokens (1,000,000 base units with 6 decimals)
  });

  // Combine all instructions and send using @solana/client transaction helper
  const setupInstructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipient1AtaInstruction, // Create recipient 1's ATA
    createRecipient2AtaInstruction, // Create recipient 2's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Prepare and send transaction using @solana/client
  await client.transaction.prepareAndSend({
    authority: sender,
    instructions: setupInstructions,
    version: 0
  });

  return {
    client,
    mint
  };
}
```

</CodeTabs>

## İşlem planlaması ile ölçeklendirme

Tek bir işlemin boyut sınırları vardır—yaklaşık 1232 bayt. Büyük toplu işlemler
için (yüzlerce çalışan için bordro, toplu airdrop'lar), bu sınırı aşacaksınız ve
işi birden fazla işleme bölmeniz gerekecektir.

Kendi işlem dağıtım mantığınızı oluşturmakta özgür olsanız da,
[`@solana/instruction-plans`](https://www.solanakit.com/docs/concepts/instruction-plans)
paketi (Solana Kit'in bir parçası) bunu iki seviyede yönetir:

**Talimat planları** işlemlerinizi ve bunların sıralama kısıtlamalarını
tanımlar:

- **Sıralı** — sırayla yürütülmesi gereken talimatlar
- **Paralel** — herhangi bir sırada yürütülebilen talimatlar
- **Bölünemez** — aynı işlemde birlikte kalması gereken talimatlar

**İşlem planları** talimat planlarından oluşturulur. Planlayıcı, sıralama
kısıtlamalarınıza uyarak talimatları optimal boyutlu işlemlere akıllıca
paketler. Ortaya çıkan işlem planı daha sonra:

- **Yürütülebilir** — imzalanır ve ağa gönderilir, paralel işlemler eşzamanlı
  olarak gönderilir
- **Simüle edilebilir** — göndermeden önce doğrulamak için ağa karşı test
  çalıştırması yapılır
- **Serileştirilebilir** — harici imzalama servisleri veya çok taraflı iş
  akışları için base64'e derlenir

Bu iki seviyeli yaklaşım, kütüphane işlem boyutlandırma, paketleme ve paralel
yürütme mekaniklerini hallederken, sizin işlemler açısından düşünmenizi
("Alice'e transfer et, sonra Bob'a transfer et") sağlar.
