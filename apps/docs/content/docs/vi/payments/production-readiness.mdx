---
title: S·∫µn s√†ng cho m√¥i tr∆∞·ªùng production
description: Chuy·ªÉn t·ª´ th·ª≠ nghi·ªám devnet sang tri·ªÉn khai mainnet
---

X√¢y d·ª±ng c·ª•c b·ªô v√† th·ª≠ nghi·ªám tr√™n devnet l√† nh·ªØng c√°ch tuy·ªát v·ªùi ƒë·ªÉ b·∫Øt ƒë·∫ßu v·ªõi
thanh to√°n Solana. Tuy nhi√™n, khi b·∫°n s·∫µn s√†ng tri·ªÉn khai l√™n Mainnet, b·∫°n c·∫ßn
nh·∫≠n th·ª©c ƒë∆∞·ª£c nh·ªØng ƒëi·ªÉm ƒë·∫∑c th√π c·ªßa mainnet. Devnet tha th·ª© cho sai l·∫ßm.
Mainnet th√¨ kh√¥ng. H∆∞·ªõng d·∫´n n√†y ƒë·ªÅ c·∫≠p ƒë·∫øn nh·ªØng kh√°c bi·ªát quan tr·ªçng ƒë·ªÉ ƒë·∫£m
b·∫£o ng∆∞·ªùi d√πng c·ªßa b·∫°n c√≥ tr·∫£i nghi·ªám m∆∞·ª£t m√†.

| Devnet                               | Mainnet                                                                             |
| ------------------------------------ | ----------------------------------------------------------------------------------- |
| SOL mi·ªÖn ph√≠ t·ª´ faucet               | [Mua SOL th·∫≠t](https://solana.com/ecosystem/explore?categories=exchange) ƒë·ªÉ tr·∫£ ph√≠ |
| C·∫°nh tranh th·∫•p cho kh√¥ng gian block | Ph√≠ ∆∞u ti√™n quan tr·ªçng                                                              |
| Giao d·ªãch ƒë∆∞·ª£c x·ª≠ l√Ω d·ªÖ d√†ng         | C·∫•u h√¨nh giao d·ªãch r·∫•t quan tr·ªçng                                                   |
| RPC c√¥ng khai l√† ƒë·ªß                  | Y√™u c·∫ßu RPC production                                                              |
| Keypair v√† mint c·ªßa devnet           | Kh√≥a v√† token mint kh√°c nhau‚Äîc·∫≠p nh·∫≠t c·∫•u h√¨nh c·ªßa b·∫°n                              |

## H·∫° t·∫ßng RPC

[Endpoint c√¥ng khai](https://solana.com/docs/references/clusters#solana-public-rpc-endpoints)
(`api.mainnet-beta.solana.com`) b·ªã gi·ªõi h·∫°n t·ªëc ƒë·ªô v√† kh√¥ng c√≥ SLA. Ch√∫ng ph√π
h·ª£p cho ph√°t tri·ªÉn nh∆∞ng s·∫Ω l√†m th·∫•t b·∫°i c√°c lu·ªìng thanh to√°n production‚Äîgi·ªëng
nh∆∞ c·ªë g·∫Øng ch·∫°y m·ªôt b·ªô x·ª≠ l√Ω thanh to√°n th√¥ng qua API d√πng chung m√† kh√¥ng c√≥
ƒë·∫£m b·∫£o uptime.

<Callout
  type="caution"
  title="Kh√¥ng bao gi·ªù s·ª≠ d·ª•ng RPC c√¥ng khai cho production"
>
  S·ª≠ d·ª•ng [nh√† cung c·∫•p RPC ri√™ng](https://solana.com/rpc) ƒë·ªÉ c√≥ quy·ªÅn truy c·∫≠p
  ƒë√°ng tin c·∫≠y, ƒë·ªô tr·ªÖ th·∫•p.
</Callout>

Khi ch·ªçn nh√† cung c·∫•p RPC, h√£y t√¨m:

- **ƒê·ªô tin c·∫≠y**: SLA v·ªõi ƒë·∫£m b·∫£o uptime (99.9%+)
- **ƒê·ªô tr·ªÖ**: G·∫ßn v·ªÅ m·∫∑t ƒë·ªãa l√Ω v·ªõi ng∆∞·ªùi d√πng c·ªßa b·∫°n
- **T√≠nh nƒÉng**: T√≠nh nƒÉng landing giao d·ªãch, indexing, API ph√≠ ∆∞u ti√™n

ƒê·ªÉ xem danh s√°ch ƒë·∫ßy ƒë·ªß c√°c nh√† cung c·∫•p RPC, h√£y xem h∆∞·ªõng d·∫´n
[Nh√† cung c·∫•p h·∫° t·∫ßng RPC](https://solana.com/rpc).

### C·∫•u h√¨nh RPC d·ª± ph√≤ng

Gi·ªëng nh∆∞ b·∫•t k·ª≥ nh√† cung c·∫•p d·ªãch v·ª• m·∫°ng n√†o, c√°c nh√† cung c·∫•p RPC c√≥ th·ªÉ g·∫∑p
downtime ho·∫∑c giai ƒëo·∫°n hi·ªáu su·∫•t gi·∫£m s√∫t. ƒê·ªÉ ƒë·∫£m b·∫£o ·ª©ng d·ª•ng c·ªßa b·∫°n c√≥ kh·∫£
nƒÉng ph·ª•c h·ªìi, b·∫°n n√™n c·∫•u h√¨nh ·ª©ng d·ª•ng c·ªßa m√¨nh ƒë·ªÉ s·ª≠ d·ª•ng nhi·ªÅu nh√† cung c·∫•p
RPC.

[Solana Kit](https://github.com/anza-xyz/kit/tree/main/packages/rpc-transport-http)
cung c·∫•p th∆∞ vi·ªán ƒë·ªÉ t√πy ch·ªânh c√°c ph∆∞∆°ng th·ª©c truy·ªÅn t·∫£i RPC, cho ph√©p b·∫°n x√¢y
d·ª±ng client RPC d·ª± ph√≤ng c·ªßa ri√™ng m√¨nh. D∆∞·ªõi ƒë√¢y l√† v√≠ d·ª• v·ªÅ c√°ch b·∫°n c√≥ th·ªÉ s·ª≠
d·ª•ng n√≥ ƒë·ªÉ x√¢y d·ª±ng m·ªôt client RPC d·ª± ph√≤ng:

```ts
import { RpcTransport } from "@solana/rpc-spec";
import { RpcResponse } from "@solana/rpc-spec-types";
import { createHttpTransport } from "@solana/rpc-transport-http";

// Create a transport for each RPC server
const transports = [
  createHttpTransport({ url: "https://mainnet-beta.my-server-1.com" }),
  createHttpTransport({ url: "https://mainnet-beta.my-server-2.com" }),
  createHttpTransport({ url: "https://mainnet-beta.my-server-3.com" })
];

// Create a wrapper transport that distributes requests to them
let nextTransport = 0;
async function roundRobinTransport<TResponse>(
  ...args: Parameters<RpcTransport>
): Promise<RpcResponse<TResponse>> {
  const transport = transports[nextTransport];
  nextTransport = (nextTransport + 1) % transports.length;
  return await transport(...args);
}
```

N·∫øu b·∫°n kh√¥ng mu·ªën t·ª± x√¢y d·ª±ng c√¥ng c·ª• ƒë·ªãnh tuy·∫øn, b·∫°n c√≥ th·ªÉ t·∫≠n d·ª•ng d·ªãch v·ª•
b√™n th·ª© ba nh∆∞ [Iron Forge](https://www.ironforge.sanctum.so/) ƒë·ªÉ x·ª≠ l√Ω vi·ªác
ƒë·ªãnh tuy·∫øn cho b·∫°n.

## X√°c nh·∫≠n giao d·ªãch

Tr√™n Devnet, c√°c giao d·ªãch ƒë∆∞·ª£c x√°c nh·∫≠n kh√° d·ªÖ d√†ng. Tr√™n Mainnet, b·∫°n ƒëang
c·∫°nh tranh cho kh√¥ng gian block. ƒê·ªÉ tƒÉng kh·∫£ nƒÉng giao d·ªãch c·ªßa b·∫°n ƒë∆∞·ª£c ƒë∆∞a v√†o
m·ªôt block, b·∫°n n√™n ƒë·∫£m b·∫£o r·∫±ng b·∫°n ƒë√£ l·∫Øp r√°p giao d·ªãch ƒë√∫ng c√°ch. ƒêi·ªÅu n√†y c√≥
nghƒ©a l√†:

- bao g·ªìm blockhash m·ªõi tr∆∞·ªõc khi g·ª≠i giao d·ªãch
- bao g·ªìm ch·ªâ th·ªã ph√≠ ∆∞u ti√™n trong giao d·ªãch v·ªõi m·ª©c ph√≠ ∆∞u ti√™n c·∫°nh tranh
- bao g·ªìm ch·ªâ th·ªã gi·ªõi h·∫°n ƒë∆°n v·ªã t√≠nh to√°n trong giao d·ªãch v·ªõi gi·ªõi h·∫°n ƒë∆°n v·ªã
  t√≠nh to√°n d·ª±a tr√™n ∆∞·ªõc t√≠nh ƒë∆°n v·ªã t√≠nh to√°n c·∫ßn thi·∫øt cho giao d·ªãch

Ngo√†i ra, b·∫°n n√™n xem x√©t c√°c c√¥ng c·ª• kh√°c nh∆∞ Jito Bundles ƒë·ªÉ tƒÉng kh·∫£ nƒÉng
giao d·ªãch c·ªßa b·∫°n ƒë∆∞·ª£c ƒë∆∞a v√†o m·ªôt block. H√£y c√πng kh√°m ph√° c√°c c√¥ng c·ª• n√†y chi
ti·∫øt h∆°n.

### C·∫•u h√¨nh g·ª≠i giao d·ªãch

Khi g·ª≠i giao d·ªãch tr√™n Mainnet, h√£y c·∫•u h√¨nh c√°c tham s·ªë n√†y ƒë·ªÉ ƒë·∫°t t·ª∑ l·ªá x√°c
nh·∫≠n t·ªëi ∆∞u:

**Qu·∫£n l√Ω blockhash:**

- L·∫•y v·ªõi cam k·∫øt `confirmed`
- L∆∞u tr·ªØ `lastValidBlockHeight` ƒë∆∞·ª£c tr·∫£ v·ªÅ b·ªüi `getLatestBlockhash`‚Äîƒëi·ªÅu n√†y
  cho b·∫°n bi·∫øt khi n√†o giao d·ªãch c·ªßa b·∫°n h·∫øt h·∫°n
- Blockhash h·∫øt h·∫°n sau ~150 block (~60-90 gi√¢y)

**T√πy ch·ªçn g·ª≠i:**

- `maxRetries: 0` ‚Äî V√¥ hi·ªáu h√≥a th·ª≠ l·∫°i RPC t·ª± ƒë·ªông. T·ª± x·ª≠ l√Ω vi·ªác th·ª≠ l·∫°i ƒë·ªÉ
  b·∫°n c√≥ th·ªÉ l√†m m·ªõi blockhash khi c·∫ßn thi·∫øt.
- `skipPreflight: true` ‚Äî B·ªè qua m√¥ ph·ªèng tr∆∞·ªõc khi g·ª≠i. S·ª≠ d·ª•ng t√πy ch·ªçn n√†y
  khi b·∫°n ƒë√£ x√°c th·ª±c giao d·ªãch v√† mu·ªën ƒë·ªô tr·ªÖ th·∫•p nh·∫•t. Gi·ªØ n√≥ ·ªü `false` trong
  qu√° tr√¨nh ph√°t tri·ªÉn ƒë·ªÉ ph√°t hi·ªán l·ªói s·ªõm.

```typescript
import { createSolanaRpc } from "@solana/kit";

const rpc = createSolanaRpc(process.env.RPC_URL!);

// 1. Get blockhash with confirmed commitment
const { value: latestBlockhash } = await rpc
  .getLatestBlockhash({ commitment: "confirmed" })
  .send();

// 2. Build and sign your transaction with the blockhash
// ... (transaction building code)

// 3. Send with production settings
const signature = await rpc
  .sendTransaction(encodedTransaction, {
    encoding: "base64",
    maxRetries: 0n, // Handle retries yourself
    skipPreflight: true, // Skip simulation for speed (use false during dev)
    preflightCommitment: "confirmed"
  })
  .send();

// 4. Track expiration using lastValidBlockHeight
const { lastValidBlockHeight } = latestBlockhash;
// Stop retrying when current block height exceeds lastValidBlockHeight
```

### S·ª≠ d·ª•ng ph√≠ ∆∞u ti√™n

M·ªçi giao d·ªãch Solana ƒë·ªÅu y√™u c·∫ßu ph√≠ giao d·ªãch, ƒë∆∞·ª£c thanh to√°n b·∫±ng SOL. Ph√≠
giao d·ªãch ƒë∆∞·ª£c chia th√†nh hai ph·∫ßn: ph√≠ c∆° b·∫£n v√† ph√≠ ∆∞u ti√™n. Ph√≠ c∆° b·∫£n b√π ƒë·∫Øp
cho c√°c validator khi x·ª≠ l√Ω giao d·ªãch. Ph√≠ ∆∞u ti√™n l√† kho·∫£n ph√≠ t√πy ch·ªçn, nh·∫±m
tƒÉng kh·∫£ nƒÉng leader hi·ªán t·∫°i s·∫Ω x·ª≠ l√Ω giao d·ªãch c·ªßa b·∫°n. H√£y nghƒ© v·ªÅ n√≥ nh∆∞
d·ªãch v·ª• giao h√†ng nhanh: b·∫°n tr·∫£ nhi·ªÅu h∆°n ƒë·ªÉ ƒë∆∞·ª£c giao h√†ng nhanh h∆°n v√† ƒë√°ng
tin c·∫≠y h∆°n.

**C√°ch th·ª©c ho·∫°t ƒë·ªông c·ªßa ph√≠:**

```
Total fee = Base fee (5,000 lamports per signature) + Priority fee
Priority fee = Compute units x Price per unit (micro-lamports per compute unit)
```

**Chi ph√≠ th·ª±c t·∫ø:**

- Chuy·ªÉn USDC ƒë∆°n gi·∫£n: ~$0.001-0.005 trong ƒëi·ªÅu ki·ªán b√¨nh th∆∞·ªùng
- Trong th·ªùi gian t·∫Øc ngh·∫Ωn: ~$0.01-0.05
- T·∫Øc ngh·∫Ωn cao ƒëi·ªÉm: C√≥ th·ªÉ tƒÉng cao h∆°n

**V√≠ d·ª• tri·ªÉn khai:**

G√≥i
[`@solana-program/compute-budget`](https://github.com/solana-program/compute-budget)
cung c·∫•p h√†m tr·ª£ gi√∫p ƒë·ªÉ d·ªÖ d√†ng c·∫≠p nh·∫≠t ho·∫∑c th√™m ch·ªâ th·ªã gi√° ƒë∆°n v·ªã t√≠nh to√°n
(t√≠nh b·∫±ng micro-lamport) v√†o giao d·ªãch.

```typescript
import { updateOrAppendSetComputeUnitPriceInstruction } from "@solana-program/compute-budget";

const tx = pipe(
  createTransactionMessage({ version: 0 }),
  (m) => setTransactionMessageFeePayerSigner(payer, m),
  (m) => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, m),
  (m) => appendTransactionMessageInstructions([myInstructions], m),
  (m) => updateOrAppendSetComputeUnitPriceInstruction(1000n as MicroLamports, m)
);
```

**L·∫•y ∆∞·ªõc t√≠nh ph√≠:** H·∫ßu h·∫øt c√°c nh√† cung c·∫•p RPC ƒë·ªÅu cung c·∫•p API ph√≠ ∆∞u ti√™n:

- [Helius Priority Fee API](https://docs.helius.dev/solana-apis/priority-fee-api)
- [QuickNode Priority Fee Add-on](https://marketplace.quicknode.com/add-on/solana-priority-fee)
- [Triton Priority Fees API](https://docs.triton.one/chains/solana/improved-priority-fees-api)

ƒê·ªÉ bi·∫øt ƒë·∫ßy ƒë·ªß c∆° ch·∫ø ph√≠, xem [Ph√≠ giao d·ªãch](/docs/core/fees) v√† h∆∞·ªõng d·∫´n c·ªßa
ch√∫ng t√¥i:
[C√°ch th√™m ph√≠ ∆∞u ti√™n v√†o giao d·ªãch](https://solana.com/developers/cookbook/transactions/add-priority-fees).

### T·ªëi ∆∞u h√≥a ƒë∆°n v·ªã t√≠nh to√°n

T√≠nh to√°n tr√™n Solana th·ª±c ch·∫•t l√† th∆∞·ªõc ƒëo l∆∞·ª£ng c√¥ng vi·ªác m√† ch∆∞∆°ng tr√¨nh ƒëang
th·ª±c hi·ªán. C√≥ gi·ªõi h·∫°n v·ªÅ l∆∞·ª£ng t√≠nh to√°n c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m·ªôt giao
d·ªãch (hi·ªán t·∫°i l√† 1,4 tri·ªáu ƒë∆°n v·ªã t√≠nh to√°n), v√† gi·ªõi h·∫°n v·ªÅ l∆∞·ª£ng t√≠nh to√°n c√≥
th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho m·ªói t√†i kho·∫£n tr√™n m·ªói block (hi·ªán t·∫°i l√† 100 tri·ªáu ƒë∆°n v·ªã
t√≠nh to√°n).

Khi b·∫°n g·ª≠i giao d·ªãch, b·∫°n c·∫ßn ∆∞·ªõc t√≠nh l∆∞·ª£ng t√≠nh to√°n s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng v√† ƒë·∫∑t
gi·ªõi h·∫°n ƒë∆°n v·ªã t√≠nh to√°n cho ph√π h·ª£p - ƒë√¢y th·ª±c ch·∫•t l√† y√™u c·∫ßu v·ªÅ l∆∞·ª£ng c√¥ng
su·∫•t t·ªïng th·ªÉ c·∫ßn ƒë∆∞·ª£c d√†nh ri√™ng cho giao d·ªãch c·ªßa b·∫°n. Tr√™n th·ª±c t·∫ø, ƒëi·ªÅu n√†y
c√≥ nghƒ©a l√† vi·ªác ∆∞·ªõc t√≠nh ch√≠nh x√°c c√°c ƒë∆°n v·ªã t√≠nh to√°n c·∫ßn thi·∫øt cho giao d·ªãch
c·ªßa b·∫°n l√† r·∫•t quan tr·ªçng ƒë·ªÉ giao d·ªãch ƒë∆∞·ª£c ƒë∆∞a v√†o block (v√† quan tr·ªçng cho
vi·ªác qu·∫£n l√Ω ph√≠ ∆∞u ti√™n c·ªßa b·∫°n).

Solana JSON RPC API c√≥ ph∆∞∆°ng th·ª©c
[`simulatetransaction`](/docs/rpc/http/simulatetransaction) c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng
ƒë·ªÉ ∆∞·ªõc t√≠nh c√°c ƒë∆°n v·ªã t√≠nh to√°n c·∫ßn thi·∫øt cho m·ªôt giao d·ªãch, bao g·ªìm c·∫£ ∆∞·ªõc
t√≠nh c√°c ƒë∆°n v·ªã t√≠nh to√°n s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng. Package
[`@solana-program/compute-budget`](https://github.com/solana-program/compute-budget)
cung c·∫•p m·ªôt h√†m tr·ª£ gi√∫p ƒë·ªÉ d·ªÖ d√†ng ∆∞·ªõc t√≠nh c√°c ƒë∆°n v·ªã t√≠nh to√°n c·∫ßn thi·∫øt cho
m·ªôt giao d·ªãch (s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `simulatetransaction` b√™n d∆∞·ªõi).

```ts
import {
  estimateComputeUnitLimitFactory,
  updateOrAppendSetComputeUnitLimitInstruction
} from "@solana-program/compute-budget";

const estimateComputeUnitLimit = estimateComputeUnitLimitFactory({ rpc });
const computeUnitLimit = await estimateComputeUnitLimit(tx);
const txWithComputeUnitLimit = updateOrAppendSetComputeUnitLimitInstruction(
  computeUnitLimit,
  tx
);
```

Trong m√¥i tr∆∞·ªùng production, n·∫øu b·∫°n l·∫∑p l·∫°i c√πng m·ªôt lo·∫°i giao d·ªãch nhi·ªÅu l·∫ßn,
b·∫°n n√™n c√¢n nh·∫Øc cache ∆∞·ªõc t√≠nh compute cho lo·∫°i giao d·ªãch ƒë√≥ ƒë·ªÉ tr√°nh chi ph√≠
∆∞·ªõc t√≠nh c√°c ƒë∆°n v·ªã t√≠nh to√°n m·ªói l·∫ßn.

### Jito bundles

Jito bundles l√† c√¥ng c·ª• ƒë·ªÉ qu·∫£n l√Ω vi·ªác th·ª±c thi nguy√™n t·ª≠ c·ªßa nhi·ªÅu giao d·ªãch.
ƒêi·ªÅu n√†y ƒë·∫°t ƒë∆∞·ª£c b·∫±ng c√°ch g·ª≠i nhi·ªÅu giao d·ªãch ƒë·∫øn m·∫°ng Jito k√®m theo tip. Tip
c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ khuy·∫øn kh√≠ch m·∫°ng Jito ƒë∆∞a c√°c giao d·ªãch c·ªßa b·∫°n v√†o m·ªôt
block.

**T√†i nguy√™n:**

- [T√†i li·ªáu Jito](https://docs.jito.wtf/lowlatencytxnsend/)
- [üé• Video: Jito bundles](https://www.youtube.com/watch?v=HZ1pK9i6zx4)
- [H∆∞·ªõng d·∫´n QuickNode v·ªÅ Jito bundles](https://www.quicknode.com/guides/solana-development/transactions/jito-bundles)

### Chi·∫øn l∆∞·ª£c retry

Giao d·ªãch c√≥ th·ªÉ th·∫•t b·∫°i v√¨ nhi·ªÅu l√Ω do. Kh√¥ng gi·ªëng nh∆∞ c√°c API thanh to√°n
truy·ªÅn th·ªëng tr·∫£ v·ªÅ th√†nh c√¥ng/th·∫•t b·∫°i ngay l·∫≠p t·ª©c, c√°c giao d·ªãch blockchain
y√™u c·∫ßu theo d√µi x√°c nh·∫≠n.

**C√°c kh√°i ni·ªám ch√≠nh:**

- **H·∫øt h·∫°n blockhash**: Giao d·ªãch c√≥ hi·ªáu l·ª±c trong ~150 block (~60-90 gi√¢y)
- **Idempotency**: C√πng m·ªôt giao d·ªãch ƒë√£ k√Ω lu√¥n t·∫°o ra c√πng m·ªôt ch·ªØ k√Ω‚Äîg·ª≠i l·∫°i
  l√† an to√†n
- **Exponential backoff**: Tr√°nh l√†m qu√° t·∫£i m·∫°ng v·ªõi c√°c l·∫ßn retry nhanh

```typescript
import {
  createSolanaRpc,
  createSolanaRpcSubscriptions,
  sendAndConfirmTransactionFactory,
  isSolanaError,
  SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED
} from "@solana/kit";

const rpc = createSolanaRpc(process.env.RPC_URL!);
const rpcSubscriptions = createSolanaRpcSubscriptions(process.env.RPC_WSS_URL!);

const sendAndConfirmTransaction = sendAndConfirmTransactionFactory({
  rpc,
  rpcSubscriptions
});

// Send with automatic confirmation tracking and block height monitoring
try {
  await sendAndConfirmTransaction(signedTransaction, {
    commitment: "confirmed",
    // Optional: abort after 75 seconds
    abortSignal: AbortSignal.timeout(75_000)
  });
} catch (e) {
  if (isSolanaError(e, SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED)) {
    // Blockhash expired‚Äîrebuild transaction with fresh blockhash and retry
    rebuildAndRetryTransaction(); // implement your own logic for rebuilding and retrying the transaction
  }
  throw e;
}
```

`sendAndConfirmTransactionFactory` t·ª´ `@solana/kit` x·ª≠ l√Ω vi·ªác polling x√°c nh·∫≠n
v√† theo d√µi block height t·ª± ƒë·ªông. N√≥ throw `SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED`
khi blockhash c·ªßa giao d·ªãch h·∫øt h·∫°n, b√°o hi·ªáu r·∫±ng b·∫°n c·∫ßn x√¢y d·ª±ng l·∫°i giao
d·ªãch v·ªõi blockhash m·ªõi.

### T√†i nguy√™n b·ªï sung

- [H∆∞·ªõng d·∫´n: X√°c nh·∫≠n v√† h·∫øt h·∫°n giao d·ªãch](https://solana.com/developers/guides/advanced/confirmation)
- [Helius: C√°ch th·ª±c hi·ªán giao d·ªãch tr√™n Solana](https://www.helius.dev/blog/how-to-land-transactions-on-solana)
- [QuickNode: Chi·∫øn l∆∞·ª£c t·ªëi ∆∞u h√≥a giao d·ªãch Solana](https://www.quicknode.com/docs/solana/transactions)

## Hi·ªÉu v·ªÅ c√°c c·∫•p ƒë·ªô x√°c nh·∫≠n

Solana cung c·∫•p ba c·∫•p ƒë·ªô x√°c nh·∫≠n. Theo thu·∫≠t ng·ªØ t√†i ch√≠nh truy·ªÅn th·ªëng:

| C·∫•p ƒë·ªô      | ƒê·ªãnh nghƒ©a Solana               | T∆∞∆°ng ƒë∆∞∆°ng truy·ªÅn th·ªëng | Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng         |
| ----------- | ------------------------------- | ------------------------ | -------------------------- |
| `processed` | Trong block, ch∆∞a ƒë∆∞·ª£c b·ªè phi·∫øu | ƒêang ch·ªù ·ªßy quy·ªÅn        | C·∫≠p nh·∫≠t UI th·ªùi gian th·ª±c |
| `confirmed` | ƒêa s·ªë tuy·ªát ƒë·ªëi ƒë√£ b·ªè phi·∫øu     | Ti·ªÅn ƒë√£ x√°c nh·∫≠n         | **H·∫ßu h·∫øt thanh to√°n**     |
| `finalized` | ƒê√£ root, kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c    | Ti·ªÅn ƒë√£ thanh to√°n       | Gi√° tr·ªã cao, tu√¢n th·ªß      |

**Khi n√†o s·ª≠ d·ª•ng t·ª´ng lo·∫°i:**

- **C·∫≠p nh·∫≠t UI**: Hi·ªÉn th·ªã `processed` ƒë·ªÉ ph·∫£n h·ªìi ngay l·∫≠p t·ª©c ("ƒê√£ g·ª≠i thanh
  to√°n")
- **Ghi c√≥ t√†i kho·∫£n ng∆∞·ªùi d√πng**: Ch·ªù `confirmed` (an to√†n cho h·∫ßu h·∫øt giao
  d·ªãch)
- **Giao h√†ng v·∫≠t l√Ω**: Ch·ªù `finalized`
- **R√∫t ti·ªÅn l·ªõn**: Ch·ªù `finalized`
- **Tu√¢n th·ªß/ki·ªÉm to√°n**: Lu√¥n ghi l·∫°i tr·∫°ng th√°i `finalized`

ƒê·ªÉ bi·∫øt th√™m v·ªÅ ki·ªÉm tra tr·∫°ng th√°i giao d·ªãch, xem
[T∆∞∆°ng t√°c v·ªõi Solana](/docs/payments/interacting-with-solana).

## X·ª≠ l√Ω l·ªói

Solana Kit cung c·∫•p c√°c l·ªói c√≥ ki·ªÉu th√¥ng qua `isSolanaError()`. S·ª≠ d·ª•ng m√£ l·ªói
c·ª• th·ªÉ thay v√¨ so kh·ªõp chu·ªói:

```typescript
import {
  isSolanaError,
  SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED,
  SOLANA_ERROR__TRANSACTION_ERROR__INSUFFICIENT_FUNDS_FOR_FEE,
  SOLANA_ERROR__TRANSACTION_ERROR__BLOCKHASH_NOT_FOUND,
  SOLANA_ERROR__INSTRUCTION_ERROR__INSUFFICIENT_FUNDS
} from "@solana/kit";

function handlePaymentError(error: unknown): {
  message: string;
  retryable: boolean;
} {
  // Blockhash expired‚Äîrebuild and retry
  if (
    isSolanaError(error, SOLANA_ERROR__BLOCK_HEIGHT_EXCEEDED) ||
    isSolanaError(error, SOLANA_ERROR__TRANSACTION_ERROR__BLOCKHASH_NOT_FOUND)
  ) {
    return { message: "Transaction expired‚Äîrebuilding", retryable: true };
  }

  // Insufficient SOL for fees
  if (
    isSolanaError(
      error,
      SOLANA_ERROR__TRANSACTION_ERROR__INSUFFICIENT_FUNDS_FOR_FEE
    )
  ) {
    return { message: "Not enough SOL for fees", retryable: false };
  }

  // Insufficient token balance
  if (
    isSolanaError(error, SOLANA_ERROR__INSTRUCTION_ERROR__INSUFFICIENT_FUNDS)
  ) {
    return { message: "Insufficient balance", retryable: false };
  }

  // Unknown error
  console.error("Payment error:", error);
  return { message: "Payment failed‚Äîplease retry", retryable: true };
}
```

**M√£ l·ªói ph·ªï bi·∫øn:**

| M√£ l·ªói                       | Nguy√™n nh√¢n              | Kh·∫Øc ph·ª•c                                                                                                                     |
| ---------------------------- | ------------------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| `BLOCK_HEIGHT_EXCEEDED`      | Blockhash ƒë√£ h·∫øt h·∫°n     | X√¢y d·ª±ng l·∫°i v·ªõi blockhash m·ªõi                                                                                                |
| `BLOCKHASH_NOT_FOUND`        | Kh√¥ng t√¨m th·∫•y blockhash | X√¢y d·ª±ng l·∫°i v·ªõi blockhash m·ªõi                                                                                                |
| `INSUFFICIENT_FUNDS_FOR_FEE` | Kh√¥ng ƒë·ªß SOL             | N·∫°p ti·ªÅn cho ng∆∞·ªùi tr·∫£ ph√≠ ho·∫∑c s·ª≠ d·ª•ng [tr·ª´u t∆∞·ª£ng h√≥a ph√≠](/docs/payments/send-payments/payment-processing/fee-abstraction) |
| `INSUFFICIENT_FUNDS`         | Kh√¥ng ƒë·ªß token           | Ng∆∞·ªùi d√πng c·∫ßn th√™m s·ªë d∆∞                                                                                                     |
| `ACCOUNT_NOT_FOUND`          | Thi·∫øu token account      | T·∫°o ATA trong giao d·ªãch                                                                                                       |

## Giao d·ªãch kh√¥ng ph√≠ gas

Ng∆∞·ªùi d√πng mong ƒë·ª£i thanh to√°n b·∫±ng stablecoin, kh√¥ng ph·∫£i mua SOL ƒë·ªÉ tr·∫£ ph√≠
m·∫°ng. Giao d·ªãch kh√¥ng ph√≠ gas gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y‚Äît∆∞∆°ng t·ª± nh∆∞ c√°ch ng∆∞·ªùi d√πng
Venmo kh√¥ng c·∫ßn nghƒ© v·ªÅ ph√≠ ACH. Xem
[Tr·ª´u t∆∞·ª£ng h√≥a ph√≠](/docs/payments/send-payments/payment-processing/fee-abstraction)
ƒë·ªÉ bi·∫øt c√°ch tri·ªÉn khai ƒë·∫ßy ƒë·ªß.

## B·∫£o m·∫≠t

### Qu·∫£n l√Ω kh√≥a

- **Kh√¥ng bao gi·ªù ƒë·ªÉ l·ªô kh√≥a ri√™ng t∆∞ trong m√£ frontend.** S·ª≠ d·ª•ng k√Ω backend,
  v√≠ ph·∫ßn c·ª©ng, v√≠ ƒëa ch·ªØ k√Ω ho·∫∑c d·ªãch v·ª• qu·∫£n l√Ω kh√≥a.
- **T√°ch bi·ªát v√≠ n√≥ng v√† v√≠ l·∫°nh.** V√≠ n√≥ng cho ho·∫°t ƒë·ªông, v√≠ l·∫°nh cho kho b·∫°c.
- **Sao l∆∞u t·∫•t c·∫£ kh√≥a production.** L∆∞u tr·ªØ b·∫£n sao l∆∞u ƒë∆∞·ª£c m√£ h√≥a ·ªü nhi·ªÅu v·ªã
  tr√≠ an to√†n. M·∫•t kh√≥a ƒë·ªìng nghƒ©a v·ªõi vi·ªác m·∫•t quy·ªÅn truy c·∫≠p vƒ©nh vi·ªÖn.
- **S·ª≠ d·ª•ng kh√≥a kh√°c nhau cho devnet v√† mainnet.** Kh√≥a devnet c·ªßa b·∫°n kh√¥ng
  n√™n l√† kh√≥a mainnet. S·ª≠ d·ª•ng c·∫•u h√¨nh d·ª±a tr√™n m√¥i tr∆∞·ªùng ƒë·ªÉ ƒë·∫£m b·∫£o t·∫£i ƒë√∫ng
  kh√≥a cho t·ª´ng m·∫°ng.

### B·∫£o m·∫≠t RPC

X·ª≠ l√Ω c√°c endpoint RPC nh∆∞ kh√≥a API‚Äîkh√¥ng ƒë·ªÉ l·ªô ch√∫ng trong m√£ frontend n∆°i
ch√∫ng c√≥ th·ªÉ b·ªã tr√≠ch xu·∫•t v√† l·∫°m d·ª•ng. S·ª≠ d·ª•ng proxy backend ho·∫∑c bi·∫øn m√¥i
tr∆∞·ªùng kh√¥ng ƒë∆∞·ª£c ƒë√≥ng g√≥i v√†o m√£ client.

- [QuickNode: Endpoint Security Best Practices](https://www.quicknode.com/guides/quicknode-products/endpoint-security/endpoint-security-best-practices)
- [Helius: Protect Your Solana API Keys: Security Best Practices](https://www.helius.dev/docs/rpc/protect-your-keys)

### Gi√°m s√°t

Theo d√µi c√°c ch·ªâ s·ªë n√†y trong production:

| Ch·ªâ s·ªë                     | L√Ω do                    |
| -------------------------- | ------------------------ |
| T·ª∑ l·ªá giao d·ªãch th√†nh c√¥ng | Ph√°t hi·ªán s·ªõm v·∫•n ƒë·ªÅ     |
| ƒê·ªô tr·ªÖ x√°c nh·∫≠n            | Gi√°m s√°t t√¨nh tr·∫°ng m·∫°ng |
| Chi ph√≠ ph√≠ ∆∞u ti√™n        | Qu·∫£n l√Ω chi ph√≠          |
| T·ª∑ l·ªá l·ªói RPC              | T√¨nh tr·∫°ng nh√† cung c·∫•p  |

Thi·∫øt l·∫≠p c·∫£nh b√°o cho:

- Chuy·ªÉn kho·∫£n v∆∞·ª£t ng∆∞·ª°ng t·ª´ kho b·∫°c
- TƒÉng ƒë·ªôt bi·∫øn t·ª∑ l·ªá giao d·ªãch th·∫•t b·∫°i
- M·∫´u ng∆∞·ªùi nh·∫≠n b·∫•t th∆∞·ªùng
- TƒÉng t·ª∑ l·ªá l·ªói RPC

ƒê·ªÉ gi√°m s√°t giao d·ªãch theo th·ªùi gian th·ª±c ·ªü quy m√¥ l·ªõn, xem
[H∆∞·ªõng d·∫´n l·∫≠p ch·ªâ m·ª•c](/docs/payments/accept-payments/indexing) c·ªßa ch√∫ng t√¥i.

### X√°c minh ƒë·ªãa ch·ªâ

M·ªói token v√† ch∆∞∆°ng tr√¨nh c√≥ ch√≠nh x√°c m·ªôt ƒë·ªãa ch·ªâ ƒë√∫ng tr√™n mainnet. C√°c token
gi·∫£ m·∫°o b·∫Øt ch∆∞·ªõc USDC ho·∫∑c c√°c stablecoin kh√°c r·∫•t ph·ªï bi·∫øn‚Äîch√∫ng s·∫Ω c√≥ c√πng
t√™n v√† k√Ω hi·ªáu nh∆∞ng mint kh√°c. ·ª®ng d·ª•ng c·ªßa b·∫°n n√™n hardcode ho·∫∑c ƒë∆∞a v√†o danh
s√°ch cho ph√©p c√°c ƒë·ªãa ch·ªâ mint (d·ª±a tr√™n y√™u c·∫ßu c·ªßa b·∫°n), kh√¥ng bao gi·ªù ch·∫•p
nh·∫≠n ch√∫ng m·ªôt c√°ch ƒë·ªông t·ª´ c√°c ngu·ªìn kh√¥ng ƒë√°ng tin c·∫≠y.

**C·∫•u h√¨nh d·ª±a tr√™n m√¥i tr∆∞·ªùng:** Devnet v√† Mainnet th∆∞·ªùng s·ª≠ d·ª•ng c√°c token
mint ho√†n to√†n kh√°c nhau. Thi·∫øt l·∫≠p c·∫•u h√¨nh ·ª©ng d·ª•ng c·ªßa b·∫°n ƒë·ªÉ t·∫£i c√°c ƒë·ªãa ch·ªâ
ch√≠nh x√°c cho t·ª´ng m√¥i tr∆∞·ªùng‚Äîƒë·ª´ng hardcode ƒë·ªãa ch·ªâ mainnet v√† qu√™n thay ƒë·ªïi
ch√∫ng trong qu√° tr√¨nh ki·ªÉm th·ª≠, ho·∫∑c t·ªá h∆°n, tri·ªÉn khai ƒë·ªãa ch·ªâ devnet l√™n
production.

M·ªôt s·ªë mint stablecoin ph·ªï bi·∫øn l√†:

| Token | Nh√† ph√°t h√†nh | ƒê·ªãa ch·ªâ mint                                   |
| ----- | ------------- | ---------------------------------------------- |
| USDC  | Circle        | `EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v` |
| USDT  | Tether        | `Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB` |
| PYUSD | PayPal        | `2b1kV6DkPAnxd5ixfnxCpjxmKwqjjaYmCZfHsFu24GXo` |
| USDG  | Paxos         | `2u1tszSeqZ3qBWF3uNGPFc8TzMk2tdiwknnRMWGWjGWH` |

ƒê·ªãa ch·ªâ ch∆∞∆°ng tr√¨nh c≈©ng quan tr·ªçng. G·ª≠i l·ªánh ƒë·∫øn ch∆∞∆°ng tr√¨nh sai s·∫Ω th·∫•t
b·∫°i‚Äîho·∫∑c t·ªá h∆°n, d·∫´n ƒë·∫øn m·∫•t ti·ªÅn kh√¥ng th·ªÉ kh√¥i ph·ª•c. C√°c ƒë·ªãa ch·ªâ Token Program
l√†:

| Ch∆∞∆°ng tr√¨nh       | ƒê·ªãa ch·ªâ                                       |
| ------------------ | --------------------------------------------- |
| Token Program      | `TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA` |
| Token-2022 Program | `TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb` |

## Danh s√°ch ki·ªÉm tra tr∆∞·ªõc khi ra m·∫Øt

- [ ] ƒê√£ c√≥ SOL tr√™n mainnet cho ph√≠ v√† rent
- [ ] ƒê√£ c·∫•u h√¨nh RPC production (kh√¥ng ph·∫£i endpoint c√¥ng khai)
- [ ] ƒê√£ c·∫•u h√¨nh endpoint RPC d·ª± ph√≤ng
- [ ] ƒê√£ tri·ªÉn khai priority fees v·ªõi ƒë·ªãnh gi√° ƒë·ªông
- [ ] Logic th·ª≠ l·∫°i x·ª≠ l√Ω h·∫øt h·∫°n blockhash
- [ ] M·ª©c x√°c nh·∫≠n ph√π h·ª£p v·ªõi tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng
- [ ] T·∫•t c·∫£ l·ªói ph·ªï bi·∫øn ƒë∆∞·ª£c x·ª≠ l√Ω m·ªôt c√°ch m∆∞·ª£t m√†
- [ ] ƒê√£ c·∫•u h√¨nh gasless (n·∫øu c√≥)
- [ ] ƒê√£ x√°c minh ƒë·ªãa ch·ªâ token tr√™n mainnet (kh√¥ng ph·∫£i mint devnet)
- [ ] T·∫•t c·∫£ key ƒë√£ ƒë∆∞·ª£c sao l∆∞u an to√†n
- [ ] ƒê√£ xem x√©t qu·∫£n l√Ω key (kh√¥ng c√≥ key ·ªü frontend)
- [ ] Gi√°m s√°t v√† c·∫£nh b√°o giao d·ªãch ƒëang ho·∫°t ƒë·ªông
- [ ] ƒê√£ ki·ªÉm tra t·∫£i ·ªü kh·ªëi l∆∞·ª£ng d·ª± ki·∫øn

## Tri·ªÉn khai ch∆∞∆°ng tr√¨nh

N·∫øu b·∫°n ƒëang tri·ªÉn khai m·ªôt ch∆∞∆°ng tr√¨nh Solana t√πy ch·ªânh nh∆∞ m·ªôt ph·∫ßn c·ªßa c∆° s·ªü
h·∫° t·∫ßng thanh to√°n, c√≥ m·ªôt s·ªë c√¢n nh·∫Øc b·ªï sung.

### Tr∆∞·ªõc khi tri·ªÉn khai

- **Phi√™n b·∫£n Solana CLI:** ƒê·∫£m b·∫£o b·∫°n ƒëang s·ª≠ d·ª•ng phi√™n b·∫£n m·ªõi nh·∫•t c·ªßa
  [Solana CLI](https://solana.com/docs/intro/installation).
- **Keypair ch∆∞∆°ng tr√¨nh:** Ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n s·∫Ω c√≥ ƒë·ªãa ch·ªâ kh√°c tr√™n mainnet
  so v·ªõi devnet (tr·ª´ khi b·∫°n s·ª≠ d·ª•ng l·∫°i c√πng m·ªôt keypair). C·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c
  tham chi·∫øu trong c·∫•u h√¨nh ·ª©ng d·ª•ng c·ªßa b·∫°n. L∆∞u tr·ªØ keypair ch∆∞∆°ng tr√¨nh c·ªßa
  b·∫°n ·ªü m·ªôt v·ªã tr√≠ an to√†n (l∆∞u √Ω r·∫±ng vi·ªác ch·∫°y `cargo clean` c√≥ th·ªÉ s·∫Ω x√≥a
  keypair ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n).
- **Kh·ªüi t·∫°o t√†i kho·∫£n:** N·∫øu ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n y√™u c·∫ßu t√†i kho·∫£n qu·∫£n tr·ªã,
  PDA ho·∫∑c c√°c t√†i kho·∫£n tr·∫°ng th√°i kh√°c, h√£y ƒë·∫£m b·∫£o ch√∫ng ƒë∆∞·ª£c t·∫°o tr√™n
  mainnet tr∆∞·ªõc khi ng∆∞·ªùi d√πng t∆∞∆°ng t√°c v·ªõi ·ª©ng d·ª•ng c·ªßa b·∫°n. T∆∞∆°ng t·ª± cho b·∫•t
  k·ª≥ Associated Token Account (ATA) n√†o m√† ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n c·∫ßn.

### Quy tr√¨nh tri·ªÉn khai

- **T√†i kho·∫£n buffer:** C√°c ch∆∞∆°ng tr√¨nh l·ªõn tri·ªÉn khai th√¥ng qua t√†i kho·∫£n
  buffer. L·ªánh `solana program deploy` x·ª≠ l√Ω ƒëi·ªÅu n√†y t·ª± ƒë·ªông, nh∆∞ng h√£y hi·ªÉu
  r·∫±ng vi·ªác tri·ªÉn khai kh√¥ng ph·∫£i l√† nguy√™n t·ª≠‚Äîn·∫øu b·ªã gi√°n ƒëo·∫°n, b·∫°n c√≥ th·ªÉ c·∫ßn
  kh√¥i ph·ª•c ho·∫∑c ƒë√≥ng c√°c t√†i kho·∫£n buffer. Xem
  [Deploying Programs](https://solana.com/docs/programs/deploying).
- **Quy·ªÅn n√¢ng c·∫•p:** Quy·∫øt ƒë·ªãnh xem ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n c√≥ n√™n ƒë∆∞·ª£c n√¢ng c·∫•p
  sau khi ra m·∫Øt hay kh√¥ng. ƒê·ªÉ ƒë·∫£m b·∫£o t√≠nh b·∫•t bi·∫øn, h√£y thu h·ªìi quy·ªÅn n√¢ng c·∫•p
  sau khi tri·ªÉn khai. ƒê·ªÉ linh ho·∫°t, h√£y b·∫£o m·∫≠t kh√≥a quy·ªÅn n√¢ng c·∫•p m·ªôt c√°ch
  th√≠ch h·ª£p.
- **Rent:** ƒê·∫£m b·∫£o v√≠ tri·ªÉn khai c·ªßa b·∫°n c√≥ ƒë·ªß SOL ƒë·ªÉ chi tr·∫£ m·ª©c t·ªëi thi·ªÉu
  mi·ªÖn rent cho t·∫•t c·∫£ c√°c t√†i kho·∫£n ch∆∞∆°ng tr√¨nh.
- **X√°c minh:** [X√°c minh](https://solana.com/docs/programs/verified-builds)
  ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n ƒë·ªÉ ƒë·∫£m b·∫£o r·∫±ng ch∆∞∆°ng tr√¨nh th·ª±c thi m√† b·∫°n tri·ªÉn khai
  l√™n m·∫°ng Solana kh·ªõp v·ªõi m√£ ngu·ªìn trong kho l∆∞u tr·ªØ c·ªßa b·∫°n

ƒê·ªÉ c√≥ h∆∞·ªõng d·∫´n ƒë·∫ßy ƒë·ªß v·ªÅ tri·ªÉn khai ch∆∞∆°ng tr√¨nh, xem
[Deploying Programs](https://solana.com/docs/programs/deploying).
