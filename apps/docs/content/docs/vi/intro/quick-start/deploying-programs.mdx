---
title: Triển khai một Program
description:
  Học cách xây dựng, triển khai và kiểm thử chương trình Solana đầu tiên của bạn
  bằng framework Anchor và Solana Playground. Hướng dẫn thân thiện với người mới
  này sẽ hướng dẫn tạo một chương trình đơn giản, triển khai lên devnet, chạy
  kiểm thử và đóng chương trình.
h1: Triển khai chương trình Solana đầu tiên của bạn
---

Xây dựng, triển khai và kiểm thử [program](/docs/core/programs) đầu tiên của bạn
lên Blockchain Solana bằng framework Anchor. Hướng dẫn này sẽ giúp bạn làm quen
với Solana Playground và chuẩn bị cho bạn sử dụng Program Derived Address (PDA)
và Cross Program Invocation (CPI).

<Steps>

<Step>

### Tạo dự án Anchor

1. Mở [Solana Playground](https://beta.solpg.io) trong trình duyệt web của bạn
2. Ở bảng điều khiển bên trái, nhấp vào **+ Create a new project**
3. Nhập **Project name**
4. Chọn **Anchor (Rust)** làm framework
5. Nhấp vào **Create**

![Dự án mới](/assets/docs/intro/quickstart/pg-new-project.gif)

Tệp nguồn `src/lib.rs` sẽ mở ra. Nó chứa một struct có tên `Initialize`, thực
hiện các chức năng sau:

- Nhận một tham số bắt buộc có tên _rs`data: u64`_
- Tạo một tài khoản mới
- Lưu giá trị của _rs`data: u64`_ vào tài khoản mới
- Thêm một thông báo vào program logs của giao dịch

<WithNotes>

```rust title="lib.rs"
use anchor_lang::prelude::*;

// This is your program's public key and it will update
// automatically when you build the project.
// !tooltip[/declare_id/] declare_id
declare_id!("11111111111111111111111111111111");

// !tooltip[/program/] program
#[program]
mod hello_anchor {
    use super::*;
    // !tooltip[/data: u64/] parameter
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !tooltip[/ctx.accounts.new_account.data = data/] initialize
        ctx.accounts.new_account.data = data;
        // !tooltip[/msg!/] msg
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}

// !tooltip[/Accounts/] accounts
#[derive(Accounts)]
pub struct Initialize<'info> {
    // We must specify the space in order to initialize an account.
    // First 8 bytes are default account discriminator,
    // next 8 bytes come from NewAccount.data being type u64.
    // (u64 = 64 bits unsigned integer = 8 bytes)
    // !tooltip[/account/] constraints
    #[account(
      // !tooltip[/init/] init
      init,
      // !tooltip[/payer/] payer
      payer = signer,
      // !tooltip[/space/] space
      space = 8 + 8
    )]
    pub new_account: Account<'info, NewAccount>,
    // !tooltip[/account/] constraints
    #[account(mut)]
    pub signer: Signer<'info>,
    pub system_program: Program<'info, System>,
}

// !tooltip[/account/] account
#[account]
pub struct NewAccount {
    data: u64
}
```

### !declare_id

Địa chỉ on-chain của chương trình của bạn. Nó sẽ được cập nhật khi bạn xây dựng
dự án

### !program

Module chứa các chỉ thị của chương trình

### !accounts

Chú thích một struct chứa các tài khoản của chương trình

### !account

Một struct đại diện cho kiểu dữ liệu tài khoản mà chương trình này có thể tạo và
sở hữu

### !constraints

Các ràng buộc tài khoản. Ví dụ, các kiểm tra thông thường hoặc tính năng nâng
cao bảo mật chương trình

### !parameter

Giá trị được truyền vào chỉ thị khi nó được gọi

### !initialize

Truy cập trường `data` của tài khoản `new_account` và đặt nó thành giá trị của
`data: u64`

### !msg

Macro _rs`msg!`_ ghi một thông báo vào program logs của giao dịch

### !init

Gọi System Program để tạo một tài khoản mới và đặt chương trình này làm chủ sở
hữu. Với tư cách là chủ sở hữu chương trình, chương trình này sau đó có thể ghi
vào dữ liệu tài khoản

### !payer

Tài khoản thanh toán cho tài khoản mới

### !space

Số byte cần cấp phát cho tài khoản

</WithNotes>

<Accordions>

<Accordion title="Giải thích">

<WithMentions>

- Macro [`declare_id!`](mention:one) chỉ định địa chỉ on-chain của chương trình
  của bạn. Solana Playground sẽ tự động cập nhật địa chỉ này khi bạn build
  chương trình.

```rs
// !mention one
declare_id!("11111111111111111111111111111111");
```

</WithMentions>

<WithMentions>

- Thuộc tính [`#[program]`](mention:one) chú thích một module chứa các hàm đại
  diện cho các instruction của chương trình.

```rs
// !mention one
#[program]
mod hello_anchor {
    use super::*;
    // !mention two
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !mention three
        ctx.accounts.new_account.data = data;
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}
```

Trong ví dụ này, instruction [`initialize`](mention:two) nhận hai tham số:

- `ctx: Context<Initialize>`: Truyền các tài khoản cần thiết cho instruction này
  vào hàm, như được chỉ định trong struct `Initialize`.
- `data: u64`: Một tham số tùy chỉnh mà bạn phải cung cấp khi gọi instruction.

Thân hàm [đặt trường `data` của `new_account`](mention:three) thành đối số
`data` được cung cấp, sau đó in một thông báo vào program logs.

</WithMentions>

<WithMentions>

- Thuộc tính [`#[derive(Accounts)]`](mention:one) định nghĩa một struct chỉ định
  các tài khoản cần thiết cho một instruction cụ thể. Mỗi trường đại diện cho
  một tài khoản riêng biệt.

  Anchor tự động xử lý các kiểm tra bảo mật thông thường liên quan đến xác thực
  tài khoản thông qua các kiểu trường (ví dụ: `Signer<'info>`) và các ràng buộc
  (ví dụ: `#[account(mut)]`).

  ```rs
  // !mention one
  #[derive(Accounts)]
  pub struct Initialize<'info> {
      #[account(init, payer = signer, space = 8 + 8)]
      pub new_account: Account<'info, NewAccount>,
      #[account(mut)]
      pub signer: Signer<'info>,
      pub system_program: Program<'info, System>,
  }
  ```

</WithMentions>

<WithMentions>

- Thuộc tính [`#[account]`](mention:one) định nghĩa một struct đại diện cho kiểu
  dữ liệu cho các tài khoản mà chương trình này tạo và sở hữu.

```rs
// !mention one
#[account]
pub struct NewAccount {
  data: u64
}
```

</WithMentions>

</Accordion>
</Accordions>

</Step>

<Step>

### Xây dựng và triển khai chương trình

1. Biên dịch mã chương trình

```terminal
$ build
Building...
Build successful. Completed in 1.46s.
```

<Callout>
  [ID chương trình](/docs/intro/quick-start/deploying-programs) của bạn, được
  định nghĩa trong _rs`declare_id!()`_, giờ đây sẽ được cập nhật.
</Callout>

2. Thêm SOL vào ví của bạn _(Tùy chọn)_

Việc triển khai chương trình đòi hỏi SOL trong tài khoản on-chain của chương
trình. Nếu cần thiết,
[thêm SOL vào ví của bạn](/docs/intro/quick-start#add-sol-to-your-wallet) trước
khi tiếp tục bước 3.

3. Triển khai chương trình lên mạng

```terminal
$ deploy
Deploying... This could take a while depending on the program size and network conditions.
Warning: 1 transaction not confirmed, retrying...
Deployment successful. Completed in 19s.
```

<Callout type="info">
  Khi được triển khai, bytecode của chương trình được lưu trữ trong một program
  account có thể thực thi.
</Callout>

**Lưu ý:** Nếu muốn, bạn có thể sử dụng các nút **Build** và **Deploy** trên
bảng điều khiển bên trái, như được hiển thị trong ảnh chụp màn hình dưới đây.

![Build và Deploy](/assets/docs/intro/quickstart/pg-build-deploy.png)

</Step>

<Step>

### Kiểm tra chương trình

<WithMentions>

1. Mở file test có tên `tests/anchor.test.ts`. File này minh họa cách gọi struct
   [`initialize`](mention:one) của chương trình từ phía client.

```ts title="anchor.test.ts"
// No imports needed: web3, anchor, pg and more are globally available

describe("Test", () => {
  it("initialize", async () => {
    // Generate keypair for the new account
    const newAccountKp = new web3.Keypair();

    // Send transaction
    const data = new BN(42);
    const txHash = await pg.program.methods
      // !mention one
      .initialize(data)
      .accounts({
        newAccount: newAccountKp.publicKey,
        signer: pg.wallet.publicKey,
        systemProgram: web3.SystemProgram.programId
      })
      .signers([newAccountKp])
      .rpc();
    console.log(`Use 'solana confirm -v ${txHash}' to see the logs`);

    // Confirm transaction
    await pg.connection.confirmTransaction(txHash);

    // Fetch the created account
    const newAccount = await pg.program.account.newAccount.fetch(
      newAccountKp.publicKey
    );

    console.log("On-chain data is:", newAccount.data.toString());

    // Check whether the data on-chain is equal to local 'data'
    assert(data.eq(newAccount.data));
  });
});
```

</WithMentions>

2. Chạy tệp kiểm thử

```terminal
$ test
Running tests...
  hello_anchor.test.ts:
  hello_anchor
    Use 'solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc' to see the logs
    On-chain data is: 42
    ✔ initialize (961ms)
  1 passing (963ms)
```

3. Lưu transaction hash (`TxHash`) có trong kết quả đầu ra

(Trong ví dụ trên, transaction hash là
`3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc`.)

**Lưu ý:** Nếu muốn, bạn có thể sử dụng nút `Test` ở bảng điều khiển bên trái.

![Chạy kiểm thử](/assets/docs/intro/quickstart/pg-test.png)

4. Chạy `solana confirm -v [TxHash]` để xem các log của transaction

```terminal
$ solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
RPC URL: https://api.devnet.solana.com
Default Signer: Playground Wallet
Commitment: confirmed

Transaction executed in slot 308150984:
  Block Time: 2024-06-25T12:52:05-05:00
  Version: legacy
  Recent Blockhash: 7AnZvY37nMhCybTyVXJ1umcfHSZGbngnm4GZx6jNRTNH
  Signature 0: 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
  Signature 1: 3TrRbqeMYFCkjsxdPExxBkLAi9SB2pNUyg87ryBaTHzzYtGjbsAz9udfT9AkrjSo1ZjByJgJHBAdRVVTZv6B87PQ
  Account 0: srw- 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (fee payer)
  Account 1: srw- c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J
  Account 2: -r-- 11111111111111111111111111111111
  Account 3: -r-x 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
  Instruction 0
    Program:   2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r (3)
    Account 0: c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J (1)
    Account 1: 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (0)
    Account 2: 11111111111111111111111111111111 (2)
    Data: [175, 175, 109, 31, 13, 152, 155, 237, 42, 0, 0, 0, 0, 0, 0, 0]
  Status: Ok
    Fee: ◎0.00001
    Account 0 balance: ◎5.47001376 -> ◎5.46900152
    Account 1 balance: ◎0 -> ◎0.00100224
    Account 2 balance: ◎0.000000001
    Account 3 balance: ◎0.00139896
  Log Messages:
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r invoke [1]
    Program log: Instruction: Initialize
    Program 11111111111111111111111111111111 invoke [2]
    Program 11111111111111111111111111111111 success
    Program log: Changed data to: 42!
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r consumed 5661 of 200000 compute units
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r success

Confirmed
```

4. Xem chi tiết giao dịch

Mở [SolanaFM](https://solana.fm/) hoặc
[Solana Explorer](https://explorer.solana.com/?cluster=devnet) và tìm kiếm mã
băm giao dịch.

<Callout type="warn">
  **Solana Explorer:** Đặt network cluster thành `devnet`, để khớp với Solana
  Playground.
</Callout>

</Step>

<Step>

### Đóng chương trình

Đóng chương trình để thu hồi SOL đã phân bổ cho chương trình on-chain. Để làm
điều này, chạy `solana program close [ProgramID]`, sử dụng địa chỉ chương trình
được lưu trong macro _rs`declare_id!()`_.

```terminal
$ solana program close 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
Closed Program Id 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r, 2.79511512 SOL reclaimed
```

<Callout type="warn">
  Chương trình **chỉ** có thể được đóng hoặc cập nhật bởi tài khoản có quyền
  nâng cấp. Ví Playground của bạn tự động trở thành người có quyền nâng cấp cho
  mỗi chương trình khi nó được triển khai. Nếu quyền nâng cấp bị thu hồi, chương
  trình sẽ trở nên bất biến.
</Callout>

Chúc mừng! Bạn đã xây dựng và triển khai chương trình Solana đầu tiên của mình
bằng Anchor.

</Step>

</Steps>

## Các bước tiếp theo

Giờ đây bạn đã triển khai chương trình đầu tiên của mình, bạn đã sẵn sàng để
khám phá
[địa chỉ dẫn xuất từ chương trình](/docs/intro/quick-start/program-derived-address)
và
[gọi chéo giữa các chương trình](/docs/intro/quick-start/cross-program-invocation).
