---
title: Ohjelmasta johdettu osoite
description:
  Opi Solanan ohjelmasta johdetuista osoitteista (PDA) — deterministiset
  tiliosoitteet, jotka mahdollistavat turvallisen ohjelman allekirjoittamisen.
  Ymmärrä PDA:n johtaminen, kanoninen bump-arvo ja miten luoda PDA-tilejä.
---

Solanan [tiliosoite](/docs/core/accounts#account-address) osoittaa tilin
sijaintiin lohkoketjussa. Monet tiliosoitteet ovat avainparin julkinen avain,
jolloin vastaavaa yksityistä avainta käytetään tiliin liittyvien tapahtumien
allekirjoittamiseen.

Hyödyllinen vaihtoehto julkisen avaimen osoitteelle on ohjelmasta johdettu
osoite (PDA). PDA:t tarjoavat helpon tavan tallentaa, kartoittaa ja hakea
ohjelman tilaa. PDA on osoite, joka luodaan deterministisesti käyttäen
ohjelmatunnusta ja yhdistelmää valinnaisia ennalta määritettyjä syötteitä. PDA:t
näyttävät samanlaisilta kuin julkisen avaimen osoitteet, mutta niillä ei ole
vastaavaa yksityistä avainta.

Solanan ajoympäristö mahdollistaa ohjelmien allekirjoittaa PDA:iden puolesta
ilman yksityistä avainta. PDA:n käyttö poistaa tarpeen seurata tilin osoitetta.
Sen sijaan voit palauttaa mieleen tietyt syötteet, joita käytettiin PDA:n
johtamiseen. (Saadaksesi tietää, miten ohjelmat käyttävät PDA:ita
allekirjoittamiseen, katso [Ohjelmien väliset kutsut](/docs/core/cpi) -osio.)

## Tausta

Solanan
[avainparit](https://github.com/anza-xyz/solana-sdk/blob/sdk%40v2.2.2/keypair/src/lib.rs#L26)
ovat pisteitä [Ed25519-käyrällä](https://ed25519.cr.yp.to/) (elliptisen käyrän
salaus). Ne koostuvat julkisesta avaimesta ja yksityisestä avaimesta. Julkisesta
avaimesta tulee tilin osoite, ja yksityistä avainta käytetään tilin kelvollisten
[allekirjoitusten](/docs/core/transactions#signatures) luomiseen.

![Kaksi tiliä käyrällä olevilla osoitteilla](/assets/docs/core/pda/address-on-curve.svg)

PDA on tarkoituksella johdettu Ed25519-käyrän ulkopuolelle. Tämä tarkoittaa,
että sillä ei ole kelvollista vastaavaa yksityistä avainta eikä se voi suorittaa
kryptografisia toimintoja. (Kuten allekirjoituksen tarjoaminen.) Solana
kuitenkin mahdollistaa ohjelmien allekirjoittaa PDA:iden puolesta ilman
yksityistä avainta.

![Off Curve Address](/assets/docs/core/pda/address-off-curve.svg)

Voit ajatella PDA:ita tapana luoda hajautustaulun kaltaisia rakenteita
lohkoketjussa käyttäen ennalta määritettyä joukkoa syötteitä. (Esimerkiksi
merkkijonoja, numeroita ja muita tilien osoitteita.)

![Program Derived Address](/assets/docs/core/pda/pda.svg)

## PDA:n johtaminen

Ennen kuin luot tilin PDA:lla, sinun on ensin johdettava osoite. PDA:n
johtaminen _ei_ automaattisesti luo lohkoketjuun tiliä kyseiseen osoitteeseen –
tili on nimenomaisesti luotava PDA:n johtamiseen käytetyn ohjelman kautta. Voit
ajatella PDA:ta kuin osoitetta kartalla: vain koska osoite on olemassa, ei
tarkoita, että sinne on rakennettu mitään.

Solana SDK:t tukevat PDA:n luomista alla olevassa taulukossa näytetyillä
funktioilla. Jokainen funktio vastaanottaa seuraavat syötteet:

- **Program ID**: Sen ohjelman osoite, jota käytetään PDA:n johtamiseen. Tämä
  ohjelma voi allekirjoittaa PDA:n puolesta.
- **Optional seeds**: Ennalta määritellyt syötteet, kuten merkkijonot, numerot
  tai muut tilien osoitteet.

| SDK                            | Funktio                                                                                                                          |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| `@solana/kit` (Typescript)     | [`getProgramDerivedAddress`](https://github.com/anza-xyz/kit/blob/v2.1.0/packages/addresses/src/program-derived-address.ts#L157) |
| `@solana/web3.js` (Typescript) | [`findProgramAddressSync`](https://github.com/solana-foundation/solana-web3.js/blob/v1.98.0/src/publickey.ts#L212)               |
| `solana_sdk` (Rust)            | [`find_program_address`](https://github.com/anza-xyz/solana-sdk/blob/sdk%40v2.2.2/pubkey/src/lib.rs#L617)                        |

Funktio käyttää program ID:tä ja valinnaisia seedejä, ja käy sitten läpi
bump-arvoja yrittäen luoda kelvollisen ohjelma-osoitteen. Bump-arvojen
läpikäynti alkaa arvosta 255 ja vähenee yhdellä, kunnes kelvollinen PDA löytyy.
Kun kelvollinen PDA on löydetty, funktio palauttaa PDA:n ja bump seedin.

<Callout>
  Bump seed on ylimääräinen tavu, joka lisätään valinnaisiin seedeihin
  varmistaakseen, että luodaan kelvollinen off-curve-osoite.
</Callout>

![PDA-johtaminen](/assets/docs/core/pda/pda-derivation.svg)

### Kanoninen bump

Bump seed on ylimääräinen tavu, joka lisätään valinnaisiin seed-arvoihin.
Johtamisfunktio käy läpi bump-arvoja alkaen arvosta 255 ja vähentäen arvoa
yhdellä, kunnes arvo tuottaa kelvollisen käyrän ulkopuolisen osoitteen.
Ensimmäistä arvoa, joka tuottaa kelvollisen käyrän ulkopuolisen osoitteen,
kutsutaan "kanoniseksi bumpiksi".

Seuraavat esimerkit näyttävät PDA-johtamisen käyttäen kaikkia mahdollisia bump
seed -arvoja (255-0):

<Callout type="info">
  Kit-esimerkkiä ei ole sisällytetty, koska
  [createProgramDerivedAddress](https://github.com/anza-xyz/kit/blob/v2.1.0/packages/addresses/src/program-derived-address.ts#L101)
  -funktiota ei ole viety.
</Callout>

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programId = new PublicKey("11111111111111111111111111111111");
const optionalSeed = "helloWorld";

// Loop through all bump seeds (255 down to 0)
for (let bump = 255; bump >= 0; bump--) {
  try {
    const PDA = PublicKey.createProgramAddressSync(
      [Buffer.from(optionalSeed), Buffer.from([bump])],
      programId
    );
    console.log("bump " + bump + ": " + PDA);
  } catch (error) {
    console.log("bump " + bump + ": " + error);
  }
}
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_id = Pubkey::from_str("11111111111111111111111111111111")?;
    let optional_seed = b"helloWorld";

    // Loop through all bump seeds (255 down to 0)
    for bump in (0..=255).rev() {
        match Pubkey::create_program_address(&[optional_seed.as_ref(), &[bump]], &program_id) {
            Ok(pda) => println!("bump {}: {}", bump, pda),
            Err(err) => println!("bump {}: {}", bump, err),
        }
    }

    Ok(())
}
```

</CodeTabs>

<CodeTabs>

```sh !! title="Expected TS Output"
bump 255: Error: Invalid seeds, address must fall off the curve
bump 254: 46GZzzetjCURsdFPb7rcnspbEMnCBXe9kpjrsZAkKb6X
bump 253: GBNWBGxKmdcd7JrMnBdZke9Fumj9sir4rpbruwEGmR4y
bump 252: THfBMgduMonjaNsCisKa7Qz2cBoG1VCUYHyso7UXYHH
bump 251: EuRrNqJAofo7y3Jy6MGvF7eZAYegqYTwH2dnLCwDDGdP
bump 250: Error: Invalid seeds, address must fall off the curve
...
// remaining bump outputs
```

```sh !! title="Expected Rust Output"
bump 255: Provided seeds do not result in a valid address
bump 254: 46GZzzetjCURsdFPb7rcnspbEMnCBXe9kpjrsZAkKb6X
bump 253: GBNWBGxKmdcd7JrMnBdZke9Fumj9sir4rpbruwEGmR4y
bump 252: THfBMgduMonjaNsCisKa7Qz2cBoG1VCUYHyso7UXYHH
bump 251: EuRrNqJAofo7y3Jy6MGvF7eZAYegqYTwH2dnLCwDDGdP
bump 250: Provided seeds do not result in a valid address
...
// remaining bump outputs
```

</CodeTabs>

Tässä esimerkissä ensimmäinen bump seed aiheuttaa virheen. Ensimmäinen bump
seed, joka johtaa kelvolliseen PDA:han, on 254. Bump seed -arvot 253-251
johtavat myös yksilöllisiin, kelvollisiin PDA:ihin.

Tämä tarkoittaa, että samoilla valinnaisilla seed-arvoilla ja `programId`:lla
bump seed, jolla on eri arvo, voi silti johtaa kelvollisen PDA:n.

<Callout type="warn">
  Sisällytä aina turvallisuustarkistukset varmistaaksesi, että ohjelmalle
  välitetty PDA on johdettu kanonisesta bumpista. Jos näin ei tehdä, voi syntyä
  haavoittuvuuksia, jotka mahdollistavat odottamattomien tilien käytön ohjelman
  ohjeissa. Parhaana käytäntönä on käyttää vain kanonista bumpia PDA:ita
  johdettaessa.
</Callout>

### Esimerkkejä

Alla olevat esimerkit johtavat PDA:n käyttäen Solana SDK:ta. Napsauta **&#9655;
Run** suorittaaksesi koodin.

#### PDA:n johtaminen merkkijonon seedillä

Alla oleva esimerkki johtaa PDA:n käyttäen ohjelmatunnusta ja valinnaista
merkkijonon seediä.

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Kit"
import { Address, getProgramDerivedAddress } from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus
const seeds = ["helloWorld"];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");
// !focus
const seeds = [Buffer.from("helloWorld")];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus
    let seeds: &[&[u8]] = &[b"helloWorld"];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

#### PDA:n johtaminen osoitteen seedillä

Alla oleva esimerkki johtaa PDA:n käyttäen ohjelmatunnusta ja valinnaista
osoitteen seediä.

<CodeTabs storage="pda-examples"flags="r">

```ts !! title="Kit"
import {
  Address,
  getAddressEncoder,
  getProgramDerivedAddress
} from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus(1:4)
const addressEncoder = getAddressEncoder();
const optionalSeedAddress = addressEncoder.encode(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka" as Address
);
const seeds = [optionalSeedAddress];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");

// !focus(1:3)
const optionalSeedAddress = new PublicKey(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka"
);
const seeds = [optionalSeedAddress.toBuffer()];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus
    let optional_seed_address = Pubkey::from_str("B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka")?;
    let seeds: &[&[u8]] = &[optional_seed_address.as_ref()];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

#### PDA:n johtaminen useilla sedeillä

Alla oleva esimerkki johtaa PDA:n käyttäen ohjelmatunnusta ja useita valinnaisia
seedejä.

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Kit"
import {
  Address,
  getAddressEncoder,
  getProgramDerivedAddress
} from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus(1:5)
const optionalSeedString = "helloWorld";
const addressEncoder = getAddressEncoder();
const optionalSeedAddress = addressEncoder.encode(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka" as Address
);
const seeds = [optionalSeedString, optionalSeedAddress];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");
// !focus(1:4)
const optionalSeedString = "helloWorld";
const optionalSeedAddress = new PublicKey(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka"
);
const seeds = [Buffer.from(optionalSeedString), optionalSeedAddress.toBuffer()];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus(1:2)
    let optional_seed_bytes = b"helloWorld";
    let optional_seed_address = Pubkey::from_str("B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka")?;
    let seeds: &[&[u8]] = &[optional_seed_bytes, optional_seed_address.as_ref()];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

## PDA-tilin luominen

<WithMentions>

Alla oleva esimerkki käyttää
[Anchor-frameworkia](https://www.anchor-lang.com/docs) luodakseen uuden tilin
ohjelmasta johdetulla osoitteella. Ohjelma sisältää yhden
[`initialize`](mention:initialize)-käskyn uuden tilin luomiseksi, joka tallentaa
[käyttäjän osoitteen](mention:user-address) ja [bump seed](mention:bump)-arvon,
joita käytettiin PDA:n johtamiseen.

```rs title="Program"
use anchor_lang::prelude::*;

declare_id!("75GJVCJNhaukaa2vCCqhreY31gaphv7XTScBChmr1ueR");

#[program]
pub mod pda_account {
    use super::*;

    // !mention initialize
    pub fn initialize(ctx: Context<Initialize>) -> Result<()> {
        let account_data = &mut ctx.accounts.pda_account;
        // store the address of the `user`
        // !mark
        // !mention user-address
        account_data.user = *ctx.accounts.user.key;
        // store the canonical bumpd
        // !mark
        // !mention bump
        account_data.bump = ctx.bumps.pda_account;
        Ok(())
    }
}

#[derive(Accounts)]
pub struct Initialize<'info> {
    #[account(mut)]
    // !mention user-address
    pub user: Signer<'info>,

    #[account(
        init,
        // define the seeds to derive the PDA
        // !mark
        // !mention user-address
        seeds = [b"data", user.key().as_ref()],
        // use the canonical bump
        // !mark
        // !mention bump
        bump,
        payer = user,
        space = 8 + DataAccount::INIT_SPACE
    )]
    pub pda_account: Account<'info, DataAccount>,
    pub system_program: Program<'info, System>,
}

#[account]
#[derive(InitSpace)]
pub struct DataAccount {
    // !mark
    // !mention user-address
    pub user: Pubkey,
    // !mark
    // !mention bump
    pub bump: u8,
}
```

</WithMentions>

<WithMentions>

[`init`](mention:init)-rajoite kertoo Anchorille
[kutsua System Programia](/docs/core/programs#the-system-program) luodakseen
uuden tilin käyttäen PDA:ta osoitteena. PDA:n luomiseen käytetyt
[seed-arvot](mention:seeds) ovat:

- Ohjeessa annetun käyttäjätilin osoite
- Kiinteä merkkijono: "data"
- Kanoninen [bump seed](mention:bump)

Tässä esimerkissä bump-rajoitteelle ei ole määritetty arvoa, joten Anchor
käyttää `find_program_address`:ia johtaakseen PDA:n ja löytääkseen bump-arvon.

```rust title="pda_account"
#[account(
    // !mention init
    init,
    // !mention seeds
    seeds = [b"data", user.key().as_ref()],
    // !mention bump
    bump,
    payer = user,
    space = 8 + DataAccount::INIT_SPACE
)]
pub pda_account: Account<'info, DataAccount>,
```

</WithMentions>

<WithMentions>

Alla oleva testitiedosto sisältää transaktion, joka kutsuu
[`initialize`](mention:initialize)-käskyä luodakseen uuden tilin ohjelmasta
johdetulla osoitteella. Tiedosto sisältää koodin
[PDA:n johtamiseksi](mention:pda).

Esimerkki näyttää myös, kuinka [hakea](mention:fetch) uusi tili, joka luodaan.

```ts title="Test"
import * as anchor from "@coral-xyz/anchor";
import { Program } from "@coral-xyz/anchor";
import { PdaAccount } from "../target/types/pda_account";
import { PublicKey } from "@solana/web3.js";

describe("pda-account", () => {
  const provider = anchor.AnchorProvider.env();
  anchor.setProvider(provider);

  const program = anchor.workspace.PdaAccount as Program<PdaAccount>;
  const user = provider.wallet as anchor.Wallet;

  // !mention(1:5) pda
  // Derive the PDA address using the seeds specified on the program
  const [PDA] = PublicKey.findProgramAddressSync(
    [Buffer.from("data"), user.publicKey.toBuffer()],
    program.programId
  );

  it("Is initialized!", async () => {
    const transactionSignature = await program.methods
      // !mention initialize
      .initialize()
      .accounts({
        user: user.publicKey
      })
      .rpc();

    console.log("Transaction Signature:", transactionSignature);
  });

  it("Fetch Account", async () => {
    // !mention fetch
    const pdaAccount = await program.account.dataAccount.fetch(PDA);
    console.log(JSON.stringify(pdaAccount, null, 2));
  });
});
```

</WithMentions>

<Callout type="warn">
  Jos kutsut `initialize`-käskyä uudelleen samalla `user`-osoitteen
  seed-arvolla, transaktio epäonnistuu. Tämä tapahtuu, koska tili on jo olemassa
  johdetussa osoitteessa.
</Callout>
