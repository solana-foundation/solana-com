---
title: Transaktiot
description:
  Opi Solanan transaktioista—perustavanlaatuisista rakennuspalikoista
  Solana-lohkoketjun kanssa vuorovaikuttamiseen. Ymmärrä transaktioiden rakenne
  ja ohjeiden koostaminen käytännön esimerkkien avulla.
---

Vuorovaikuttaaksesi Solana-verkon kanssa sinun täytyy lähettää transaktio. Voit
ajatella transaktiota kirjekuorena, joka sisältää useita lomakkeita. Jokainen
lomake on ohje, joka kertoo verkolle mitä tehdä. Transaktion lähettäminen on
kuin kirjekuoren postittaminen, jotta lomakkeet voidaan käsitellä.

Alla oleva esimerkki näyttää yksinkertaistetun version kahdesta transaktiosta.
Kun ensimmäinen transaktio käsitellään, se suorittaa yhden ohjeen. Kun toinen
transaktio käsitellään, se suorittaa kolme ohjetta **peräkkäisessä
järjestyksessä**: ensin ohje 1, sitten ohje 2 ja lopuksi ohje 3.

<Callout type="warn">
  Transaktiot ovat **atomisia**: Jos yksikin ohje epäonnistuu, koko transaktio
  epäonnistuu eikä muutoksia tapahdu.
</Callout>

![Yksinkertaistettu kaavio, joka näyttää kaksi transaktiota](/assets/docs/core/transactions/transaction-simple.svg)

[`Transaction`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/src/transaction/mod.rs#L207)
koostuu seuraavista tiedoista:

<WithMentions>

- [`signatures`](mention:signatures): Taulukko [allekirjoituksista](#signatures)
- [`message`](mention:message): Transaktiotiedot, mukaan lukien luettelo
  käsiteltävistä ohjeista

```rust title="Transaction"
pub struct Transaction {
    #[wasm_bindgen(skip)]
    #[serde(with = "short_vec")]
    // !mention signatures
    pub signatures: Vec<Signature>,

    #[wasm_bindgen(skip)]
    // !mention message
    pub message: Message,
}
```

</WithMentions>

![Kaavio, joka näyttää transaktion kaksi osaa](/assets/docs/core/transactions/tx_format.png)

Transaktioiden kokonaiskoko on rajoitettu
[1232](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/packet/src/lib.rs#L29)
tavuun. Tämä rajoitus sisältää sekä [`signatures`](#signatures)-taulukon että
[`message`](#message)-rakenteen.

<Callout>
  Tämä rajoitus on suunniteltu välttämään pakettien pirstoutumista tyypillisessä
  internet-infrastruktuurissa. Vaikka IPv6 tukee yli 9000 tavun MTU-arvoja,
  useimmat internet-reitittimet käyttävät 1500 tavun oletusarvoista MTU:ta
  (standardi Ethernet). Varmistaakseen, että transaktiot mahtuvat yhteen
  pakettiin ilman pirstoutumista, Solana käyttää 1280 tavua (IPv6:n vaatima
  vähimmäis-MTU) vähennettynä 48 tavulla verkko-otsikoita varten (40 tavua IPv6
  + 8 tavua fragmentti/UDP-otsikko), mikä johtaa 1232 tavun transaktiokoon
  rajoitukseen.
</Callout>

![Kaavio, joka näyttää transaktion muodon ja kokorajoitukset](/assets/docs/core/transactions/issues_with_legacy_txs.png)

## Allekirjoitukset

Transaktion `signatures` -taulukko sisältää `Signature` -rakenteita. Jokainen
[`Signature`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/signature/src/lib.rs#L30)
on 64 tavua ja luodaan allekirjoittamalla transaktion `Message` tilin
yksityisellä avaimella. Allekirjoitus on annettava jokaiselle
[allekirjoittajatilille](#account-addresses), joka sisältyy mihin tahansa
transaktion ohjeista.

Ensimmäinen allekirjoitus kuuluu tilille, joka maksaa transaktion
[perusmaksun](/docs/core/fees#base-fee), ja se on transaktion allekirjoitus.
Transaktion allekirjoitusta voidaan käyttää transaktion tietojen hakemiseen
verkosta.

## Viesti

Transaktion `message` on
[`Message`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L131)
-rakenne, joka sisältää seuraavat tiedot:

<WithMentions>

- [`header`](mention:message-header): Viestin [otsikko](#header)
- [`account_keys`](mention:account-addresses): Taulukko
  [tiliosoitteista](#account-addresses), joita transaktion ohjeet vaativat
- [`recent_blockhash`](mention:recent-blockhash):
  [Lohkohajautusarvo](#recent-blockhash), joka toimii transaktion aikaleimana
- [`instructions`](mention:instructions): Taulukko [ohjeista](#instructions)

<Callout>
  Tilan säästämiseksi transaktio ei tallenna kunkin tilin käyttöoikeuksia
  erikseen. Sen sijaan tilin käyttöoikeudet määritetään käyttämällä `header`
  -otsikkoa ja `account_keys` -taulukkoa.
</Callout>

```rust title="Message"
pub struct Message {
    /// The message header, identifying signed and read-only `account_keys`.
    // !mention message-header
    pub header: MessageHeader,

    /// All the account keys used by this transaction.
    #[serde(with = "short_vec")]
    // !mention account-addresses
    pub account_keys: Vec<Pubkey>,

    /// The id of a recent ledger entry.
    // !mention recent-blockhash
    pub recent_blockhash: Hash,

    /// Programs that will be executed in sequence and committed in
    /// one atomic transaction if all succeed.
    #[serde(with = "short_vec")]
    // !mention instructions
    pub instructions: Vec<CompiledInstruction>,
}
```

</WithMentions>

### Otsikko

<WithMentions>

Viestin `header` on
[`MessageHeader`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/mod.rs#L97)
-rakenne. Se sisältää seuraavat tiedot:

- [`num_required_signatures`](mention:num_required_signatures): Transaktion
  vaatimien allekirjoitusten kokonaismäärä
- [`num_readonly_signed_accounts`](mention:num_readonly_signed_accounts):
  Allekirjoituksia vaativien vain luku -oikeudella olevien tilien kokonaismäärä
- [`num_readonly_unsigned_accounts`](mention:num_readonly_unsigned_accounts):
  Vain luku -oikeudella olevien tilien kokonaismäärä, jotka eivät vaadi
  allekirjoituksia

```rust title="MessageHeader"
pub struct MessageHeader {
    /// The number of signatures required for this message to be considered
    /// valid. The signers of those signatures must match the first
    /// `num_required_signatures` of [`Message::account_keys`].
    // !mention num_required_signatures
    pub num_required_signatures: u8,

    /// The last `num_readonly_signed_accounts` of the signed keys are read-only
    /// accounts.
    // !mention num_readonly_signed_accounts
    pub num_readonly_signed_accounts: u8,

    /// The last `num_readonly_unsigned_accounts` of the unsigned keys are
    /// read-only accounts.
    // !mention num_readonly_unsigned_accounts
    pub num_readonly_unsigned_accounts: u8,
}
```

</WithMentions>

![Kaavio, joka näyttää viestin otsikon kolme osaa](/assets/docs/core/transactions/message_header.png)

### Tilien osoitteet

Viestin
[`account_keys`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L138)
on taulukko tiliosoitteista, joka lähetetään
[compact array -muodossa](/docs/references/terminology#compact-array-format).
Taulukon etuliite ilmaisee sen pituuden. Jokainen taulukon kohde on julkinen
avain, joka osoittaa tiliin, jota sen ohjeet käyttävät. `accounts_keys`
-taulukon on oltava täydellinen ja tiukasti järjestetty seuraavasti:

1. Allekirjoittaja + Kirjoitettava
2. Allekirjoittaja + Vain luku
3. Ei allekirjoittaja + Kirjoitettava
4. Ei allekirjoittaja + Vain luku

<Callout>
  Tiukka järjestys mahdollistaa `account_keys` -taulukon yhdistämisen viestin
  [`header`](#header) -tietoihin kunkin tilin käyttöoikeuksien määrittämiseksi.
</Callout>

![Kaavio, joka näyttää tilitietojen järjestyksen](/assets/docs/core/transactions/compat_array_of_account_addresses.png)

### Viimeisin lohkohash

Viestin `recent_blockhash` on hash-arvo, joka toimii tapahtuman aikaleimana ja
estää päällekkäiset tapahtumat. Blockhash vanhenee
[150 lohkon](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/clock/src/lib.rs#L134)
jälkeen. (Vastaa yhtä minuuttia—olettaen, että jokainen lohko on 400 ms.) Lohkon
vanhennuttua tapahtuma on vanhentunut eikä sitä voida käsitellä.

<Callout>
  [`getLatestBlockhash`](/docs/rpc/http/getlatestblockhash) RPC-metodi
  mahdollistaa nykyisen blockhashin ja viimeisen lohkon korkeuden hakemisen,
  jolla blockhash on voimassa.
</Callout>

### Ohjeet

Viestin
[`instructions`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L146)
on taulukko kaikista käsiteltävistä ohjeista, joka lähetetään
[compact array -muodossa](/docs/references/terminology#compact-array-format).
Taulukon etuliite ilmaisee sen pituuden. Jokainen taulukon kohde on
[`CompiledInstruction`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/instruction.rs#L22)
-rakenne ja sisältää seuraavat tiedot:

<WithMentions>

1. [`program_id_index`](mention:program-id-index): Indeksi, joka osoittaa
   osoitteeseen [`account_keys`](#account-addresses) -taulukossa. Tämä arvo
   ilmaisee ohjeen käsittelevän ohjelman osoitteen.
2. [`accounts`](mention:account-indexes): Taulukko indekseistä, jotka osoittavat
   osoitteisiin `account_keys` -taulukossa. Jokainen indeksi osoittaa tilin
   osoitteeseen, joka vaaditaan tälle ohjeelle.
3. [`data`](mention:instruction-data): Tavutaulukko, joka määrittää, mikä ohje
   kutsutaan ohjelmassa. Se sisältää myös kaikki ohjeen vaatimat lisätiedot.
   (Esimerkiksi funktion argumentit)

```rust title="CompiledInstruction"
pub struct CompiledInstruction {
    /// Index into the transaction keys array indicating the program account that executes this instruction.
    // !mention program-id-index
    pub program_id_index: u8,
    /// Ordered indices into the transaction keys array indicating which accounts to pass to the program.
    #[serde(with = "short_vec")]
    // !mention account-indexes
    pub accounts: Vec<u8>,
    /// The program input data.
    #[serde(with = "short_vec")]
    // !mention instruction-data
    pub data: Vec<u8>,
}
```

</WithMentions>

![Ohjeiden kompakti taulukko](/assets/docs/core/transactions/compact_array_of_ixs.png)

## Esimerkki tapahtuman rakenteesta

Seuraava esimerkki näyttää tapahtuman rakenteen, joka sisältää yhden
SOL-siirto-ohjeen.

<CodeTabs storage="sol-transfer" flags="r">

```ts !! title="Kit"
import {
  createSolanaRpc,
  generateKeyPairSigner,
  lamports,
  createTransactionMessage,
  setTransactionMessageFeePayerSigner,
  setTransactionMessageLifetimeUsingBlockhash,
  appendTransactionMessageInstructions,
  pipe,
  signTransactionMessageWithSigners,
  getCompiledTransactionMessageDecoder
} from "@solana/kit";
import { getTransferSolInstruction } from "@solana-program/system";

const rpc = createSolanaRpc("http://localhost:8899");
const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();

// Generate sender and recipient keypairs
const sender = await generateKeyPairSigner();
const recipient = await generateKeyPairSigner();

// Define the amount to transfer
const LAMPORTS_PER_SOL = 1_000_000_000n;
const transferAmount = lamports(LAMPORTS_PER_SOL / 100n); // 0.01 SOL

// Create a transfer instruction for transferring SOL from sender to recipient
const transferInstruction = getTransferSolInstruction({
  source: sender,
  destination: recipient.address,
  amount: transferAmount
});

// Create transaction message
const transactionMessage = pipe(
  createTransactionMessage({ version: 0 }),
  (tx) => setTransactionMessageFeePayerSigner(sender, tx),
  (tx) => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, tx),
  (tx) => appendTransactionMessageInstructions([transferInstruction], tx)
);

const signedTransaction =
  await signTransactionMessageWithSigners(transactionMessage);

// Decode the messageBytes
const compiledTransactionMessage =
  getCompiledTransactionMessageDecoder().decode(signedTransaction.messageBytes);

console.log(JSON.stringify(compiledTransactionMessage, null, 2));
```

```ts !! title="Legacy"
import {
  LAMPORTS_PER_SOL,
  SystemProgram,
  Transaction,
  Keypair,
  Connection
} from "@solana/web3.js";

const connection = new Connection("http://localhost:8899", "confirmed");
const { blockhash, lastValidBlockHeight } =
  await connection.getLatestBlockhash();

// Generate sender and recipient keypairs
const sender = Keypair.generate();
const recipient = new Keypair();

// Define the amount to transfer
const transferAmount = 0.01; // 0.01 SOL

// Create a transfer instruction for transferring SOL from sender to recipient
const transferInstruction = SystemProgram.transfer({
  fromPubkey: sender.publicKey,
  toPubkey: recipient.publicKey,
  lamports: transferAmount * LAMPORTS_PER_SOL // Convert transferAmount to lamports
});

const transaction = new Transaction({
  blockhash,
  lastValidBlockHeight,
  feePayer: sender.publicKey
}).add(transferInstruction);
transaction.sign(sender);

const compiledMessage = transaction.compileMessage();
console.log(JSON.stringify(compiledMessage, null, 2));
```

```rs !! title="Rust"
use anyhow::Result;
use solana_client::nonblocking::rpc_client::RpcClient;
use solana_commitment_config::CommitmentConfig;
use solana_sdk::{
    native_token::LAMPORTS_PER_SOL, signature::Signer, signer::keypair::Keypair,
    transaction::Transaction,
};
use solana_system_interface::instruction::transfer;

#[tokio::main]
async fn main() -> Result<()> {
    let connection = RpcClient::new_with_commitment(
        "http://localhost:8899".to_string(),
        CommitmentConfig::confirmed(),
    );

    // Fetch the latest blockhash and last valid block height
    let blockhash = connection.get_latest_blockhash().await?;

    // Generate sender and recipient keypairs
    let sender = Keypair::new();
    let recipient = Keypair::new();

    // Create a transfer instruction for transferring SOL from sender to recipient
    let transfer_instruction = transfer(
        &sender.pubkey(),
        &recipient.pubkey(),
        LAMPORTS_PER_SOL / 100, // 0.01 SOL
    );

    let mut transaction =
        Transaction::new_with_payer(&[transfer_instruction], Some(&sender.pubkey()));
    transaction.sign(&[&sender], blockhash);

    println!("{:#?}", transaction);

    Ok(())
}
```

</CodeTabs>

<WithMentions>
Alla oleva koodi näyttää tuloksen edellisistä koodiesimerkeistä.
Formaatti vaihtelee SDK:iden välillä,
mutta huomaa, että jokainen ohje sisältää samat vaaditut tiedot.

<CodeTabs storage="sol-transfer">

```json !! title="Kit"
{
  "version": 0,
  // !mention header
  "header": {
    "numSignerAccounts": 1,
    "numReadonlySignerAccounts": 0,
    "numReadonlyNonSignerAccounts": 1
  },
  // !mention account_keys
  "staticAccounts": [
    "HoCy8p5xxDDYTYWEbQZasEjVNM5rxvidx8AfyqA4ywBa",
    "5T388jBjovy7d8mQ3emHxMDTbUF8b7nWvAnSiP3EAdFL",
    "11111111111111111111111111111111"
  ],
  // !mention recent_blockhash
  "lifetimeToken": "EGCWPUEXhqHJWYBfDirq3mHZb4qDpATmYqBZMBy9TBC1",
  // !mention instructions
  "instructions": [
    {
      "programAddressIndex": 2,
      "accountIndices": [0, 1],
      "data": {
        "0": 2,
        "1": 0,
        "2": 0,
        "3": 0,
        "4": 128,
        "5": 150,
        "6": 152,
        "7": 0,
        "8": 0,
        "9": 0,
        "10": 0,
        "11": 0
      }
    }
  ]
}
```

```json !! title="Legacy"
{
  // !mention header
  "header": {
    "numRequiredSignatures": 1,
    "numReadonlySignedAccounts": 0,
    "numReadonlyUnsignedAccounts": 1
  },
  // !mention account_keys
  "accountKeys": [
    "EPLUagqZZAuAtJ5LSbK7eeXjqeTdesd4q8WhoqVrfG3g",
    "9Txf5pi5jzm7FydFAsQafk7xn5wY9yN2UNm5LW15qvcK",
    "11111111111111111111111111111111"
  ],
  "recentBlockhash": "2qYPgehzMKXcMt4Ku1tKAk9DACKUbtYEY9EUEN42cseT",
  // !mention instructions
  "instructions": [
    {
      "programIdIndex": 2,
      "accounts": [0, 1],
      "data": "3Bxs4NN8M2Yn4TLb"
    }
  ],
  "indexToProgramIds": {}
}
```

```json !! title="Rust"
{
  "signatures": [
    "2fPXZtQGWWj6suxfc55FBQiexS8hEhNELqasSL5DRYa1RB1GChHz86Cyy8ukiVwA6qbq91P4cY1FuvTuYtmTHmJP"
  ],
  "message": {
    // !mention header
    "header": {
      "num_required_signatures": 1,
      "num_readonly_signed_accounts": 0,
      "num_readonly_unsigned_accounts": 1
    },
    "account_keys": [
      "9CpbtdXfUTgLMJL8DEAeEm8thERJPwDuruohjvUuzY7m",
      "6jELNgS8Q35sF4QZCvwgyKGaKrbcm8P5QcNWUyAb5ekJ",
      "11111111111111111111111111111111"
    ],
    "recent_blockhash": "3P7CVQ9nwXx4B37MvBzghzbcM9K9p5xo7ivDE8W78dCi",
    // !mention instructions
    "instructions": [
      {
        "program_id_index": 2,
        "accounts": [0, 1],
        "data": [2, 0, 0, 0, 128, 150, 152, 0, 0, 0, 0, 0]
      }
    ]
  }
}
```

</CodeTabs>
</WithMentions>

Kun transaktio on lähetetty, voit hakea sen tiedot käyttämällä transaktion
allekirjoitusta ja [getTransaction](/docs/rpc/http/gettransaction) RPC-metodia.
Vastaus tulee olemaan rakenteeltaan samankaltainen kuin seuraava katkelma.

<Callout>
  Voit myös löytää transaktion käyttämällä [Solana
  Exploreria](https://explorer.solana.com).
</Callout>

```json title="Transaction Data"
{
  "blockTime": 1745196488,
  "meta": {
    "computeUnitsConsumed": 150,
    "err": null,
    "fee": 5000,
    "innerInstructions": [],
    "loadedAddresses": {
      "readonly": [],
      "writable": []
    },
    "logMessages": [
      "Program 11111111111111111111111111111111 invoke [1]",
      "Program 11111111111111111111111111111111 success"
    ],
    "postBalances": [989995000, 10000000, 1],
    "postTokenBalances": [],
    "preBalances": [1000000000, 0, 1],
    "preTokenBalances": [],
    "rewards": [],
    "status": {
      "Ok": null
    }
  },
  "slot": 13049,
  "transaction": {
    "message": {
      "header": {
        "numReadonlySignedAccounts": 0,
        "numReadonlyUnsignedAccounts": 1,
        "numRequiredSignatures": 1
      },
      "accountKeys": [
        "8PLdpLxkuv9Nt8w3XcGXvNa663LXDjSrSNon4EK7QSjQ",
        "7GLg7bqgLBv1HVWXKgWAm6YoPf1LoWnyWGABbgk487Ma",
        "11111111111111111111111111111111"
      ],
      "recentBlockhash": "7ZCxc2SDhzV2bYgEQqdxTpweYJkpwshVSDtXuY7uPtjf",
      "instructions": [
        {
          "accounts": [0, 1],
          "data": "3Bxs4NN8M2Yn4TLb",
          "programIdIndex": 2,
          "stackHeight": null
        }
      ],
      "indexToProgramIds": {}
    },
    "signatures": [
      "3jUKrQp1UGq5ih6FTDUUt2kkqUfoG2o4kY5T1DoVHK2tXXDLdxJSXzuJGY4JPoRivgbi45U2bc7LZfMa6C4R3szX"
    ]
  },
  "version": "legacy"
}
```
