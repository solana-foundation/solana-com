---
title: Fee-Abstraktion
description:
  Erfahren Sie, wie Fee-Sponsoring funktioniert und implementieren Sie
  Fee-Abstraktion mit Kora.
---

Jede Solana-Transaktion erfordert SOL zur Zahlung von Netzwerk-Fees. Aber
Nutzer, die zu Ihrer Zahlungsanwendung kommen, erwarten Transaktionen in
Stablecoins – nicht die Verwaltung eines zweiten Token-Guthabens.
Fee-Abstraktion beseitigt diese Reibung, indem jemand anderes die Fees zahlt.

Dieser Leitfaden behandelt zwei Ebenen:

1. **Wie Fee-Sponsoring funktioniert** – die zugrunde liegende Solana-Primitive
2. **Fee-Abstraktion im großen Maßstab mit Kora** – ein produktionsreifer
   Fee-Abstraktions-Service

## Wie Fee-Sponsoring funktioniert

Solana-Transaktionen haben einen festgelegten Fee-Zahler – das Konto, das die
Netzwerk-Fee zahlt. Standardmäßig ist dies der erste Signer. Sie können jedoch
ein anderes Konto als Fee-Zahler angeben, sodass ein Dritter (der "Sponsor")
Fees im Namen des Absenders übernehmen kann.

Sowohl der Absender als auch der Sponsor müssen die Transaktion signieren:

- Der **Absender** signiert, um die Übertragung seiner Token zu autorisieren
- Der **Sponsor** signiert, um die Zahlung der Netzwerk-Fee zu autorisieren

<Callout>
  Siehe [Wie Zahlungen auf Solana
  funktionieren](/docs/payments/how-payments-work) für grundlegende
  Zahlungskonzepte.
</Callout>

Die folgenden Schritte zeigen den grundlegenden Ablauf. Siehe die [Demo](#demo)
für vollständigen ausführbaren Code.

<ScrollyCoding>

## !!steps Sponsor-Konto erstellen

Generieren Sie ein separates Keypair für den Sponsor, der Transaktions-Fees
zahlen wird. Der Sponsor benötigt SOL für Fees, muss aber nicht die zu
übertragenden Token halten.

<CodePlaceholder title="Transaktions-Fee sponsern" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;
```

## !!steps Transfer-Instruktion erstellen

Erstellen Sie die Token-Transfer-Instruktion mit dem Absender als Autorität. Der
Absender besitzt die Token und muss die Übertragung signieren.

<CodePlaceholder title="Sponsor-Transaktionsgebühr" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

// !focus(1:6)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Sender signs for the transfer
  amount: 250_000n // adjusted for the mint's decimals
});
```

## !!steps Senden mit Sponsor als Fee-Zahler

Verwenden Sie `prepareAndSend` mit sowohl `authority` (dem Absender, der die
Übertragung signiert) als auch `feePayer` (dem Sponsor, der die Fee zahlt).
Beide müssen die Transaktion signieren.

<CodePlaceholder title="Sponsor-Transaktionsgebühr" />

```ts !! title="Sponsor Transaction Fee"
const sponsor = (await generateKeypair()).signer;

const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender,
  amount: 250_000n
});

// !focus(1:6)
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Signs the transfer instruction
  // !mark
  feePayer: sponsor, // Pays the transaction fees
  instructions: [transferInstruction],
  version: 0
});
```

</ScrollyCoding>

### Demo

<CodeTabs flags="r">

```ts !! title="Demo"
// !collapse(1:14) collapsed
// Click ">" icon on left to expand demo imports
import { createClient, lamports } from "@solana/client";
import { generateKeypair } from "@solana/client/server";
import type { ServerKeypair } from "@solana/client/server";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_2022_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token-2022";

// Generate keypairs for sender, recipient, and sponsor (fee payer)
const sender = (await generateKeypair()).signer;
const recipient = (await generateKeypair()).signer;
// !mark
const sponsor = (await generateKeypair()).signer;

console.log("Sender Address:", sender.address);
console.log("Recipient Address:", recipient.address);
console.log("Sponsor Address (Fee Payer):", sponsor.address);

// Demo Setup: Create client, mint account, token accounts, and fund with initial tokens
const { client, mint } = await demoSetup(sender, recipient, sponsor);

console.log("\nMint Address:", mint.address);

// Derive the Associated Token Accounts addresses (ATAs) for sender and recipient
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

const [recipientAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient.address,
  tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient Token Account:", recipientAta.toString());

// =============================================================================
// Sponsored Token Payment Demo
// =============================================================================

// Create instruction to transfer tokens from sender to recipient
// Transferring 250,000 base units = 0.25 tokens (with 6 decimals)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender, // Pass signer, not just address
  amount: 250_000n // 0.25 tokens
});

// Prepare and send transaction with sponsor as fee payer using @solana/client
// The sponsor pays transaction fees, sender signs for the transfer
const signature = await client.transaction.prepareAndSend({
  authority: sender, // Sender signs the transfer instruction
  // !mark
  feePayer: sponsor, // Sponsor pays the transaction fees (different account)
  instructions: [transferInstruction],
  version: 0
});

console.log("\n=== Sponsored Token Payment Complete ===");
console.log("Transaction Signature:", signature.toString());

// Fetch final token account balances using @solana/client SPL token helper
const splToken = client.splToken({
  mint: mint.address,
  tokenProgram: "auto"
});

const senderBalance = await splToken.fetchBalance(sender.address);
const recipientBalance = await splToken.fetchBalance(recipient.address);

console.log("\nSender Token Account Balance:", senderBalance);
console.log("Recipient Token Account Balance:", recipientBalance);

// Fetch transaction details
const transaction = await client.runtime.rpc
  .getTransaction(signature, {
    encoding: "jsonParsed",
    maxSupportedTransactionVersion: 0
  })
  .send();

const feePayer = transaction?.transaction.message.accountKeys?.[0];
console.log("\nNote: The first account in accountKeys is always the fee payer");
console.log("Fee Payer Address:", feePayer);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
// !collapse(1:1000) collapsed

/**
 * Sets up for a sponsored token transfer demo:
 * - Creates @solana/client instance
 * - Airdrops SOL to sponsor for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and recipient
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair (will be funded and used as mint authority)
 * @param recipient - The recipient's keypair
 * @param sponsor - The sponsor's keypair (will pay all transaction fees)
 * @returns Returns client instance and mint address
 */
async function demoSetup(
  sender: ServerKeypair["signer"],
  recipient: ServerKeypair["signer"],
  sponsor: ServerKeypair["signer"]
) {
  // Create @solana/client instance pointing to local validator
  const client = createClient({
    endpoint: "http://localhost:8899",
    websocketEndpoint: "ws://localhost:8900",
    commitment: "confirmed",
    logger: () => {} // Disable all logs
  });

  // Fund sponsor with SOL for transaction fees using @solana/client actions
  await client.actions.requestAirdrop(
    sponsor.address,
    lamports(1_000_000_000n)
  );

  // Generate keypair to use as address of mint
  const mint = (await generateKeypair()).signer;

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await client.runtime.rpc
    .getMinimumBalanceForRentExemption(space)
    .send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program (sponsor pays the rent)
  const createAccountInstruction = getCreateAccountInstruction({
    payer: sponsor,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token 2022 program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 6,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_2022_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA (sponsor pays)
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient's ATA (sponsor pays)
  const createRecipientAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: sponsor,
      mint: mint.address,
      owner: recipient.address
    });

  // Create instruction to mint initial tokens to sender
  // Sender is the mint authority and must sign
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender, // Pass signer, not just address
    amount: 1_000_000n // Mint 1.00 tokens (1,000,000 base units with 6 decimals)
  });

  // Combine all instructions and send using @solana/client transaction helper
  const setupInstructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipientAtaInstruction, // Create recipient's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Prepare and send transaction using @solana/client with sponsor as fee payer
  await client.transaction.prepareAndSend({
    authority: sender,
    feePayer: sponsor, // Sponsor pays all transaction fees
    instructions: setupInstructions,
    version: 0
  });

  return {
    client,
    mint
  };
}
```

</CodeTabs>

<Callout type="caution">
  Wenn Sie ein Token-Konto für einen Endbenutzer erstellen, kann dieser es
  schließen und die für Rent verwendeten SOL zurückfordern. Erwägen Sie,
  Benutzern die Kontoerstellung in Stablecoins in Rechnung zu stellen, oder
  berücksichtigen Sie diese Kosten in Ihrer Produktökonomie.
</Callout>

## Fee-Abstraktion im großen Maßstab mit Kora

Das Fee-Payer-Primitiv ist leistungsstark, aber der Aufbau eines
produktionsreifen Gasless-Systems erfordert mehr: Verwaltung von
Sponsor-Wallets, Handhabung von Token-Konvertierungen (damit Benutzer Fees in
USDC "zahlen" können), Rate-Limiting und Sicherheitskontrollen.

[Kora](https://launch.solana.com/products/kora) bewältigt diese Komplexität. Es
ist ein JSON-RPC-Server, der Fee-Abstraktion bereitstellt, sodass Benutzer
niemals SOL benötigen. Sie können Fees vollständig sponsern oder die Fee-Zahlung
in jedem Token akzeptieren.

Deployen Sie Kora mit einem einzigen Befehl:

```bash
cargo install kora-cli
kora --config path/to/kora.toml rpc start --signers-config path/to/signers.toml
```

Verwenden Sie dann den Kora-Client, um Transaktionen zu signieren und zu senden:

```bash
pnpm add @solana/kora
```

```typescript
import { KoraClient } from "@solana/kora";

const kora = new KoraClient({ rpcUrl: "https://your-kora-instance" });

const { signature } = await kora.signAndSendTransaction({
  transaction: base64EncodedTransaction
});
```

### Kora-Ressourcen

<Cards>
  <Card
    title="Kora-Schnellstart"
    href="https://launch.solana.com/docs/kora/getting-started/quick-start"
  >
    Bringen Sie Kora in wenigen Minuten lokal zum Laufen.
  </Card>
  <Card
    title="Vollständige Transaktions-Demo"
    href="https://launch.solana.com/docs/kora/guides/full-demo"
  >
    Vollständiger Implementierungsleitfaden für Fee-Abstraktions-Transaktionen.
  </Card>
  <Card
    title="API-Referenz"
    href="https://launch.solana.com/docs/kora/json-rpc-api"
  >
    JSON-RPC-Methoden und SDK-Dokumentation.
  </Card>
  <Card
    title="Node-Operator-Leitfaden"
    href="https://launch.solana.com/docs/kora/operators"
  >
    Deployen und konfigurieren Sie Ihre eigene Kora-Instanz.
  </Card>
</Cards>
