---
title: Взаимодействие с Solana
description: Подключитесь к сети и изучайте данные блокчейна
---

Прежде чем создавать платёжные процессы, необходимо подключиться к Solana и
понять, как запрашивать данные сети. В этом руководстве рассматриваются основы:
установление соединения и использование RPC-методов, которые понадобятся для
платежей с помощью TypeScript SDK
[@solana/kit](https://www.npmjs.com/package/@solana/kit) и
[Solana CLI](https://solana.com/docs/intro/installation). Кроме того, мы
рассмотрим основы работы с [Solana Explorer](https://explorer.solana.com) для
ручной проверки платежей, просмотра аккаунтов и отладки проблем.

## Подключение к Solana

RPC API Solana — это основной способ программного взаимодействия с сетью. Ваш
RPC URL фактически является API-ключом к сети.

<Callout type="caution" title="Не используйте публичные RPC в продакшене">
  Публичные эндпоинты (`api.mainnet-beta.solana.com`, `api.devnet.solana.com`)
  имеют ограничения по количеству запросов, не имеют SLA и не подходят для
  платёжных процессов в продакшене. Для продакшена используйте
  [RPC-провайдера](https://solana.com/rpc), чтобы получить приватный
  RPC-эндпоинт.
</Callout>

Для разработки и тестирования можно использовать публичные эндпоинты с
ограничением по количеству запросов.

Создайте RPC-клиент для взаимодействия с сетью:

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
import { createSolanaRpc, createSolanaRpcSubscriptions } from "@solana/kit";

const rpc = createSolanaRpc("https://api.mainnet-beta.solana.com");
const rpcSubscriptions = createSolanaRpcSubscriptions(
  "wss://api.mainnet-beta.solana.com"
);
```

```bash !! title="CLI"
solana config set --url https://api.mainnet-beta.solana.com
solana config get # to verify the connection
```

</CodeTabs>

<Callout>
  Для разработки используйте devnet (`https://api.devnet.solana.com`) или
  локальный validator, например,
  [Surfpool](/docs/intro/installation/surfpool-cli-basics).
</Callout>

## Основные RPC-методы

[JSON-RPC API](/docs/rpc) Solana предоставляет методы для запроса данных сети.
Вот те, которые чаще всего используются для платёжных процессов.

### Получение информации об аккаунте

Все аккаунты в Solana доступны по их публичному ключу. Используйте RPC-метод
[`getAccountInfo`](/docs/rpc/http/getaccountinfo), чтобы получить информацию о
любом аккаунте. Метод `getAccountInfo` возвращает объект `AccountInfo`, который
содержит публичный ключ аккаунта, баланс в SOL, данные и другую метаинформацию.

Поле `data` содержит строку, закодированную в base64, с данными аккаунта. Вы
можете преобразовать её в байты с помощью метода `getBase64Codec` из пакета
`@solana/kit`, а затем декодировать в читаемый объект, используя ожидаемый кодек
(если он известен) для данных аккаунта (например, `getTokenCodec` для token
accounts).

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const accountInfo = await rpc
  .getAccountInfo(address("7EcDhSYGxXyscszYEp35KHN8vvw3svAuLKTzXwCFLtV"), {
    encoding: "base64"
  })
  .send();
const dataBytes = getBase64Codec().encode(accountInfo.value.data);
const parsedTokenData = getTokenCodec().decode(dataBytes);

console.log(parsedTokenData);
```

```bash !! title="CLI"
solana account 7EcDhSYGxXyscszYEp35KHN8vvw3svAuLKTzXwCFLtV
```

</CodeTabs>

### Получение баланса токенов

Проверьте баланс token account с помощью метода RPC
[`getTokenAccountBalance`](/docs/rpc/http/gettokenaccountbalance):

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const balance = await rpc.getTokenAccountBalance(tokenAccountAddress).send();

console.log(balance.value.uiAmount); // Human-readable (e.g., 100.50)
console.log(balance.value.amount); // Base units (e.g., "100500000")
```

```bash !! title="CLI"
spl-token balance --address 7v45FoihixmfocS3LbANUrEGZQKEJ7QQUg8K9jtZd3St
```

</CodeTabs>

### Формирование транзакций

Каждая транзакция требует актуального blockhash, чтобы быть действительной (и не
устаревшей). Получите его перед созданием платёжной транзакции с помощью метода
RPC [`getLatestBlockhash`](/docs/rpc/http/getlatestblockhash):

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();
```

```bash !! title="CLI"
solana block-height
```

</CodeTabs>

> Blockhash устаревает примерно через 60 секунд. Получайте новый непосредственно
> перед подписанием и отправкой.

### Проверка статуса транзакции

Проверьте, что транзакция завершена, с помощью метода RPC
[`getSignatureStatuses`](/docs/rpc/http/getsignaturestatuses):

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const status = await rpc.getSignatureStatuses([signature]).send();

const result = status.value[0];
// result.confirmationStatus: "processed" | "confirmed" | "finalized"
```

```bash !! title="CLI"
solana confirm <SIGNATURE>
# For more details:
solana confirm <SIGNATURE> -v
```

</CodeTabs>

### Получение деталей транзакции

Получите полную информацию о подтверждённой транзакции с помощью метода RPC
[`getTransaction`](/docs/rpc/http/gettransaction):

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const transaction = await rpc
  .getTransaction(signature, { maxSupportedTransactionVersion: 0 })
  .send();
```

```bash !! title="CLI"
solana transaction-history <ADDRESS> --limit 1 -v
# Or decode a specific transaction:
solana confirm <SIGNATURE> -v
```

</CodeTabs>

### История транзакций

Получите список последних транзакций для адреса с помощью метода RPC
[`getSignaturesForAddress`](/docs/rpc/http/getsignaturesforaddress):

<CodeTabs storage="kit-cli">

```ts !! title="Kit"
const signatures = await rpc
  .getSignaturesForAddress(walletAddress, { limit: 10 })
  .send();
```

```bash !! title="CLI"
solana transaction-history <ADDRESS> --limit 10
```

</CodeTabs>

> Для комплексного мониторинга платежей см.
> [Приём платежей](/docs/payments/accept-payments), где описаны вебхуки и
> обнаружение транзакций в реальном времени.

## Изучение публичных данных

Публичный реестр Solana означает, что каждая транзакция, token account и mint
полностью доступны для аудита. Блок-эксплореры позволяют вручную проверять
платежи, просматривать аккаунты и отлаживать проблемы без написания кода.

**Что можно посмотреть:**

- Проверить, что платёж завершён
- Просмотреть балансы token account
- Отладить неудачные транзакции
- Найти детали mint (эмиссия, количество знаков после запятой, полномочия)

**Популярные блок-эксплореры:** [Solana Explorer](https://explorer.solana.com),
[SolanaFM](https://solana.fm), [Solscan](https://solscan.io),
[Orb](https://www.orbmarkets.io/)

**Примеры ссылок:**

- [USDC Token Mint](https://explorer.solana.com/address/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v)
  — Эмиссия, рынки, держатели и транзакции для USDC
- [USDC Token Transfer](https://explorer.solana.com/tx/3d2mQChCbqM5iogAN5PZw7KGZuVtQq3LbwU8hk55u4iUvYH1XJ7SQVQpWwoZj43MtthBqGBoqGBe9fn4Bo1VznjG)
  — Детали транзакции оплаты USDC
- [USDG Token Account](https://explorer.solana.com/address/7v45FoihixmfocS3LbANUrEGZQKEJ7QQUg8K9jtZd3St)
  — Баланс пользователя в USDG и история транзакций
