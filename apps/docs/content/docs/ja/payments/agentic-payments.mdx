---
title: エージェント決済
description: x402プロトコルを使用して、AIエージェントがサービス、API、リソースに対して自律的に支払いを行えるようにします。
---

AIエージェントは、コードの記述、データの取得、リソースのプロビジョニングなど、ワークフローにおいてますます自律的になっています。完全に独立して動作するには、プログラムによってリアルタイムで、最小限のコストでサービスに対して「マイクロペイメント」を行う方法が必要です。従来の決済システムはマイクロペイメントには適していません。Solanaのサブセント手数料とサブセカンドのファイナリティにより、これが技術的にも経済的にも実現可能になります。

## なぜこれが重要なのか？

例えば、開発者がLLMを使用してアプリケーションを構築する際、有料APIからデータが必要になったとします。重要なデータを取得するために、開発者はワークフローを中断し、APIを調査し、プロバイダーを選択し、アカウントを作成し、支払い方法を追加し、APIキーを生成し、キーを環境にコピーしてから、ワークフローを再開する必要があります。この摩擦はフロー状態を壊します。AI支援ワークフローにとっては、障害となります。

代わりに、エージェント決済を使用すれば、エージェントはリクエストを行い、支払いを済ませ、ワークフローを継続できます。アカウントは不要です。APIキーも不要です。手動介入も不要です。

## x402プロトコル

エージェント決済には、従来のWebインターフェースを中断することなく、標準的なWebインフラストラクチャ上でクライアントとサーバーが支払い条件を交渉する方法が必要です。マイクロペイメント分野はまだ黎明期であり、この分野が進化するにつれて新しいツールや標準が登場する可能性があります。しかし、[x402プロトコル](https://www.x402.org/)は、強力なエコシステムサポートを持つ初期の標準として登場しました。x402は、[HTTPの402「Payment Required」](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/402)ステータスコードを使用します。これはHTTP/1.1以来の標準ですが、ブロックチェーン決済によって初めて実用的になりました。

### 仕組み

クライアントがリクエストを送信すると、支払い条件を含む402レスポンスを受信し、署名された支払いとともに再試行します。サーバーは検証と決済をファシリテーターに委任します。ファシリテーターはオンチェーントランザクションの送信を処理するオプションの仲介者です。ファシリテーターが決済を確認すると、サーバーはリクエストされたコンテンツを返します。この分離により、APIプロバイダーはオンチェーンインフラストラクチャを直接管理することなく支払いを受け入れることができます。

![x402フロー図](/assets/guides/x402/x402-flow-solana.png)

このプロトコルはステートレス（セッションやAPIキーなし）で、標準的なHTTPインフラストラクチャで動作し、サーバーが受け入れる任意のSPLトークンをサポートします。以下は、x402ミドルウェアを使用してExpressサーバーをセットアップする方法のスニペットです。

```ts
app.use(
  paymentMiddleware(
    {
      "GET /costly-data": {
        accepts: [
          {
            scheme: "exact",
            price: "$0.001",
            network: "solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",
            payTo: svmAddress
          }
        ],
        description: "Costly data",
        mimeType: "application/json"
      }
    },
    new x402ResourceServer(facilitatorClient).register(
      "solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",
      new ExactSvmScheme()
    )
  )
);

app.get("/costly-data", (req, res) => {
  res.send({
    report: {
      data: "costly data"
    }
  });
});
```

x402の詳細については、以下のガイドをご覧ください。

<Cards>
  <Card
    title="x402の紹介"
    href="/developers/guides/getstarted/intro-to-x402"
    description="支払い対応APIを構築するためのプロトコルの基礎とSDKオプション。"
  />
  <Card
    title="Koraで構築"
    href="/developers/guides/getstarted/build-a-x402-facilitator"
    description="Koraの署名インフラストラクチャを使用してガスレスx402支払いを実装。"
  />
</Cards>

### x402ツール

| SDK                                                             | 説明                                   |
| --------------------------------------------------------------- | -------------------------------------- |
| [Corbits](https://corbits.dev/)                                 | Solana優先のx402実装                   |
| [MCPay.tech](https://mcpay.tech/)                               | MCPサーバー向けリクエストごとの支払い  |
| [PayAI](https://payai.network/)                                 | Solanaサポート付きx402ファシリテーター |
| [x402 GitHub](https://github.com/coinbase/x402)                 | リファレンス実装                       |
| [ACK](https://github.com/agentcommercekit/ack)                  | Agent Commerce Kit                     |
| [A2A x402](https://github.com/google-agentic-commerce/a2a-x402) | Googleのエージェント間支払い           |
