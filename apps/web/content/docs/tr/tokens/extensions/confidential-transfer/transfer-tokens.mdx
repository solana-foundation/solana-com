---
title: Token Transferi
description:
  Bir token hesabından diğerine özel olarak token transferi yapmayı öğrenin.
---

<Callout type="warn">
  ZK ElGamal Programı, güvenlik denetiminden geçerken ana ağ ve geliştirici
  ağında geçici olarak devre dışı bırakılmıştır. Bu, gizli transfer uzantısının
  şu anda kullanılamadığı anlamına gelir. Kavramlar hala geçerli olsa da, kod
  örnekleri çalışmayacaktır.
</Callout>

## Bir token hesabından diğerine gizli token transferi nasıl yapılır

Token'ları bir token hesabından diğerine gizli bir şekilde aktarmak için hem
gönderenin hem de alıcının token hesaplarının
CODE_PLACEHOLDER_2915702bfb467dfedf86c5659c2822b4 durumu ile yapılandırılmış ve
gizli transferler için onaylanmış olması gerekir. Gönderenin token hesabında
ayrıca aktarım yapılabilecek kullanılabilir bir gizli bakiye bulunmalıdır.

Token'ları gizli olarak transfer etmek için:

1. İstemci tarafında
   [üç kanıt](https://github.com/solana-program/token-2022/blob/d073cb89dbcd430387b5c6fb4b7157911351e4a3/confidential-transfer/proof-generation/src/transfer.rs#L35)
   oluşturun:

   **Eşitlik kanıtı
   ([CiphertextCommitmentEqualityProofData](https://github.com/anza-xyz/agave/blob/8b33d6d311c95780362a7d235919e7b8d2345939/zk-token-sdk/src/instruction/ciphertext_commitment_equality.rs#L56))**:
   Transfer sonrası yeni kullanılabilir bakiye şifreli metninin karşılık gelen
   [Pedersen taahhüdü](https://en.wikipedia.org/wiki/Commitment_scheme) ile
   eşleştiğini doğrular, kaynak hesabın yeni kullanılabilir bakiyesinin
   CODE_PLACEHOLDER_e56bb17e56a8e8d345f3566c3babff40 olarak doğru şekilde
   hesaplandığından emin olur.

   **Şifre Metni Geçerlilik Kanıtı
   ([BatchedGroupedCiphertext3HandlesValidityProofData](https://github.com/anza-xyz/agave/blob/8b33d6d311c95780362a7d235919e7b8d2345939/zk-token-sdk/src/instruction/batched_grouped_ciphertext_validity/handles_3.rs#L63))**:
   Transfer tutarı şifre metinlerinin üç taraf (kaynak, hedef ve denetçi) için
   düzgün şekilde oluşturulduğunu doğrular ve transfer tutarının her tarafın
   açık anahtarı altında doğru şekilde şifrelendiğini sağlar.

   **Aralık Kanıtı
   ([BatchedRangeProofU128Data](https://github.com/anza-xyz/agave/blob/8b33d6d311c95780362a7d235919e7b8d2345939/zk-token-sdk/src/instruction/batched_range_proof/batched_range_proof_u128.rs#L37))**:
   Yeni kullanılabilir bakiye ve transfer tutarının (düşük/yüksek bitlere
   bölünmüş) negatif olmadığını ve belirli bir aralık içinde olduğunu doğrular.

2. Her kanıt için:
   - Kanıt verilerini doğrulamak için ZK ElGamal kanıt programını çağırın.
   - Kanıta özgü meta verileri, diğer talimatlarda kullanmak üzere bir kanıt
     "bağlam durumu" hesabında saklayın.

3. [ConfidentialTransferInstruction::Transfer](https://github.com/solana-program/token-2022/blob/efd0c957fefbd79882d77df5fb2dac88c001249c/program/src/extension/confidential_transfer/processor.rs#L604)
   talimatını çağırın ve kanıt bağlam durumu hesaplarını sağlayın.

4. Kanıt bağlam durumu hesaplarını kapatarak, bunları oluşturmak için kullanılan
   SOL'u geri alın.

Aşağıdaki diyagram, token'ların gönderenin token hesabından alıcının token
hesabına aktarılmasında yer alan adımları göstermektedir.

CODE_PLACEHOLDER_9883db06636013db3ade71b9fda13934

### Gerekli talimatlar

Token'ları bir token hesabından diğerine gizli bir şekilde aktarmak için şunları
yapmalısınız:

- İstemci tarafında eşitlik kanıtı, şifreli metin geçerlilik kanıtı ve aralık
  kanıtı oluşturun
- Kanıtları doğrulamak ve "bağlam durumu" hesaplarını başlatmak için Zk ElGamal
  kanıt programını çağırın
- [ConfidentialTransferInstruction::Transfer](https://github.com/solana-program/token-2022/blob/efd0c957fefbd79882d77df5fb2dac88c001249c/program/src/extension/confidential_transfer/processor.rs#L604)
  talimatını üç kanıt hesabını sağlayarak çağırın
- Kira ücretini geri almak için üç kanıt hesabını kapatın.

CODE_PLACEHOLDER_dad973f62e0620bdacb7e470b9ff95ca crate'i aşağıdaki metotları
sağlar:

- Bir kanıt hesabı oluşturan CODE_PLACEHOLDER_f7359959739dc3eb203219c2f41d4214
  metodu.
- CODE_PLACEHOLDER_28a1083da76182b21921f1cef4db43b0 talimatını çağıran
  CODE_PLACEHOLDER_5cc0aa60b1a33f0e0a7a69444a20750b metodu.
- Bir kanıt hesabını kapatan CODE_PLACEHOLDER_c7ce0c34048974c78e7a60487e820788
  metodu.

### Örnek kod

Aşağıdaki örnek, token'ların token hesapları arasında gizli bir şekilde nasıl
aktarılacağını göstermektedir.

Örneği çalıştırmak için, aşağıdaki komutu kullanarak ana ağdan klonlanmış Token
Extensions Program ile yerel bir doğrulayıcı başlatın. Yerel doğrulayıcıyı
başlatmak için Solana CLI'nin kurulu olması gerekir.

CODE_PLACEHOLDER_b1ca00e36da9584c7f5ae68f3e256b73

<Callout type="info">
  Bu yazının yazıldığı sırada, Gizli Transferler varsayılan yerel doğrulayıcıda
  etkinleştirilmemiştir. Örnek kodu çalıştırmak için ana ağdaki Token Extensions
  Program'ı klonlamanız gerekir.
</Callout>

<CodeTabs>

CODE_PLACEHOLDER_46dc374cd52d36499281eadd77870de8

CODE_PLACEHOLDER_c2d27e459b546fccd653347dff9f6efb

</CodeTabs>
