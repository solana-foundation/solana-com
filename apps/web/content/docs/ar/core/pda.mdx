---
title: عنوان مشتق من البرنامج
description:
  تعرف على عناوين سولانا المشتقة من البرنامج (PDAs) — عناوين حسابات محددة تمكّن
  من توقيع البرنامج الآمن. افهم اشتقاق PDA، والقيم الإضافية القانونية، وكيفية
  إنشاء حسابات PDA.
---

يشير عنوان [حساب سولانا](/docs/core/accounts#account-address) إلى موقع الحساب
على سلسلة الكتل. العديد من عناوين الحسابات هي المفتاح العام لـ keypair، وفي هذه
الحالة يتم استخدام المفتاح الخاص المقابل لتوقيع المعاملات التي تتضمن الحساب.

البديل المفيد لعنوان المفتاح العام هو عنوان مشتق من البرنامج (PDA). توفر PDAs
طريقة سهلة لتخزين وتعيين واسترجاع حالة البرنامج. PDA هو عنوان يتم إنشاؤه بشكل
محدد باستخدام معرف البرنامج ومجموعة من المدخلات الاختيارية المحددة مسبقًا. تبدو
عناوين PDA مشابهة لعناوين المفاتيح العامة، ولكن ليس لها مفتاح خاص مقابل.

يمكّن وقت تشغيل سولانا البرامج من التوقيع لـ PDAs دون الحاجة إلى مفتاح خاص.
استخدام PDA يلغي الحاجة إلى تتبع عنوان الحساب. بدلاً من ذلك، يمكنك استدعاء
المدخلات المحددة المستخدمة لاشتقاق PDA. (لمعرفة كيفية استخدام البرامج لـ PDAs
للتوقيع، راجع قسم [استدعاءات البرامج المتقاطعة](/docs/core/cpi).)

## الخلفية

[أزواج المفاتيح](https://github.com/anza-xyz/solana-sdk/blob/sdk%40v2.2.2/keypair/src/lib.rs#L26)
في سولانا هي نقاط على [منحنى Ed25519](https://ed25519.cr.yp.to/) (تشفير المنحنى
الإهليلجي). تتكون من مفتاح عام ومفتاح خاص. يصبح المفتاح العام عنوان الحساب،
ويستخدم المفتاح الخاص لإنشاء [توقيع](/docs/core/transactions#signatures) صالح
للحساب.

![حسابان بعناوين على المنحنى](/assets/docs/core/pda/address-on-curve.svg)

يتم اشتقاق PDA عمدًا ليقع خارج منحنى Ed25519. هذا يعني أنه ليس له مفتاح خاص
مقابل صالح ولا يمكنه تنفيذ عمليات التشفير. (مثل توفير توقيع.) ومع ذلك، تمكّن
سولانا البرامج من التوقيع لـ PDAs دون الحاجة إلى مفتاح خاص.

![عنوان خارج المنحنى](/assets/docs/core/pda/address-off-curve.svg)

يمكنك التفكير في PDAs كطريقة لإنشاء هياكل شبيهة بخرائط التجزئة على السلسلة
باستخدام مجموعة محددة مسبقًا من المدخلات. (على سبيل المثال، السلاسل النصية
والأرقام وعناوين الحسابات الأخرى.)

![Program Derived Address](/assets/docs/core/pda/pda.svg)

## اشتقاق PDA

قبل إنشاء حساب باستخدام PDA، يجب عليك أولاً اشتقاق العنوان. اشتقاق PDA _لا_ ينشئ
تلقائيًا حسابًا على السلسلة في ذلك العنوان - يجب إنشاء الحساب بشكل صريح من خلال
البرنامج المستخدم لاشتقاق PDA. يمكنك التفكير في PDA مثل عنوان على خريطة: مجرد
وجود عنوان لا يعني أن هناك شيئًا مبنيًا هناك.

تدعم مجموعات تطوير البرمجيات (SDKs) الخاصة بـ سولانا إنشاء PDA باستخدام الدوال
الموضحة في الجدول أدناه. تستقبل كل دالة المدخلات التالية:

- **معرف البرنامج**: عنوان البرنامج المستخدم لاشتقاق PDA. يمكن لهذا البرنامج
  التوقيع نيابة عن PDA.
- **البذور الاختيارية**: مدخلات محددة مسبقًا، مثل السلاسل النصية أو الأرقام أو
  عناوين الحسابات الأخرى.

| SDK                            | الدالة                                                                                                                           |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------- |
| `@solana/kit` (تايبسكريبت)     | [`getProgramDerivedAddress`](https://github.com/anza-xyz/kit/blob/v2.1.0/packages/addresses/src/program-derived-address.ts#L157) |
| `@solana/web3.js` (تايبسكريبت) | [`findProgramAddressSync`](https://github.com/solana-foundation/solana-web3.js/blob/v1.98.0/src/publickey.ts#L212)               |
| `solana_sdk` (راست)            | [`find_program_address`](https://github.com/anza-xyz/solana-sdk/blob/sdk%40v2.2.2/pubkey/src/lib.rs#L617)                        |

تستخدم الدالة معرف البرنامج والبذور الاختيارية، ثم تتكرر عبر قيم bump لمحاولة
إنشاء عنوان برنامج صالح. يبدأ تكرار قيم bump من 255 وينقص بمقدار 1 حتى يتم
العثور على PDA صالح. بعد العثور على PDA صالح، تعيد الدالة PDA و bump seed.

<Callout>
  bump seed هو بايت إضافي يُضاف إلى البذور الاختيارية لضمان إنشاء عنوان صالح
  خارج المنحنى.
</Callout>

![اشتقاق PDA](/assets/docs/core/pda/pda-derivation.svg)

### الزيادة القانونية

bump seed هي بايت إضافي يُضاف إلى البذور الاختيارية. تقوم دالة الاشتقاق بالتكرار
خلال قيم الزيادة، بدءًا من 255 وتنقص بمقدار 1، حتى تنتج قيمة عنوانًا صالحًا خارج
المنحنى. أول قيمة تنتج عنوانًا صالحًا خارج المنحنى تسمى "الزيادة القانونية".

توضح الأمثلة التالية اشتقاق PDA باستخدام جميع قيم bump seed الممكنة (من 255 إلى
0):

<Callout type="info">
  لم يتم تضمين مثال Kit لأن الدالة
  [createProgramDerivedAddress](https://github.com/anza-xyz/kit/blob/v2.1.0/packages/addresses/src/program-derived-address.ts#L101)
  غير مصدرة.
</Callout>

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programId = new PublicKey("11111111111111111111111111111111");
const optionalSeed = "helloWorld";

// Loop through all bump seeds (255 down to 0)
for (let bump = 255; bump >= 0; bump--) {
  try {
    const PDA = PublicKey.createProgramAddressSync(
      [Buffer.from(optionalSeed), Buffer.from([bump])],
      programId
    );
    console.log("bump " + bump + ": " + PDA);
  } catch (error) {
    console.log("bump " + bump + ": " + error);
  }
}
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_id = Pubkey::from_str("11111111111111111111111111111111")?;
    let optional_seed = b"helloWorld";

    // Loop through all bump seeds (255 down to 0)
    for bump in (0..=255).rev() {
        match Pubkey::create_program_address(&[optional_seed.as_ref(), &[bump]], &program_id) {
            Ok(pda) => println!("bump {}: {}", bump, pda),
            Err(err) => println!("bump {}: {}", bump, err),
        }
    }

    Ok(())
}
```

</CodeTabs>

<CodeTabs>

```sh !! title="Expected TS Output"
bump 255: Error: Invalid seeds, address must fall off the curve
bump 254: 46GZzzetjCURsdFPb7rcnspbEMnCBXe9kpjrsZAkKb6X
bump 253: GBNWBGxKmdcd7JrMnBdZke9Fumj9sir4rpbruwEGmR4y
bump 252: THfBMgduMonjaNsCisKa7Qz2cBoG1VCUYHyso7UXYHH
bump 251: EuRrNqJAofo7y3Jy6MGvF7eZAYegqYTwH2dnLCwDDGdP
bump 250: Error: Invalid seeds, address must fall off the curve
...
// remaining bump outputs
```

```sh !! title="Expected Rust Output"
bump 255: Provided seeds do not result in a valid address
bump 254: 46GZzzetjCURsdFPb7rcnspbEMnCBXe9kpjrsZAkKb6X
bump 253: GBNWBGxKmdcd7JrMnBdZke9Fumj9sir4rpbruwEGmR4y
bump 252: THfBMgduMonjaNsCisKa7Qz2cBoG1VCUYHyso7UXYHH
bump 251: EuRrNqJAofo7y3Jy6MGvF7eZAYegqYTwH2dnLCwDDGdP
bump 250: Provided seeds do not result in a valid address
...
// remaining bump outputs
```

</CodeTabs>

في هذا المثال، تؤدي أول bump seed إلى خطأ. أول bump seed لاشتقاق PDA صالح
هي 254. قيم bump seeds 253-251 تشتق أيضًا عناوين PDA فريدة وصالحة.

هذا يعني أنه مع نفس البذور الاختيارية و`programId`، يمكن لـ bump seed بقيمة
مختلفة أن يشتق PDA صالحًا أيضًا.

<Callout type="warn">
  احرص دائمًا على تضمين فحوصات أمنية للتأكد من أن PDA المُمرر إلى البرنامج مشتق
  من الزيادة القانونية. قد يؤدي عدم القيام بذلك إلى إدخال ثغرات تسمح باستخدام
  حسابات غير متوقعة في تعليمات البرنامج. من أفضل الممارسات استخدام الزيادة
  القانونية فقط عند اشتقاق PDAs.
</Callout>

### أمثلة

تشتق الأمثلة أدناه PDA باستخدام مكتبات سولانا SDK. انقر على **&#9655; تشغيل**
لتنفيذ الكود.

#### اشتقاق PDA باستخدام بذرة نصية

يشتق المثال أدناه PDA باستخدام معرف البرنامج وبذرة نصية اختيارية.

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Kit"
import { Address, getProgramDerivedAddress } from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus
const seeds = ["helloWorld"];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");
// !focus
const seeds = [Buffer.from("helloWorld")];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus
    let seeds: &[&[u8]] = &[b"helloWorld"];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

#### اشتقاق PDA باستخدام seed عنوان

المثال أدناه يشتق PDA باستخدام معرف البرنامج وseed عنوان اختياري.

<CodeTabs storage="pda-examples"flags="r">

```ts !! title="Kit"
import {
  Address,
  getAddressEncoder,
  getProgramDerivedAddress
} from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus(1:4)
const addressEncoder = getAddressEncoder();
const optionalSeedAddress = addressEncoder.encode(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka" as Address
);
const seeds = [optionalSeedAddress];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");

// !focus(1:3)
const optionalSeedAddress = new PublicKey(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka"
);
const seeds = [optionalSeedAddress.toBuffer()];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus
    let optional_seed_address = Pubkey::from_str("B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka")?;
    let seeds: &[&[u8]] = &[optional_seed_address.as_ref()];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

#### اشتقاق PDA باستخدام seeds متعددة

المثال أدناه يشتق PDA باستخدام معرف البرنامج وseeds متعددة اختيارية.

<CodeTabs storage="pda-examples" flags="r">

```ts !! title="Kit"
import {
  Address,
  getAddressEncoder,
  getProgramDerivedAddress
} from "@solana/kit";

const programAddress = "11111111111111111111111111111111" as Address;
// !focus(1:5)
const optionalSeedString = "helloWorld";
const addressEncoder = getAddressEncoder();
const optionalSeedAddress = addressEncoder.encode(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka" as Address
);
const seeds = [optionalSeedString, optionalSeedAddress];
const [pda, bump] = await getProgramDerivedAddress({
  programAddress,
  seeds
});

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```ts !! title="Legacy"
import { PublicKey } from "@solana/web3.js";

const programAddress = new PublicKey("11111111111111111111111111111111");
// !focus(1:4)
const optionalSeedString = "helloWorld";
const optionalSeedAddress = new PublicKey(
  "B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka"
);
const seeds = [Buffer.from(optionalSeedString), optionalSeedAddress.toBuffer()];
const [pda, bump] = await PublicKey.findProgramAddressSync(
  seeds,
  programAddress
);

console.log(`PDA: ${pda}`);
console.log(`Bump: ${bump}`);
```

```rs !! title="Rust"
use solana_sdk::pubkey::Pubkey;
use std::str::FromStr;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let program_address = Pubkey::from_str("11111111111111111111111111111111")?;
    // !focus(1:2)
    let optional_seed_bytes = b"helloWorld";
    let optional_seed_address = Pubkey::from_str("B9Lf9z5BfNPT4d5KMeaBFx8x1G4CULZYR1jA2kmxRDka")?;
    let seeds: &[&[u8]] = &[optional_seed_bytes, optional_seed_address.as_ref()];
    let (pda, bump) = Pubkey::find_program_address(seeds, &program_address);

    println!("PDA: {}", pda);
    println!("Bump: {}", bump);
    Ok(())
}
```

</CodeTabs>

## إنشاء حساب PDA

<WithMentions>

يستخدم المثال أدناه [إطار عمل Anchor](https://www.anchor-lang.com/docs) لإنشاء
حساب جديد بعنوان مشتق من البرنامج. يتضمن البرنامج تعليمة
[`initialize`](mention:initialize) واحدة لإنشاء الحساب الجديد، والذي سيخزن
[عنوان المستخدم](mention:user-address) و[bump seed](mention:bump) المستخدم
لاشتقاق الـ PDA.

```rs title="Program"
use anchor_lang::prelude::*;

declare_id!("75GJVCJNhaukaa2vCCqhreY31gaphv7XTScBChmr1ueR");

#[program]
pub mod pda_account {
    use super::*;

    // !mention initialize
    pub fn initialize(ctx: Context<Initialize>) -> Result<()> {
        let account_data = &mut ctx.accounts.pda_account;
        // store the address of the `user`
        // !mark
        // !mention user-address
        account_data.user = *ctx.accounts.user.key;
        // store the canonical bumpd
        // !mark
        // !mention bump
        account_data.bump = ctx.bumps.pda_account;
        Ok(())
    }
}

#[derive(Accounts)]
pub struct Initialize<'info> {
    #[account(mut)]
    // !mention user-address
    pub user: Signer<'info>,

    #[account(
        init,
        // define the seeds to derive the PDA
        // !mark
        // !mention user-address
        seeds = [b"data", user.key().as_ref()],
        // use the canonical bump
        // !mark
        // !mention bump
        bump,
        payer = user,
        space = 8 + DataAccount::INIT_SPACE
    )]
    pub pda_account: Account<'info, DataAccount>,
    pub system_program: Program<'info, System>,
}

#[account]
#[derive(InitSpace)]
pub struct DataAccount {
    // !mark
    // !mention user-address
    pub user: Pubkey,
    // !mark
    // !mention bump
    pub bump: u8,
}
```

</WithMentions>

<WithMentions>

يخبر قيد [`init`](mention:init) إطار عمل Anchor
بـ[استدعاء System Program](/docs/core/programs#the-system-program) لإنشاء حساب
جديد باستخدام الـ PDA كعنوان. [seeds](mention:seeds) المستخدمة لإنشاء الـ PDA
هي:

- عنوان حساب المستخدم المقدم في التعليمة
- السلسلة الثابتة: "data"
- [bump seed](mention:bump) القانوني

في هذا المثال، لم يتم تعيين قيمة لقيد الـ bump، لذلك سيستخدم Anchor
`find_program_address` لاشتقاق الـ PDA والعثور على الـ bump.

```rust title="pda_account"
#[account(
    // !mention init
    init,
    // !mention seeds
    seeds = [b"data", user.key().as_ref()],
    // !mention bump
    bump,
    payer = user,
    space = 8 + DataAccount::INIT_SPACE
)]
pub pda_account: Account<'info, DataAccount>,
```

</WithMentions>

<WithMentions>

يحتوي ملف الاختبار أدناه على معاملة تستدعي تعليمة
[`initialize`](mention:initialize) لإنشاء حساب جديد بعنوان مشتق من البرنامج.
يحتوي الملف على كود لـ [اشتقاق PDA](mention:pda).

يوضح المثال أيضًا كيفية [جلب](mention:fetch) الحساب الجديد الذي سيتم إنشاؤه.

```ts title="Test"
import * as anchor from "@coral-xyz/anchor";
import { Program } from "@coral-xyz/anchor";
import { PdaAccount } from "../target/types/pda_account";
import { PublicKey } from "@solana/web3.js";

describe("pda-account", () => {
  const provider = anchor.AnchorProvider.env();
  anchor.setProvider(provider);

  const program = anchor.workspace.PdaAccount as Program<PdaAccount>;
  const user = provider.wallet as anchor.Wallet;

  // !mention(1:5) pda
  // Derive the PDA address using the seeds specified on the program
  const [PDA] = PublicKey.findProgramAddressSync(
    [Buffer.from("data"), user.publicKey.toBuffer()],
    program.programId
  );

  it("Is initialized!", async () => {
    const transactionSignature = await program.methods
      // !mention initialize
      .initialize()
      .accounts({
        user: user.publicKey
      })
      .rpc();

    console.log("Transaction Signature:", transactionSignature);
  });

  it("Fetch Account", async () => {
    // !mention fetch
    const pdaAccount = await program.account.dataAccount.fetch(PDA);
    console.log(JSON.stringify(pdaAccount, null, 2));
  });
});
```

</WithMentions>

<Callout type="warn">
  إذا قمت باستدعاء تعليمة `initialize` مرة أخرى بنفس seed عنوان `user`، فستفشل
  المعاملة. يحدث هذا لأن الحساب موجود بالفعل في العنوان المشتق.
</Callout>
