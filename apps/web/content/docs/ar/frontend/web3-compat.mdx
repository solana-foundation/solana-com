---
title: "@solana/web3-compat"
description:
  طبقة توافق مباشرة تتيح لكود @solana/web3.js القديم العمل على أساسيات Kit.
---

`@solana/web3-compat` هو الجسر بين تطبيقات `@solana/web3.js` طويلة الأمد وبيئة
تشغيل Kit الأحدث. قم بتبديل الاستيراد، واحتفظ بالواجهة التي يعرفها تطبيقك
بالفعل، واعتمد ميزات Kit تدريجياً دون إعادة كتابة كل مساعد أو تعليمة دفعة واحدة.

## التثبيت مع تبعيات Kit

```terminal
$ npm install @solana/web3-compat @solana/kit @solana/client
```

تعيد طبقة التوافق تصدير أنواع Web3 الكلاسيكية (`Connection`، `PublicKey`،
`Transaction`، إلخ) بينما تفوض داخلياً إلى شبكات Kit وبرامج الترميز. احتفظ بنقاط
نهاية RPC الحالية، لكن استفد من معالجة blockhash الأكثر قابلية للتنبؤ في Kit
وتجريدات المحفظة.

## استبدال الاستيرادات (بدون تغييرات أخرى في الكود)

يمكن لمعظم المشاريع الترحيل ملف تلو الآخر عن طريق تبديل مصدر الاستيراد. كل من
الاستيرادات المسماة واستيرادات مساحة الأسماء تعكس الحزمة القديمة.

```ts title="Before"
import { Connection, PublicKey } from "@solana/web3.js";
```

```ts title="After"
import { Connection, PublicKey } from "@solana/web3-compat";
```

CommonJS يعمل أيضاً:

```js
const solanaWeb3 = require("@solana/web3-compat");
const connection = new solanaWeb3.Connection("https://api.devnet.solana.com");
```

خلف الكواليس يقوم `Connection` بإعادة توجيه القراءات والكتابات عبر
`@solana/client`، لذا فإن المساعدات مثل `sendAndConfirmTransaction`،
`simulateTransaction`، و`getProgramAccounts` تستفيد من بيئة التشغيل الأحدث دون
لمس منطق العمل الخاص بك.

## مساعدات الجسر عندما تحتاج إلى أنواع Kit

عندما تعتمد Kit مباشرة (ربما في مكونات جديدة تستخدم `@solana/client` أو
`@solana/react-hooks`)، استخدم مساعدات الجسر المشحونة في حزمة التوافق للتحويل
بين النظامين البيئيين:

```ts
import {
  PublicKey,
  toAddress,
  toPublicKey,
  toWeb3Instruction,
  toKitSigner
} from "@solana/web3-compat";

const legacyKey = new PublicKey("11111111111111111111111111111111");
const kitAddress = toAddress(legacyKey);
const backToWeb3 = toPublicKey(kitAddress);
```

يصبح خلط بيئات التشغيل آمناً: يمكن للخطافات الأحدث إصدار تعليمات Kit، ثم سيقوم
`toWeb3Instruction` بتغليفها لتدفقات العمل القديمة حتى ينتقل المشروع بأكمله.

## أنماط الترحيل التدريجي

- **عمليات الطرح التدريجية**: قم بتحديث مجلد ميزة واحدة في كل مرة. عندما لم يعد
  الوحدة بحاجة إلى compat، وجهها مباشرة إلى
  `@solana/client`/`@solana/react-hooks` دون لمس بقية الشجرة.
- **ضبط RPC المشترك**: نظرًا لأن compat يعتمد على اتصالات Kit، فإن ضبط مستويات
  الالتزام أو رسوم الأولوية أو عناوين RPC يتدفق عبر كائن تكوين واحد.
- **مساعدات SPL والمعاملات**: احتفظ بمنشئي المعاملات القديمة في الوقت الحالي،
  لكن استخدم `client.helpers.transaction.prepare` عندما تكون جاهزًا. لا يزال
  بإمكان Compat إرسال نفس الحمولات الموقعة.
- **الاختبار**: أعد استخدام محاكيات Web3 الموجودة نظرًا لأن السطح العام يبقى
  متطابقًا، ومع ذلك يمكنك في الاختبار استبدال عميل Kit بمحاكاة أكثر ثراءً.

## ما يتم شحنه في المرحلة 0

- `Connection` مع `getLatestBlockhash`، `getBalance`، `getAccountInfo`،
  `getProgramAccounts`، `getSignatureStatuses`، `sendRawTransaction`،
  `confirmTransaction`، و`simulateTransaction`.
- أدوات مساعدة مثل `LAMPORTS_PER_SOL`، `sendAndConfirmTransaction`،
  و`compileFromCompat`.
- `SystemProgram.transfer` بالإضافة إلى جميع عناصر Web3 الأساسية (`Keypair`،
  `Transaction`، `VersionedTransaction`، `TransactionInstruction`).

<Callout type="warn" title="التغطية لا تزال تتوسع">
  الطرق خارج القائمة أعلاه تعود إلى `@solana/web3.js` القديم اليوم. احتفظ
  بالتبعية القديمة حتى يصل باقي سطحك إلى compat، وتتبع الإصدارات المستقبلية
  للحصول على دعم الاشتراك وتغطية RPC أوسع.
</Callout>

اقرن هذا الدليل مع [نظرة عامة على @solana/client](/docs/frontend/client)
و[دليل @solana/react-hooks](/docs/frontend/react-hooks) عندما تكون جاهزًا لبدء
بناء واجهة مستخدم جديدة فوق نفس بيئة تشغيل Kit.
