---
title: Distribuisci un programma
description:
  Impara a costruire, distribuire e testare il tuo primo programma Solana
  utilizzando il framework Anchor e Solana Playground. Questa guida per
  principianti illustra come creare un programma semplice, distribuirlo su
  devnet, eseguire test e chiudere il programma.
h1: Distribuisci il tuo primo programma Solana
---

Costruisci, distribuisci e testa il tuo primo [programma](/docs/core/programs)
sulla blockchain Solana utilizzando il framework Anchor. Questa guida ti aiuterà
a familiarizzare con Solana Playground e ti preparerà a utilizzare gli indirizzi
derivati dal programma (Program Derived Address) e l'invocazione tra programmi
(Cross Program Invocation).

<Steps>
<Step>

### Crea un progetto Anchor

1. Apri [Solana Playground](https://beta.solpg.io) nel tuo browser web
2. Nel pannello di sinistra, clicca su **+ Create a new project**
3. Inserisci un **Project name**
4. Seleziona **Anchor (Rust)** come framework
5. Clicca su **Create**

![Nuovo Progetto](/assets/docs/intro/quickstart/pg-new-project.gif)

Il file sorgente `src/lib.rs` si aprirà. Contiene una struct chiamata
`Initialize`, che fa quanto segue:

- Riceve un parametro obbligatorio chiamato _rs`data: u64`_
- Crea un nuovo account
- Salva il valore di _rs`data: u64`_ nel nuovo account
- Aggiunge un messaggio ai log del programma della transazione

<WithNotes>

```rust title="lib.rs"
use anchor_lang::prelude::*;

// This is your program's public key and it will update
// automatically when you build the project.
// !tooltip[/declare_id/] declare_id
declare_id!("11111111111111111111111111111111");

// !tooltip[/program/] program
#[program]
mod hello_anchor {
    use super::*;
    // !tooltip[/data: u64/] parameter
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !tooltip[/ctx.accounts.new_account.data = data/] initialize
        ctx.accounts.new_account.data = data;
        // !tooltip[/msg!/] msg
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}

// !tooltip[/Accounts/] accounts
#[derive(Accounts)]
pub struct Initialize<'info> {
    // We must specify the space in order to initialize an account.
    // First 8 bytes are default account discriminator,
    // next 8 bytes come from NewAccount.data being type u64.
    // (u64 = 64 bits unsigned integer = 8 bytes)
    // !tooltip[/account/] constraints
    #[account(
      // !tooltip[/init/] init
      init,
      // !tooltip[/payer/] payer
      payer = signer,
      // !tooltip[/space/] space
      space = 8 + 8
    )]
    pub new_account: Account<'info, NewAccount>,
    // !tooltip[/account/] constraints
    #[account(mut)]
    pub signer: Signer<'info>,
    pub system_program: Program<'info, System>,
}

// !tooltip[/account/] account
#[account]
pub struct NewAccount {
    data: u64
}
```

### !declare_id

L'indirizzo on-chain del tuo programma. Verrà aggiornato quando compili il
progetto

### !program

Il modulo che contiene le istruzioni del programma

### !accounts

Annota una struct contenente gli account del programma

### !account

Una struct che rappresenta i tipi di dati dell'account che questo programma può
creare e possedere

### !constraints

Vincoli dell'account. Ad esempio, controlli comuni o funzionalità che migliorano
la sicurezza del programma

### !parameter

Il valore passato all'istruzione quando viene chiamata

### !initialize

Accede al campo `data` dell'account `new_account` e lo imposta al valore di
`data: u64`

### !msg

La macro _rs`msg!`_ registra un messaggio nei log del programma della
transazione

### !init

Invoca il System Program per creare un nuovo account e rende questo programma il
proprietario. Come proprietario del programma, questo programma può quindi
scrivere nei dati dell'account

### !payer

L'account che paga per il nuovo account

### !space

Il numero di byte da allocare per l'account

</WithNotes>

<Accordions>

<Accordion title="Spiegazione">

<WithMentions>

- La macro [`declare_id!`](mention:one) specifica l'indirizzo on-chain del tuo
  programma. Solana Playground aggiornerà automaticamente questo indirizzo
  quando compili il programma.

```rs
// !mention one
declare_id!("11111111111111111111111111111111");
```

</WithMentions>

<WithMentions>

- L'attributo [`#[program]`](mention:one) annota un modulo contenente funzioni
  che rappresentano le istruzioni del programma.

```rs
// !mention one
#[program]
mod hello_anchor {
    use super::*;
    // !mention two
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !mention three
        ctx.accounts.new_account.data = data;
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}
```

In questo esempio, l'istruzione [`initialize`](mention:two) accetta due
parametri:

- `ctx: Context<Initialize>`: Passa alla funzione gli account richiesti per
  questa istruzione, come specificato nella struct `Initialize`.
- `data: u64`: Un parametro personalizzato che devi fornire quando chiami
  l'istruzione.

Il corpo della funzione
[imposta il campo `data` di `new_account`](mention:three) con l'argomento `data`
fornito, poi stampa un messaggio nei log del programma.

</WithMentions>

<WithMentions>

- L'attributo [`#[derive(Accounts)]`](mention:one) definisce una struct che
  specifica gli account richiesti per una particolare istruzione. Ogni campo
  rappresenta un account separato.

  Anchor gestisce automaticamente i controlli di sicurezza comuni relativi alla
  validazione degli account attraverso i tipi di campo (es. `Signer<'info>`) e i
  vincoli (es. `#[account(mut)]`).

  ```rs
  // !mention one
  #[derive(Accounts)]
  pub struct Initialize<'info> {
      #[account(init, payer = signer, space = 8 + 8)]
      pub new_account: Account<'info, NewAccount>,
      #[account(mut)]
      pub signer: Signer<'info>,
      pub system_program: Program<'info, System>,
  }
  ```

</WithMentions>

<WithMentions>

- L'attributo [`#[account]`](mention:one) definisce una struct che rappresenta
  il tipo di dati per gli account che questo programma crea e possiede.

```rs
// !mention one
#[account]
pub struct NewAccount {
  data: u64
}
```

</WithMentions>

</Accordion>
</Accordions>

</Step>
<Step>

### Compilare e distribuire il programma

1. Compila il codice del programma

```terminal
$ build
Building...
Build successful. Completed in 1.46s.
```

<Callout>
  Il tuo [ID programma](/docs/intro/quick-start/deploying-programs), definito in
  _rs`declare_id!()`_, sarà ora aggiornato.
</Callout>

2. Aggiungi SOL al tuo wallet _(Opzionale)_

La distribuzione di un programma richiede SOL nell'account on-chain del
programma. Se necessario,
[aggiungi SOL al tuo wallet](/docs/intro/quick-start#add-sol-to-your-wallet)
prima di procedere al passaggio 3.

3. Distribuisci il programma sulla rete

```terminal
$ deploy
Deploying... This could take a while depending on the program size and network conditions.
Warning: 1 transaction not confirmed, retrying...
Deployment successful. Completed in 19s.
```

<Callout type="info">
  Quando viene distribuito, il bytecode del programma viene memorizzato in un
  program account eseguibile.
</Callout>

**Nota:** Se preferisci, puoi utilizzare i pulsanti **Build** e **Deploy** nel
pannello laterale sinistro, come mostrato nello screenshot qui sotto.

![Build e Deploy](/assets/docs/intro/quickstart/pg-build-deploy.png)

</Step>
<Step>

### Testare il programma

<WithMentions>

1. Apri il file di test chiamato `tests/anchor.test.ts`. Questo file dimostra
   come invocare la struct [`initialize`](mention:one) del programma dal client.

```ts title="anchor.test.ts"
// No imports needed: web3, anchor, pg and more are globally available

describe("Test", () => {
  it("initialize", async () => {
    // Generate keypair for the new account
    const newAccountKp = new web3.Keypair();

    // Send transaction
    const data = new BN(42);
    const txHash = await pg.program.methods
      // !mention one
      .initialize(data)
      .accounts({
        newAccount: newAccountKp.publicKey,
        signer: pg.wallet.publicKey,
        systemProgram: web3.SystemProgram.programId
      })
      .signers([newAccountKp])
      .rpc();
    console.log(`Use 'solana confirm -v ${txHash}' to see the logs`);

    // Confirm transaction
    await pg.connection.confirmTransaction(txHash);

    // Fetch the created account
    const newAccount = await pg.program.account.newAccount.fetch(
      newAccountKp.publicKey
    );

    console.log("On-chain data is:", newAccount.data.toString());

    // Check whether the data on-chain is equal to local 'data'
    assert(data.eq(newAccount.data));
  });
});
```

</WithMentions>

2. Esegui il file di test

```terminal
$ test
Running tests...
  hello_anchor.test.ts:
  hello_anchor
    Use 'solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc' to see the logs
    On-chain data is: 42
    ✔ initialize (961ms)
  1 passing (963ms)
```

3. Memorizza l'hash della transazione (`TxHash`) incluso nell'output

(Nell'esempio sopra, l'hash della transazione è
`3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc`.)

**Nota:** Se preferisci, puoi utilizzare il pulsante `Test` nel pannello
laterale sinistro.

![Esegui Test](/assets/docs/intro/quickstart/pg-test.png)

4. Esegui `solana confirm -v [TxHash]` per visualizzare i log della transazione

```terminal
$ solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
RPC URL: https://api.devnet.solana.com
Default Signer: Playground Wallet
Commitment: confirmed

Transaction executed in slot 308150984:
  Block Time: 2024-06-25T12:52:05-05:00
  Version: legacy
  Recent Blockhash: 7AnZvY37nMhCybTyVXJ1umcfHSZGbngnm4GZx6jNRTNH
  Signature 0: 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
  Signature 1: 3TrRbqeMYFCkjsxdPExxBkLAi9SB2pNUyg87ryBaTHzzYtGjbsAz9udfT9AkrjSo1ZjByJgJHBAdRVVTZv6B87PQ
  Account 0: srw- 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (fee payer)
  Account 1: srw- c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J
  Account 2: -r-- 11111111111111111111111111111111
  Account 3: -r-x 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
  Instruction 0
    Program:   2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r (3)
    Account 0: c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J (1)
    Account 1: 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (0)
    Account 2: 11111111111111111111111111111111 (2)
    Data: [175, 175, 109, 31, 13, 152, 155, 237, 42, 0, 0, 0, 0, 0, 0, 0]
  Status: Ok
    Fee: ◎0.00001
    Account 0 balance: ◎5.47001376 -> ◎5.46900152
    Account 1 balance: ◎0 -> ◎0.00100224
    Account 2 balance: ◎0.000000001
    Account 3 balance: ◎0.00139896
  Log Messages:
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r invoke [1]
    Program log: Instruction: Initialize
    Program 11111111111111111111111111111111 invoke [2]
    Program 11111111111111111111111111111111 success
    Program log: Changed data to: 42!
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r consumed 5661 of 200000 compute units
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r success

Confirmed
```

4. Visualizza i dettagli della transazione

Apri [SolanaFM](https://solana.fm/) oppure
[Solana Explorer](https://explorer.solana.com/?cluster=devnet) e cerca l'hash
della transazione.

<Callout type="warn">
  **Solana Explorer:** Imposta il cluster di rete su `devnet`, per corrispondere
  a quello di Solana Playground.
</Callout>

</Step>
<Step>

### Chiudi il programma

Chiudi il programma per recuperare il SOL allocato al programma on-chain. Per
farlo, esegui `solana program close [ProgramID]`, utilizzando l'indirizzo del
programma memorizzato nella macro _rs`declare_id!()`_.

```terminal
$ solana program close 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
Closed Program Id 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r, 2.79511512 SOL reclaimed
```

<Callout type="warn">
  I programmi possono essere **solo** chiusi o aggiornati da un account con
  autorità di aggiornamento. Il tuo wallet di Playground diventa automaticamente
  l'autorità di aggiornamento per ogni programma quando viene distribuito. Se
  l'autorità di aggiornamento viene revocata, il programma diventa immutabile.
</Callout>

Congratulazioni! Hai creato e distribuito il tuo primo programma Solana
utilizzando Anchor.

</Step>
</Steps>

## Prossimi passi

Ora che hai distribuito il tuo primo programma, sei pronto per esplorare
[gli indirizzi derivati dal programma](/docs/intro/quick-start/program-derived-address)
e
[l'invocazione tra programmi](/docs/intro/quick-start/cross-program-invocation).
