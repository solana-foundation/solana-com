---
title: Ohjelmien käyttöönotto
description:
  Täydellinen opas Solana-ohjelmien rakentamiseen, käyttöönottoon ja hallintaan
  Solana CLI:n avulla.
---

Tämä osio käy läpi perusvaiheiden prosessin Solana-ohjelman käyttöönotosta
Solana CLI:n avulla.

## CLI-komentojen viiteluettelo

| Tehtävä                                 | Komento                                                                                       |
| --------------------------------------- | --------------------------------------------------------------------------------------------- |
| Ohjelman rakentaminen                   | `cargo build-sbf`                                                                             |
| Uuden ohjelman käyttöönotto             | `solana program deploy <path_to_program.so>`                                                  |
| Olemassa olevan ohjelman päivitys       | `solana program deploy <path_to_program.so>` (sama kuin käyttöönotto)                         |
| Ohjelman tietojen näyttäminen           | `solana program show <program-id>`                                                            |
| Ohjelman käyttöoikeuden siirto          | `solana program set-upgrade-authority <program-id> --new-upgrade-authority <path_to_keypair>` |
| Ohjelman muuttaminen muuttumattomaksi   | `solana program set-upgrade-authority <program-id> --final`                                   |
| Ohjelman sulkeminen                     | `solana program close <program-id> --bypass-warning`                                          |
| Lompakon saldon tarkistaminen           | `solana balance`                                                                              |
| Airdropin pyytäminen (devnet/localhost) | `solana airdrop 2`                                                                            |

## Keskeiset käsitteet

Ennen kuin syvennymme aiheeseen, selvennetään joitakin termejä:

- **Program ID**: Ohjelmasi osoite lohkoketjussa. Käyttäjät ovat
  vuorovaikutuksessa ohjelmasi kanssa viittaamalla Program ID:hen.
- **Program Account**: Lohkoketjussa oleva tili, joka tallentaa ohjelmasi
  metatiedot. Program accountin osoite on Program ID. Program account tallentaa
  myös ProgramData Accountin osoitteen.
- **ProgramData Account**: Lohkoketjussa oleva tili, joka tallentaa ohjelmasi
  käyttöönotetun suoritettavan koodin.
- **Program Authority**: Tili, jolla on oikeus päivittää tai sulkea ohjelma.
  Oletusarvoisesti tämä on CLI-lompakkosi.

## Edellytykset

<Steps>

<Step>

### Asenna Solana CLI

Ensin [asenna Solana CLI](/docs/intro/installation).

</Step>

<Step>

### Lompakon määrittäminen

Asennuksen jälkeen luo paikallinen keypair-lompakko. Tämän lompakon osoite
asetetaan oletusarvoiseksi program authorityksi ohjelmia käyttöönotettaessa:

```terminal
$ solana-keygen new
```

Tämä luo keypair-tiedoston oletusarvoisesti sijaintiin
`~/.config/solana/id.json`.

</Step>

<Step>

### Klusterin määrittäminen

Valitse, mihin Solana-klusteriin haluat tehdä käyttöönoton. Käytä komentoa
`solana config get` tarkistaaksesi nykyisen määrityksesi:

```terminal
$ solana config get
Config File: ~/.config/solana/cli/config.yml
RPC URL: http://localhost:8899
WebSocket URL: ws://localhost:8900/ (computed)
Keypair Path: ~/.config/solana/id.json
Commitment: confirmed
```

Vaihda klusterien välillä tarpeen mukaan:

```terminal
$ solana config set --url mainnet-beta
$ solana config set --url devnet
$ solana config set --url localhost
$ solana config set --url testnet
$ solana config set --url "https://your-rpc-url.com"
```

</Step>

<Step>

### Lompakon rahoittaminen

Tarvitset SOL-tokeneita ohjelmien käyttöönottoa varten. Tarvittava määrä riippuu
ohjelmasi koosta.

Devnet- tai localhost-ympäristössä voit rahoittaa lompakkosi käyttämällä
komentoa `solana airdrop`:

```terminal
$ solana airdrop 2
Requesting airdrop of 2 SOL
Signature: 5zQKxvRdgJDA8fRGPdKfGxRLnLpwmNnMXGYxfBqFSUPqc5BTmFPrTG8vnC4HvKDVY8zQ8aQxZxcEE7WFpGhZGVAA
2 SOL
```

Tarkista lompakkosi saldo:

```terminal
$ solana balance
2 SOL
```

</Step>

</Steps>

## Perustoiminnot

### Ohjelman rakentaminen

Rakentaaksesi ohjelman käytä komentoa `cargo build-sbf`:

```terminal
$ cargo build-sbf
```

<ScrollyCoding>

## !!steps Esimerkkiohjelma

Tässä on minimaalinen Solana-ohjelma, joka tulostaa "Hello, Solana!" ohjelman
lokeihin.

<CodePlaceholder title="src/lib.rs" />

```rs !! title="src/lib.rs"
use solana_program::{
    account_info::AccountInfo, entrypoint, entrypoint::ProgramResult, msg, pubkey::Pubkey,
};

entrypoint!(process_instruction);

pub fn process_instruction(
    _program_id: &Pubkey,
    _accounts: &[AccountInfo],
    _instruction_data: &[u8],
) -> ProgramResult {
    msg!("Hello, Solana!");
    Ok(())
}
```

```toml !! title="Cargo.toml"
[package]
name = "hello_world"
version = "0.1.0"
edition = "2021"

[lib]
crate-type = ["cdylib", "lib"]

[dependencies]
solana-program = "2.2.0"
```

## !!steps Käännöksen tulos

Rakenna ohjelmasi käyttämällä `cargo build-sbf` komentoa:

```terminal
$ cargo build-sbf
```

Tämä luo kaksi tärkeää tiedostoa hakemistoon `target/deploy/`:

1. `hello_world-keypair.json`: Keypair-tiedosto, jonka julkista avainta
   käytetään ohjelmatunnuksenasi (Program ID)
2. `hello_world.so`: Käännetty ohjelmatiedosto

```json !! title="target/deploy/hello_world-keypair.json"
[
  203, 253, 43, 62, 165, 111, 94, 222, 105, 225, 218, 85, 143, 9, 114, 96, 243,
  181, 114, 89, 72, 230, 124, 85, 59, 165, 198, 23, 240, 212, 23, 154, 229, 241,
  153, 61, 153, 105, 79, 204, 193, 163, 33, 65, 82, 183, 49, 240, 224, 137, 248,
  24, 128, 25, 192, 197, 118, 235, 239, 67, 85, 156, 219, 231
]
```

```txt !! title="target/deploy/hello_world.so"
[binary executable file]
```

</ScrollyCoding>

### Tarkista ohjelman koko ja kustannukset

Ohjelman käyttöönotto vaatii SOL-tokeneita, jotka allokoidaan ohjelmatilille
ohjelman koon perusteella. Suuremmat ohjelmat maksavat enemmän SOL-tokeneita
käyttöönotossa.

Tarkista ohjelmasi koko:

```terminal
$ wc -c < ./target/deploy/hello_world.so
18504
```

Laske tarvittava SOL-määrä tälle koolle (tavuina):

```terminal
$ solana rent 18504
Rent-exempt minimum: 0.12967872 SOL
```

<Callout type="info">
  Tarvitset hieman enemmän SOL-tokeneita kuin näytetty kattaaksesi käyttöönoton
  transaktiomaksut.
</Callout>

### Ota ohjelma käyttöön

Käytä `solana program deploy` komentoa ottaaksesi ohjelmasi käyttöön:

```terminal
$ solana program deploy ./target/deploy/hello_world.so
Program Id: 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
Signature: 2BYwsqRP7ZwBNQvJp3S8bphTJ4zKW5JBPVMqCTE5KyLkP8xHzAyUEeC4LdTgjJdGBKHWNCkRF8Mf1T1WkLFyEu8W
```

Näytetty **Program Id** on ohjelmasi pysyvä osoite verkossa.

<Callout>

Jos haluat ottaa ohjelman käyttöön tietyllä Program ID:llä (automaattisesti
luodun sijaan), käytä:

```terminal
$ solana program deploy ./target/deploy/hello_world.so --program-id ./custom-keypair.json
```

Voit luoda uusia keypair-avaimia käyttämällä `solana-keygen` komentoa:

```terminal
$ solana-keygen new -o ./custom-keypair.json
```

</Callout>

### Päivitä ohjelma

Päivitä ohjelmasi käyttämällä samaa `solana program deploy` komentoa:

1. Tee muutoksia ohjelmakoodiisi
2. Rakenna ohjelmasi uudelleen: `cargo build-sbf`
3. Ota päivitys käyttöön:

```terminal
$ solana program deploy ./target/deploy/hello_world.so
Program Id: 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
Signature: 3zKnXDfEm1R8hVcEmTnNFYUaFjVVbLJrKdFj5hBMXoBRfz8xGyDhCYgKr9YY5KxKYPEUQQVfwEPNz9hQGvYhLNBJ
```

<Callout type="info">

Jos päivitetty ohjelmasi vaatii enemmän tilaa (tavuja) kuin on tällä hetkellä
varattu, käyttöönotto laajentaa automaattisesti program account -tiliä. Näin
tapahtuu, kun uusi ohjelmasi on suurempi kuin edellinen versio. Program account
tarvitsee lisää tavuja uuden ohjelman tallentamiseen. CLI laskee tarvittavan
SOL-määrän ja vähentää sen automaattisesti lompakostasi.

Voit myös manuaalisesti laajentaa ohjelmaa varataksesi lisää tavuja:

```terminal
$ solana program extend 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE 1000
Extended Program Id 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE by 1000 bytes
```

</Callout>

## Ohjelman hallinta

Kun ohjelmasi on otettu käyttöön, on olemassa useita yleisiä komentoja program
account -tilin hallintaan.

### Tarkastele ohjelman metatietoja

Tarkistaaksesi ohjelmasi metatiedot, käytä `solana program show` komentoa:

```terminal
$ solana program show 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE
```

<WithNotes>

Esimerkki tulostuksesta:

```txt
$ solana program show 7283x8k8fyBcfaFLyPsxbd2VV1AMmZFP7FNoyTXVKJw7
# !tooltip[/Program Id/] program-id
Program Id: 7283x8k8fyBcfaFLyPsxbd2VV1AMmZFP7FNoyTXVKJw7
# !tooltip[/Owner/] owner
Owner: BPFLoaderUpgradeab1e11111111111111111111111
# !tooltip[/ProgramData Address/] program-data-address
ProgramData Address: Gqn7YQVCP8NtYV1qkEqR4Udhj8EJ3fkikvS7HskCNQ7c
# !tooltip[/Authority/] authority
Authority: 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1
# !tooltip[/Last Deployed In Slot/] last-deployed-in-slot
Last Deployed In Slot: 6573
# !tooltip[/Data Length/] data-length
Data Length: 18504 (0x4848) bytes
# !tooltip[/Balance/] balance
Balance: 0.12999192 SOL
```

### !program-id

Program ID on ohjelmatilin osoite lohkoketjussa. Käyttäjät ja muut ohjelmat
kutsuvat ohjelmaasi viittaamalla tähän tunnukseen transaktioissaan.

### !owner

Owner määrittää, mitä latausohjelmaa käytettiin tämän ohjelman käyttöönottoon.
Useimpien ohjelmien kohdalla tämä on BPF Upgradeable Loader.

### !program-data-address

ProgramData Address osoittaa erilliseen tiliin, joka tallentaa ohjelmasi
suoritettavan koodin.

### !authority

Authority on tili, jolla on oikeus päivittää tai sulkea tämä ohjelma. Vain
authority voi ottaa käyttöön päivityksiä tai sulkea ohjelman saadakseen takaisin
ohjelmalle allokoidun SOLin.

### !last-deployed-in-slot

Last Deployed In Slot osoittaa, milloin tätä ohjelmaa viimeksi päivitettiin.

### !data-length

Data Length näyttää tälle ohjelmalle varattujen tavujen kokonaismäärän. Tämä
tila voi mahdollistaa tulevat päivitykset, jotka saattavat olla suurempia kuin
nykyisen ohjelman koko.

### !balance

Balance näyttää ohjelmatilille allokoidun SOLin määrän sen tietojen
tallentamiseen.

</WithNotes>

### Ohjelman authorityn siirtäminen

Siirtääksesi ohjelman authorityn toiselle tilille, käytä
`solana program set-upgrade-authority` komentoa:

```terminal
$ solana program set-upgrade-authority 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --new-upgrade-authority ./new-authority-keypair.json
```

<Callout type="warn">
  Kun olet siirtänyt ohjelman authorityn, et voi enää päivittää ohjelmaa, ellei
  sinulla ole pääsyä uuteen authority-keypairiin.
</Callout>

### Ohjelman tekeminen muuttumattomaksi

Tehdäksesi ohjelmastasi muuttumattoman, käytä
`solana program set-upgrade-authority` komentoa `--final` lipulla poistaaksesi
ohjelman authorityn:

```terminal
$ solana program set-upgrade-authority 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --final
Account Type: Program
Authority: none
```

<Callout type="warn">
  Kun ohjelma on tehty muuttumattomaksi, sitä ei voi koskaan päivittää tai
  sulkea.
</Callout>

### Ohjelman sulkeminen

Sulkeaksesi ohjelmasi ja saadaksesi takaisin ohjelmatilille allokoidun SOLin,
käytä `solana program close` komentoa:

```terminal
$ solana program close 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE --bypass-warning
Closed Program Id 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE, 0.12999192 SOL reclaimed
```

<Callout type="warn">
  Kun ohjelma on suljettu, Program ID:tä ei voi käyttää uudelleen. Et voi ottaa
  käyttöön uutta ohjelmaa samaan osoitteeseen.
</Callout>

## Apukomennot

### Kaikkien ohjelmien listaaminen

Näytä kaikki ohjelmat, joissa nykyinen lompakkosi on authority:

```terminal
$ solana program show --programs
```

Esimerkki tulostuksesta:

```txt
Program Id                                       | Slot       | Authority                                      | Balance
-------------------------------------------------|------------|------------------------------------------------|-------------
7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE     | 249885434  | 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1   | 0.12999192
3KSGCk4m5hqJkTjPHBXUCPcqMwJnK3VmkqEsFUKKGJPK     | 249883212  | 5kh6HxYZiAebF8HWLsUWod2EaQQ6iWHpHYCz8UcmFbM1   | 0.28654328
```

### Käyttöönotetun ohjelman lataaminen

Käyttöönotetun ohjelman lataamiseen käytä `solana program dump` komentoa:

```terminal
$ solana program dump 7NxQjW8H8hVcqBKgXbVDWqGQCovHbqDW9p1SJJwUyTpE ./downloaded_program.so
Wrote program to ./downloaded_program.so
```

## Edistyneet vaihtoehdot

### Käyttöönottolippuja

Kun Solana-verkko on ruuhkainen, käytä näitä lippuja auttamaan ohjelman
käyttöönotossa.

Esimerkki käytöstä:

```terminal
$ solana program deploy ./target/deploy/hello_world.so \
    --with-compute-unit-price 10000 \
    --max-sign-attempts 10 \
    --use-rpc
```

Vaihtoehtojen selitykset:

- **`--with-compute-unit-price`**: Aseta prioriteettimaksu mikro-lamporteissa
  (0.000001 SOL) laskentayksikköä kohden. Tarkista
  [Helius Priority Fee API](https://docs.helius.dev/guides/priority-fee-api)
  nykyiset hinnat. Prioriteettimaksu on lisämaksu, joka maksetaan nykyiselle
  johtajalle transaktiosi priorisoimiseksi.
- **`--max-sign-attempts`**: Kuinka monta kertaa yritetään uudelleen uudella
  blockhashilla, jos transaktiot vanhenevat. (Oletus: 5)
- **`--use-rpc`**: Lähetä transaktiot määritettyyn RPC:hen. Tämä lippu vaatii
  [stake-weighted](/developers/guides/advanced/stake-weighted-qos) RPC-yhteyden
  palveluntarjoajilta kuten [Triton](https://triton.one/) tai
  [Helius](https://www.helius.dev/).
