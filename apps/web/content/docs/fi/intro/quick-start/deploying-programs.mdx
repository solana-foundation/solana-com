---
title: Ohjelman käyttöönotto
description:
  Opi rakentamaan, ottamaan käyttöön ja testaamaan ensimmäinen Solana-ohjelmasi
  käyttäen Anchor-kehystä ja Solana Playgroundia. Tämä aloittelijaystävällinen
  opas käy läpi yksinkertaisen ohjelman luomisen, sen käyttöönoton devnetissä,
  testien suorittamisen ja ohjelman sulkemisen.
h1: Ota käyttöön ensimmäinen Solana-ohjelmasi
---

Rakenna, ota käyttöön ja testaa ensimmäinen [ohjelmasi](/docs/core/programs)
Solana-lohkoketjussa käyttäen Anchor-kehystä. Tämä opas auttaa sinua tutustumaan
paremmin Solana Playgroundiin ja valmistaa sinua käyttämään Program Derived
Address -osoitteita (PDA) ja Cross Program Invocation -toimintoa (CPI).

<Steps>

<Step>

### Luo Anchor-projekti

1. Avaa [Solana Playground](https://beta.solpg.io) verkkoselaimessasi
2. Napsauta vasemmassa paneelissa **+ Create a new project**
3. Syötä **Project name** (projektin nimi)
4. Valitse kehykseksi **Anchor (Rust)**
5. Napsauta **Create**

![Uusi projekti](/assets/docs/intro/quickstart/pg-new-project.gif)

`src/lib.rs` lähdetiedosto avautuu. Se sisältää yhden struktuurin nimeltä
`Initialize`, joka tekee seuraavaa:

- Vastaanottaa vaaditun parametrin nimeltä _rs`data: u64`_
- Luo uuden tilin
- Tallentaa _rs`data: u64`_-arvon uuteen tiliin
- Lisää viestin tapahtuman ohjelman lokeihin

<WithNotes>

```rust title="lib.rs"
use anchor_lang::prelude::*;

// This is your program's public key and it will update
// automatically when you build the project.
// !tooltip[/declare_id/] declare_id
declare_id!("11111111111111111111111111111111");

// !tooltip[/program/] program
#[program]
mod hello_anchor {
    use super::*;
    // !tooltip[/data: u64/] parameter
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !tooltip[/ctx.accounts.new_account.data = data/] initialize
        ctx.accounts.new_account.data = data;
        // !tooltip[/msg!/] msg
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}

// !tooltip[/Accounts/] accounts
#[derive(Accounts)]
pub struct Initialize<'info> {
    // We must specify the space in order to initialize an account.
    // First 8 bytes are default account discriminator,
    // next 8 bytes come from NewAccount.data being type u64.
    // (u64 = 64 bits unsigned integer = 8 bytes)
    // !tooltip[/account/] constraints
    #[account(
      // !tooltip[/init/] init
      init,
      // !tooltip[/payer/] payer
      payer = signer,
      // !tooltip[/space/] space
      space = 8 + 8
    )]
    pub new_account: Account<'info, NewAccount>,
    // !tooltip[/account/] constraints
    #[account(mut)]
    pub signer: Signer<'info>,
    pub system_program: Program<'info, System>,
}

// !tooltip[/account/] account
#[account]
pub struct NewAccount {
    data: u64
}
```

### !declare_id

Ohjelmasi lohkoketjuosoite. Se päivitetään, kun rakennat projektin

### !program

Moduuli, joka sisältää ohjelman ohjeet

### !accounts

Merkitsee struktuurin, joka sisältää ohjelman tilit

### !account

Struktuuri, joka edustaa tilitietojen tyyppejä, joita tämä ohjelma voi luoda ja
omistaa

### !constraints

Tilien rajoitukset. Esimerkiksi yleiset tarkistukset tai ominaisuudet, jotka
parantavat ohjelman turvallisuutta

### !parameter

Arvo, joka välitetään ohjeelle, kun sitä kutsutaan

### !initialize

Käyttää `new_account`tilin `data`kenttää ja asettaa sen arvoksi `data: u64`

### !msg

_rs`msg!`_ makro kirjaa viestin transaktion ohjelman lokeihin

### !init

Kutsuu System Programia luomaan uuden tilin ja tekee tästä ohjelmasta omistajan.
Ohjelman omistajana tämä ohjelma voi sitten kirjoittaa tilin tietoihin

### !payer

Tili, joka maksaa uuden tilin

### !space

Tilille varattavien tavujen määrä

</WithNotes>

<Accordions>

<Accordion title="Selitys">

<WithMentions>

- [`declare_id!`](mention:one) makro määrittää ohjelmasi lohkoketjuosoitteen.
  Solana Playground päivittää tämän osoitteen automaattisesti, kun rakennat
  ohjelman.

```rs
// !mention one
declare_id!("11111111111111111111111111111111");
```

</WithMentions>

<WithMentions>

- [`#[program]`](mention:one) attribuutti merkitsee moduulin, joka sisältää
  funktioita, jotka edustavat ohjelman ohjeita.

```rs
// !mention one
#[program]
mod hello_anchor {
    use super::*;
    // !mention two
    pub fn initialize(ctx: Context<Initialize>, data: u64) -> Result<()> {
        // !mention three
        ctx.accounts.new_account.data = data;
        msg!("Changed data to: {}!", data); // Message will show up in the tx logs
        Ok(())
    }
}
```

Tässä esimerkissä [`initialize`](mention:two) ohje ottaa kaksi parametria:

- `ctx: Context<Initialize>`: Välittää tämän ohjeen vaatimat tilit funktiolle,
  kuten `Initialize` rakenteessa on määritelty.
- `data: u64`: Mukautettu parametri, joka sinun on annettava, kun kutsut
  ohjetta.

Funktion runko [asettaa `new_account`tilin `data`kentän](mention:three)
annettuun `data` argumenttiin ja tulostaa sitten viestin ohjelman lokeihin.

</WithMentions>

<WithMentions>

- [`#[derive(Accounts)]`](mention:one) -attribuutti määrittelee rakenteen, joka
  määrittää tiettyyn ohjeeseen tarvittavat tilit. Jokainen kenttä edustaa
  erillistä tiliä.

  Anchor käsittelee automaattisesti yleisiä tilien validointiin liittyviä
  turvallisuustarkistuksia kenttätyyppien (esim. `Signer<'info>`) ja
  rajoitteiden (esim. `#[account(mut)]`) avulla.

  ```rs
  // !mention one
  #[derive(Accounts)]
  pub struct Initialize<'info> {
      #[account(init, payer = signer, space = 8 + 8)]
      pub new_account: Account<'info, NewAccount>,
      #[account(mut)]
      pub signer: Signer<'info>,
      pub system_program: Program<'info, System>,
  }
  ```

</WithMentions>

<WithMentions>

- [`#[account]`](mention:one) -attribuutti määrittelee rakenteen, joka edustaa
  tilien tietotyyppiä, joita tämä ohjelma luo ja omistaa.

```rs
// !mention one
#[account]
pub struct NewAccount {
  data: u64
}
```

</WithMentions>

</Accordion>
</Accordions>

</Step>

<Step>

### Ohjelman rakentaminen ja käyttöönotto

1. Käännä ohjelmakoodi

```terminal
$ build
Building...
Build successful. Completed in 1.46s.
```

<Callout>
  [Ohjelmatunnuksesi](/docs/intro/quick-start/deploying-programs), joka on
  määritelty tiedostossa _rs`declare_id!()`_, päivitetään nyt.
</Callout>

2. Lisää SOL lompakkoosi _(Valinnainen)_

Ohjelman käyttöönotto vaatii SOL-tokeneita ohjelman lohkoketjutilillä.
Tarvittaessa
[lisää SOL lompakkoosi](/docs/intro/quick-start#add-sol-to-your-wallet) ennen
siirtymistä vaiheeseen 3.

3. Ota ohjelma käyttöön verkossa

```terminal
$ deploy
Deploying... This could take a while depending on the program size and network conditions.
Warning: 1 transaction not confirmed, retrying...
Deployment successful. Completed in 19s.
```

<Callout type="info">
  Käyttöönoton yhteydessä ohjelman tavukoodi tallennetaan suoritettavaan program
  account -tiliin.
</Callout>

**Huomautus:** Halutessasi voit käyttää **Build**- ja **Deploy**-painikkeita
vasemman reunan paneelissa, kuten alla olevassa kuvakaappauksessa näytetään.

![Build ja Deploy](/assets/docs/intro/quickstart/pg-build-deploy.png)

</Step>

<Step>

### Ohjelman testaaminen

<WithMentions>

1. Avaa testitiedosto nimeltä `tests/anchor.test.ts`. Tämä tiedosto näyttää,
   miten ohjelman [`initialize`](mention:one) -rakennetta kutsutaan
   asiakaspuolelta.

```ts title="anchor.test.ts"
// No imports needed: web3, anchor, pg and more are globally available

describe("Test", () => {
  it("initialize", async () => {
    // Generate keypair for the new account
    const newAccountKp = new web3.Keypair();

    // Send transaction
    const data = new BN(42);
    const txHash = await pg.program.methods
      // !mention one
      .initialize(data)
      .accounts({
        newAccount: newAccountKp.publicKey,
        signer: pg.wallet.publicKey,
        systemProgram: web3.SystemProgram.programId
      })
      .signers([newAccountKp])
      .rpc();
    console.log(`Use 'solana confirm -v ${txHash}' to see the logs`);

    // Confirm transaction
    await pg.connection.confirmTransaction(txHash);

    // Fetch the created account
    const newAccount = await pg.program.account.newAccount.fetch(
      newAccountKp.publicKey
    );

    console.log("On-chain data is:", newAccount.data.toString());

    // Check whether the data on-chain is equal to local 'data'
    assert(data.eq(newAccount.data));
  });
});
```

</WithMentions>

2. Suorita testitiedosto

```terminal
$ test
Running tests...
  hello_anchor.test.ts:
  hello_anchor
    Use 'solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc' to see the logs
    On-chain data is: 42
    ✔ initialize (961ms)
  1 passing (963ms)
```

3. Tallenna tulosteessa näkyvä transaktiotunniste (`TxHash`)

(Yllä olevassa esimerkissä transaktiotunniste on
`3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc`.)

**Huomaa:** Halutessasi voit käyttää `Test` -painiketta vasemman reunan
paneelissa.

![Suorita testi](/assets/docs/intro/quickstart/pg-test.png)

4. Suorita `solana confirm -v [TxHash]` nähdäksesi transaktion lokit

```terminal
$ solana confirm -v 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
RPC URL: https://api.devnet.solana.com
Default Signer: Playground Wallet
Commitment: confirmed

Transaction executed in slot 308150984:
  Block Time: 2024-06-25T12:52:05-05:00
  Version: legacy
  Recent Blockhash: 7AnZvY37nMhCybTyVXJ1umcfHSZGbngnm4GZx6jNRTNH
  Signature 0: 3TewJtiUz1EgtT88pLJHvKFzqrzDNuHVi8CfD2mWmHEBAaMfC5NAaHdmr19qQYfTiBace6XUmADvR4Qrhe8gH5uc
  Signature 1: 3TrRbqeMYFCkjsxdPExxBkLAi9SB2pNUyg87ryBaTHzzYtGjbsAz9udfT9AkrjSo1ZjByJgJHBAdRVVTZv6B87PQ
  Account 0: srw- 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (fee payer)
  Account 1: srw- c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J
  Account 2: -r-- 11111111111111111111111111111111
  Account 3: -r-x 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
  Instruction 0
    Program:   2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r (3)
    Account 0: c7yy8zdP8oeZ2ewbSb8WWY2yWjDpg3B43jk3478Nv7J (1)
    Account 1: 3z9vL1zjN6qyAFHhHQdWYRTFAcy69pJydkZmSFBKHg1R (0)
    Account 2: 11111111111111111111111111111111 (2)
    Data: [175, 175, 109, 31, 13, 152, 155, 237, 42, 0, 0, 0, 0, 0, 0, 0]
  Status: Ok
    Fee: ◎0.00001
    Account 0 balance: ◎5.47001376 -> ◎5.46900152
    Account 1 balance: ◎0 -> ◎0.00100224
    Account 2 balance: ◎0.000000001
    Account 3 balance: ◎0.00139896
  Log Messages:
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r invoke [1]
    Program log: Instruction: Initialize
    Program 11111111111111111111111111111111 invoke [2]
    Program 11111111111111111111111111111111 success
    Program log: Changed data to: 42!
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r consumed 5661 of 200000 compute units
    Program 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r success

Confirmed
```

4. Tarkastele transaktion tietoja

Avaa joko [SolanaFM](https://solana.fm/) tai
[Solana Explorer](https://explorer.solana.com/?cluster=devnet) ja hae
transaktiotunnisteella.

<Callout type="warn">
  **Solana Explorer:** Aseta verkkoklusteriksi `devnet`, jotta se vastaa Solana
  Playgroundin klusteria.
</Callout>

</Step>

<Step>

### Sulje ohjelma

Sulje ohjelma saadaksesi takaisin lohkoketjuohjelmalle allokoidun SOL-määrän.
Tee tämä suorittamalla `solana program close [ProgramID]`, käyttäen
_rs`declare_id!()`_ -makroon tallennettua ohjelman osoitetta.

```terminal
$ solana program close 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r
Closed Program Id 2VvQ11q8xrn5tkPNyeraRsPaATdiPx8weLAD8aD4dn2r, 2.79511512 SOL reclaimed
```

<Callout type="warn">
  Ohjelmia voi **ainoastaan** sulkea tai päivittää tili, jolla on
  päivitysoikeudet. Playground-lompakkosi saa automaattisesti päivitysoikeudet
  jokaiseen ohjelmaan, kun se otetaan käyttöön. Jos päivitysoikeudet
  peruutetaan, ohjelmasta tulee muuttumaton.
</Callout>

Onnittelut! Rakensit ja otit käyttöön ensimmäisen Solana-ohjelmasi Anchoria
käyttäen.

</Step>

</Steps>

## Seuraavat vaiheet

Nyt kun olet ottanut käyttöön ensimmäisen ohjelmasi, olet valmis tutustumaan
[ohjelmasta johdettuihin osoitteisiin](/docs/intro/quick-start/program-derived-address)
ja
[ohjelmien välisiin kutsuihin](/docs/intro/quick-start/cross-program-invocation).
