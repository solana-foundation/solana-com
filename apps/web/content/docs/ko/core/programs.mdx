---
title: 프로그램
description:
  Solana 프로그램(스마트 컨트랙트)에 대해 알아보고 Rust 또는 Anchor 프레임워크를
  사용하여 개발하는 방법을 배우세요. Solana 네트워크에서 프로그램 배포,
  업그레이드 및 검증에 대해 이해하세요.
h1: 프로그램
---

솔라나에서 스마트 컨트랙트는 프로그램이라고 불립니다. 프로그램은 실행 가능한
코드를 포함하는 상태가 없는 [계정](/docs/core/accounts#program-account)입니다.
이 코드는 명령어라고 불리는 함수로 구성되어 있습니다. 사용자는 하나 이상의
[명령어](/docs/core/instructions)가 포함된 [트랜잭션](/docs/core/transaction)을
보내 프로그램과 상호작용합니다. 트랜잭션은 여러 프로그램의 명령어를 포함할 수
있습니다.

프로그램이 배포되면, 솔라나는 [LLVM](https://llvm.org/)을 사용하여 실행 가능하고
연결 가능한 형식
([ELF](https://en.wikipedia.org/wiki/Executable_and_Linkable_Format))으로
컴파일합니다. ELF 파일은 솔라나 바이트코드 형식(sBPF)으로 된 프로그램의
바이너리를 포함하며 실행 가능한 계정에 온체인으로 저장됩니다.

<Callout>
  sBPF는 솔라나의 맞춤형 [eBPF](https://en.wikipedia.org/wiki/EBPF) 바이트코드
  버전입니다.
</Callout>

## 프로그램 작성하기

대부분의 프로그램은 [Rust](https://rust-book.cs.brown.edu/title-page.html)로
작성되며, 두 가지 일반적인 개발 접근 방식이 있습니다:

- [Anchor](https://www.anchor-lang.com/docs): Anchor는 빠르고 쉬운 솔라나 개발을
  위해 설계된 프레임워크입니다.
  [Rust 매크로](https://doc.rust-lang.org/book/ch20-05-macros.html)를 사용하여
  상용구 코드를 줄여 초보자에게 적합합니다.
- [네이티브 Rust](/docs/programs/rust): 프레임워크를 활용하지 않고 Rust로
  프로그램을 작성합니다. 이 접근 방식은 더 많은 유연성을 제공하지만 복잡성이
  증가합니다.

## 프로그램 업데이트하기

기존 프로그램을
[수정](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/bpf_loader/src/lib.rs#L704)하려면,
계정이
[업그레이드 권한](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/bpf_loader/src/lib.rs#L894)으로
지정되어야 합니다. (일반적으로 원래
[프로그램을 배포한](/docs/programs/deploying) 동일한 계정입니다.) 업그레이드
권한이 취소되고 null로 설정되면, 프로그램은 더 이상 업데이트될 수 없습니다.

## 프로그램 검증하기

솔라나는 사용자가 프로그램의 온체인 코드가 공개 소스 코드와 일치하는지 확인할 수
있는 [검증 가능한 빌드](/docs/programs/verified-builds)를 지원합니다. Anchor
프레임워크는 검증 가능한 빌드를 생성하기 위한
[내장 지원](https://www.anchor-lang.com/docs/verifiable-builds)을 제공합니다.

기존 프로그램이 검증되었는지 확인하려면,
[솔라나 익스플로러](https://explorer.solana.com/address/PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY)에서
프로그램 ID를 검색하세요. 또는 Ellipsis Labs의
[솔라나 검증 가능한 빌드 CLI](https://github.com/Ellipsis-Labs/solana-verifiable-build)를
사용하여 온체인 프로그램을 독립적으로 검증할 수 있습니다.

## 내장 프로그램

### 로더 프로그램

모든 프로그램은 다른 프로그램(로더)에 의해 소유됩니다. 로더는 프로그램을 배포,
재배포, 업그레이드 또는 종료하는 데 사용됩니다. 또한 프로그램을 완료하고
프로그램 권한을 이전하는 데도 사용됩니다.

현재 아래 표와 같이 다섯 가지 로더 프로그램이 있습니다.

| 로더   | 프로그램 ID                                   | 참고                                                                                             | 명령어 링크                                                                                                                               |
| ------ | --------------------------------------------- | ------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------- |
| native | `NativeLoader1111111111111111111111111111111` | 다른 네 개의 로더를 소유함                                                                       | —                                                                                                                                         |
| v1     | `BPFLoader1111111111111111111111111111111111` | 관리 명령어는 비활성화되었지만 프로그램은 여전히 실행됨                                          | —                                                                                                                                         |
| v2     | `BPFLoader2111111111111111111111111111111111` | 관리 명령어는 비활성화되었지만 프로그램은 여전히 실행됨                                          | [명령어](https://docs.rs/solana-loader-v2-interface/latest/solana_loader_v2_interface/enum.LoaderInstruction.html)                        |
| v3     | `BPFLoaderUpgradeab1e11111111111111111111111` | 배포 후 프로그램을 업데이트할 수 있음. 프로그램 실행 파일은 별도의 프로그램 데이터 계정에 저장됨 | [명령어](https://docs.rs/solana-loader-v3-interface/latest/solana_loader_v3_interface/instruction/enum.UpgradeableLoaderInstruction.html) |
| v4     | `LoaderV411111111111111111111111111111111111` | 개발 중(미출시)                                                                                  | [명령어](https://docs.rs/solana-loader-v4-interface/latest/solana_loader_v4_interface/instruction/enum.LoaderV4Instruction.html)          |

loader-v3 또는 loader-v4로 배포된 프로그램은 업그레이드 권한에 따라 배포 후
수정이 가능할 수 있습니다.

### 사전 컴파일된 프로그램

로더 프로그램 외에도 Solana는 다음과 같은 사전 컴파일된 프로그램을 제공합니다.

#### ed25519 서명 검증

ed25519 프로그램은 하나 이상의 ed25519 서명을 검증하는 데 사용됩니다.

| 프로그램         | 프로그램 ID                                   | 설명                                                          | 명령어                                                                                    |
| ---------------- | --------------------------------------------- | ------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| Ed25519 프로그램 | `Ed25519SigVerify111111111111111111111111111` | ed25519 서명을 검증합니다. 서명이 실패하면 오류가 반환됩니다. | [명령어](https://docs.rs/solana-ed25519-program/latest/solana_ed25519_program/index.html) |

ed25519 프로그램은 명령어를 처리합니다. 명령어의 첫 번째 `u8`에는 확인할 서명
수가 포함되어 있고, 그 뒤에 단일 바이트 패딩이 있습니다. 그 후, 확인할 각 서명에
대해 다음 구조체가 직렬화됩니다.

```rust
pub struct Ed25519SignatureOffsets {
    signature_offset: u16,             // 서명 데이터의 오프셋
    signature_instruction_index: u16,  // 서명 데이터가 포함된 명령어 인덱스
    public_key_offset: u16,            // 공개 키 데이터의 오프셋
    public_key_instruction_index: u16, // 공개 키가 포함된 명령어 인덱스
    message_data_offset: u16,          // 메시지 데이터의 오프셋
    message_data_size: u16,            // 메시지 데이터의 크기
    message_instruction_index: u16,    // 메시지 데이터가 포함된 명령어 인덱스
}
```

이를 통해 사용자는 서명 및 메시지 데이터에 대한 트랜잭션에서 모든 instruction
data를 지정할 수 있습니다. 특별한 instructions sysvar를 지정하면 트랜잭션
자체에서 데이터를 받을 수도 있습니다.

#### secp256k1 복구 검증

secp256k1 프로그램은 secp256k1 공개 키 복구 작업을 검증하는 데 사용됩니다.

| 프로그램           | 프로그램 ID                                   | 설명                                                 | 명령어                                                                                        |
| ------------------ | --------------------------------------------- | ---------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| Secp256k1 프로그램 | `KeccakSecp256k11111111111111111111111111111` | secp256k1 공개 키 복구 작업(ecrecover)을 검증합니다. | [명령어](https://docs.rs/solana-secp256k1-program/latest/solana_secp256k1_program/index.html) |

secp256k1 프로그램은 명령어를 처리합니다. 명령어의 첫 번째 바이트에는 확인할
공개 키의 수가 포함됩니다. 그 후, 다음 구조체가 각 공개 키마다 한 번씩 생성된
다음 직렬화되어 명령어 데이터에 추가됩니다.

```rust
pub struct Secp256k1SignatureOffsets {
    signature_offset: u16,             // 서명 데이터의 오프셋
    signature_instruction_index: u16,  // 서명 데이터가 포함된 명령어 인덱스
    eth_address_offset: u16,           // 이더리움 주소의 오프셋
    eth_address_instruction_index: u16, // 이더리움 주소가 포함된 명령어 인덱스
    message_data_offset: u16,          // 메시지 데이터의 오프셋
    message_data_size: u16,            // 메시지 데이터의 크기
    message_instruction_index: u16,    // 메시지 데이터가 포함된 명령어 인덱스
}
```

복구 검증의 의사 코드:

```rust
let eth_address = &instruction_data[eth_address_offset..eth_address_offset + 20];
let signature = &instruction_data[signature_offset..signature_offset + 64];
let recovery_id = instruction_data[signature_offset + 64];
let message_hash = keccak256(&instruction_data[message_data_offset..message_data_offset + message_data_size]);

let pubkey = ecrecover(message_hash, signature, recovery_id)?;
let eth_address_computed = keccak256(pubkey)[12..32];

if eth_address_computed != eth_address {
    return Error;
}
```

이를 통해 사용자는 서명 및 메시지 데이터에 대한 트랜잭션에서 모든 instruction
data를 지정할 수 있습니다. 특별한 instructions sysvar를 지정하면 트랜잭션
자체에서 데이터를 받을 수도 있습니다.

트랜잭션 비용은 검증할 서명 수에 서명 비용 검증 승수를 곱한 값으로 계산됩니다.

secp256r1 프로그램은 최대 8개의 secp256r1 서명을 검증하는 데 사용됩니다.

| 프로그램           | 프로그램 ID                                   | 설명                                                                                                       | 명령어                                                                                      |
| ------------------ | --------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| Secp256r1 프로그램 | `Secp256r1SigVerify1111111111111111111111111` | 최대 8개의 secp256r1 서명을 검증합니다. 서명, 공개 키 및 메시지를 입력받습니다. 실패 시 오류를 반환합니다. | [명령어](https://docs.rs/solana-secp256r1-program/latest/solana_secp256r1_program/all.html) |

secp256r1 프로그램은 명령어를 처리합니다. 명령어의 첫 번째 instruction data에는
확인할 서명 수가 포함되어 있으며, 그 뒤에 단일 바이트 패딩이 있습니다. 그 후,
다음 구조체가 각 서명마다 생성된 다음 직렬화되어 명령어 데이터에 추가됩니다.

```rs title="Secp256r1SignatureOffsets"
struct Secp256r1SignatureOffsets {
    signature_offset: u16,             // offset to compact secp256r1 signature of 64 bytes
    signature_instruction_index: u16,  // instruction index to find signature
    public_key_offset: u16,            // offset to compressed public key of 33 bytes
    public_key_instruction_index: u16, // instruction index to find public key
    message_data_offset: u16,          // offset to start of message data
    message_data_size: u16,            // size of message data
    message_instruction_index: u16,    // index of instruction data to get message data
}

```

<Callout>
  모든 서명에 대해 낮은 S 값이 적용되어 우발적인 서명 가변성을 방지합니다.
</Callout>

```txt title="Signature verification psuedocode"
process_instruction() {
    if data.len() < SIGNATURE_OFFSETS_START {
        return Error
    }

    num_signatures = data[0] as usize
    if num_signatures == 0 || num_signatures > 8 {
        return Error
    }

    expected_data_size = num_signatures * SIGNATURE_OFFSETS_SERIALIZED_SIZE + SIGNATURE_OFFSETS_START
    if data.len() < expected_data_size {
        return Error
    }

    for i in 0..num_signatures {
        offsets = parse_signature_offsets(data, i)

        signature = get_data_slice(data, instruction_datas, offsets.signature_instruction_index, offsets.signature_offset, SIGNATURE_SERIALIZED_SIZE)

        if s > half_curve_order {
            return Error
        }

        pubkey = get_data_slice(data, instruction_datas, offsets.public_key_instruction_index, offsets.public_key_offset, COMPRESSED_PUBKEY_SERIALIZED_SIZE)

        message = get_data_slice(data, instruction_datas, offsets.message_instruction_index, offsets.message_data_offset, offsets.message_data_size)

        if !verify_signature(signature, pubkey, message) {
            return Error
        }
    }

    return Success
}
```

### 코어 프로그램

아래 목록의 프로그램들은 네트워크의 핵심 기능을 제공합니다.

| 프로그램                 | 프로그램 ID                                   | 설명                                                                                                                                                                                                                                                                                          | 명령어                                                                                                                                                |
| ------------------------ | --------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| **System**               | `11111111111111111111111111111111`            | 새 계정 생성, 계정 데이터 할당, 계정을 소유 프로그램에 할당, System 프로그램 소유 계정에서 lamport 전송, 트랜잭션 수수료 지불                                                                                                                                                                 | [SystemInstruction](https://docs.rs/solana-program/latest/solana_program/system_instruction/enum.SystemInstruction.html)                              |
| **Vote**                 | `Vote111111111111111111111111111111111111111` | validator 투표 상태와 보상을 추적하는 계정 생성 및 관리                                                                                                                                                                                                                                       | [VoteInstruction](https://docs.rs/solana-vote-program/latest/solana_vote_program/vote_instruction/enum.VoteInstruction.html)                          |
| **Stake**                | `Stake11111111111111111111111111111111111111` | validator에 위임된 스테이크와 보상을 나타내는 계정 생성 및 관리                                                                                                                                                                                                                               | [StakeInstruction](https://docs.rs/solana-sdk/latest/solana_sdk/stake/instruction/enum.StakeInstruction.html)                                         |
| **Config**               | `Config1111111111111111111111111111111111111` | 구성 데이터를 체인에 추가하고, 이를 수정할 수 있는 공개 키 목록을 추가합니다. 다른 프로그램과 달리 Config 프로그램은 개별 명령어를 정의하지 않습니다. 단 하나의 암시적 명령어 "store"만 있습니다. 명령어 데이터는 계정 접근 권한과 그 안에 저장된 데이터에 대한 접근을 제어하는 키 세트입니다 | [ConfigInstruction](https://docs.rs/solana-config-program/latest/solana_config_program/config_instruction/index.html)                                 |
| **Compute Budget**       | `ComputeBudget111111111111111111111111111111` | 트랜잭션에 대한 컴퓨팅 유닛 한도와 가격을 설정하여 사용자가 컴퓨팅 리소스와 우선순위 수수료를 제어할 수 있게 함                                                                                                                                                                               | [ComputeBudgetInstruction](https://docs.rs/solana-compute-budget-interface/latest/solana_compute_budget_interface/enum.ComputeBudgetInstruction.html) |
| **Address Lookup Table** | `AddressLookupTab1e1111111111111111111111111` | 주소 조회 테이블을 관리하여 트랜잭션이 계정 목록에 맞는 것보다 더 많은 계정을 참조할 수 있게 함                                                                                                                                                                                               | [ProgramInstruction](https://docs.rs/solana-sdk/latest/solana_sdk/address_lookup_table/instruction/enum.ProgramInstruction.html)                      |
| **ZK ElGamal Proof**     | `ZkE1Gama1Proof11111111111111111111111111111` | ElGamal 암호화 데이터에 대한 영지식 증명 검증 제공                                                                                                                                                                                                                                            | —                                                                                                                                                     |
