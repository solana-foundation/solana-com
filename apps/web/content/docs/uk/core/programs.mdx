---
title: Програми
description:
  Дізнайтеся про програми Solana (смарт-контракти) та як розробляти їх за
  допомогою Rust або фреймворку Anchor. Зрозумійте розгортання, оновлення та
  верифікацію програм у мережі Solana.
h1: Програми
---

У Solana смарт-контракт називається програмою. Програма — це безстановий
[обліковий запис](/docs/core/accounts#program-account), який містить виконуваний
код. Цей код організований у функції, які називаються інструкціями. Користувачі
взаємодіють з програмою, надсилаючи [транзакцію](/docs/core/transaction), що
містить одну або кілька [інструкцій](/docs/core/instructions). Транзакція може
включати інструкції з кількох програм.

Коли програма розгортається, Solana використовує [LLVM](https://llvm.org/) для
її компіляції у виконуваний та компонований формат
([ELF](https://en.wikipedia.org/wiki/Executable_and_Linkable_Format)). ELF-файл
містить бінарний код програми у форматі байткоду Solana (sBPF) і зберігається в
мережі у виконуваному обліковому записі.

<Callout>
  sBPF — це власна версія Solana байткоду
  [eBPF](https://en.wikipedia.org/wiki/EBPF).
</Callout>

## Написання програм

Більшість програм написані мовою
[Rust](https://rust-book.cs.brown.edu/title-page.html), з двома поширеними
підходами до розробки:

- [Anchor](https://www.anchor-lang.com/docs): Anchor — це фреймворк, розроблений
  для швидкої та легкої розробки на Solana. Він використовує
  [макроси Rust](https://doc.rust-lang.org/book/ch20-05-macros.html) для
  зменшення шаблонного коду — що робить його чудовим для початківців.
- [Нативний Rust](/docs/programs/rust): Написання програм на Rust без
  використання будь-яких фреймворків. Цей підхід пропонує більшу гнучкість, але
  має підвищену складність.

## Оновлення програм

Щоб
[модифікувати](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/bpf_loader/src/lib.rs#L704)
наявну програму, обліковий запис повинен бути призначений як
[орган оновлення](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/bpf_loader/src/lib.rs#L894).
(Зазвичай це той самий обліковий запис, який спочатку
[розгорнув програму](/docs/programs/deploying).) Якщо орган оновлення відкликано
і встановлено як null, програму більше не можна оновлювати.

## Перевірка програм

Solana підтримує [верифіковані збірки](/docs/programs/verified-builds), які
дозволяють користувачам перевірити, чи відповідає код програми в мережі її
публічному вихідному коду. Фреймворк Anchor надає
[вбудовану підтримку](https://www.anchor-lang.com/docs/verifiable-builds) для
створення верифікованої збірки.

Щоб перевірити, чи верифікована наявна програма, знайдіть її ідентифікатор
програми на
[Solana Explorer](https://explorer.solana.com/address/PhoeNiXZ8ByJGLkxNfZRnkUfjvmuYqLR89jjFHGqdXY).
Альтернативно, ви можете використовувати
[Solana Verifiable Build CLI](https://github.com/Ellipsis-Labs/solana-verifiable-build)
від Ellipsis Labs, щоб незалежно перевірити програми в мережі.

## Вбудовані програми

### Програми завантажувачі

Кожна програма належить іншій — своєму завантажувачу. Завантажувачі
використовуються для розгортання, повторного розгортання, оновлення або закриття
програм. Вони також використовуються для фіналізації програми та передачі прав
керування програмою.

На даний момент існує п'ять програм завантажувачів, як показано в таблиці нижче.

| Завантажувач | ID програми                                   | Примітки                                                                                                   | Посилання на інструкції                                                                                                                       |
| ------------ | --------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| native       | `NativeLoader1111111111111111111111111111111` | Володіє іншими чотирма завантажувачами                                                                     | —                                                                                                                                             |
| v1           | `BPFLoader1111111111111111111111111111111111` | Інструкції керування вимкнені, але програми все ще виконуються                                             | —                                                                                                                                             |
| v2           | `BPFLoader2111111111111111111111111111111111` | Інструкції керування вимкнені, але програми все ще виконуються                                             | [Інструкції](https://docs.rs/solana-loader-v2-interface/latest/solana_loader_v2_interface/enum.LoaderInstruction.html)                        |
| v3           | `BPFLoaderUpgradeab1e11111111111111111111111` | Програми можуть бути оновлені після розгортання. Виконуваний файл програми зберігається в окремому акаунті | [Інструкції](https://docs.rs/solana-loader-v3-interface/latest/solana_loader_v3_interface/instruction/enum.UpgradeableLoaderInstruction.html) |
| v4           | `LoaderV411111111111111111111111111111111111` | У розробці (не випущено)                                                                                   | [Інструкції](https://docs.rs/solana-loader-v4-interface/latest/solana_loader_v4_interface/instruction/enum.LoaderV4Instruction.html)          |

Програми, розгорнуті за допомогою loader-v3 або loader-v4, можуть бути змінені
після розгортання, що визначається їхнім правом на оновлення.

### Попередньо скомпільовані програми

Окрім програм завантажувачів, Solana надає такі попередньо скомпільовані
програми.

#### Перевірка підпису ed25519

Програма ed25519 використовується для перевірки одного або кількох підписів
ed25519.

| Програма         | ID програми                                   | Опис                                                                                 | Інструкції                                                                                    |
| ---------------- | --------------------------------------------- | ------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------- |
| Програма Ed25519 | `Ed25519SigVerify111111111111111111111111111` | Перевіряє підписи ed25519. Якщо будь-який підпис не проходить, повертається помилка. | [Інструкції](https://docs.rs/solana-ed25519-program/latest/solana_ed25519_program/index.html) |

Програма ed25519 обробляє інструкцію. Перший `u8` інструкції містить кількість
підписів, які потрібно перевірити, за яким слідує один байт заповнення. Після
цього серіалізується наступна структура, по одній для кожного підпису, який
потрібно перевірити.

```rust
pub struct Ed25519SignatureOffsets {
    signature_offset: u16,             // offset to ed25519 signature of 64 bytes
    signature_instruction_index: u16,  // instruction index to find signature
    public_key_offset: u16,            // offset to public key of 32 bytes
    public_key_instruction_index: u16, // instruction index to find public key
    message_data_offset: u16,          // offset to start of message data
    message_data_size: u16,            // size of message data
    message_instruction_index: u16,    // index of instruction for message data
}
```

Це дозволяє користувачу вказати будь-які дані інструкції в транзакції для
підпису та даних повідомлення. Вказавши спеціальний системний регістр
інструкцій, можна також отримувати дані з самої транзакції.

#### Перевірка відновлення secp256k1

Програма secp256k1 використовується для перевірки операцій відновлення
відкритого ключа secp256k1.

| Програма           | ID програми                                   | Опис                                                                   | Інструкції                                                                                        |
| ------------------ | --------------------------------------------- | ---------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| Програма Secp256k1 | `KeccakSecp256k11111111111111111111111111111` | Перевіряє операції відновлення відкритого ключа secp256k1 (ecrecover). | [Інструкції](https://docs.rs/solana-secp256k1-program/latest/solana_secp256k1_program/index.html) |

Програма secp256k1 обробляє інструкцію. Перший байт інструкції містить кількість
відкритих ключів, які потрібно перевірити. Після цього, наступна структура
створюється один раз для кожного відкритого ключа, потім серіалізується та
додається до даних інструкції.

```rust
pub struct Secp256k1SignatureOffsets {
    signature_offset: u16,             // offset to secp256k1 signature data
    signature_instruction_index: u16,  // instruction index to find signature
    eth_address_offset: u16,           // offset to eth_address
    eth_address_instruction_index: u16, // instruction index to find eth_address
    message_data_offset: u16,          // offset to start of message data
    message_data_size: u16,            // size of message data
    message_instruction_index: u16,    // instruction index to find message data
}
```

Псевдокод перевірки відновлення:

Це дозволяє користувачу вказати будь-які дані інструкції в транзакції для
підпису та даних повідомлення. Вказавши спеціальний системний регістр
інструкцій, можна також отримувати дані з самої транзакції.

Вартість транзакції буде враховувати кількість підписів для перевірки, помножену
на множник вартості перевірки підпису.

Програма secp256r1 використовується для перевірки до 8 підписів secp256r1.

| Програма           | ID програми                                   | Опис                                                                                                                                     | Інструкції                                                                                      |
| ------------------ | --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| Програма Secp256r1 | `Secp256r1SigVerify1111111111111111111111111` | Перевіряє до 8 підписів secp256r1. Приймає підпис, відкритий ключ та повідомлення. Повертає помилку, якщо будь-який не пройде перевірку. | [Інструкції](https://docs.rs/solana-secp256r1-program/latest/solana_secp256r1_program/all.html) |

Програма secp256r1 обробляє інструкцію. Перший `u8` інструкції містить кількість
підписів, які потрібно перевірити, за яким слідує один байт заповнення. Після
цього, наступна структура створюється для кожного підпису, потім серіалізується
та додається до даних інструкції.

```rust
fn verify_signature(
    message: &[u8],
    signature: &[u8],
    public_key: &[u8],
) -> Result<(), SignatureError> {
    // Перевірка, що підпис має правильну довжину
    if signature.len() != 64 {
        return Err(SignatureError::InvalidSignatureLen);
    }

    // Перевірка, що публічний ключ має правильну довжину
    if public_key.len() != 32 {
        return Err(SignatureError::InvalidPublicKeyLen);
    }

    // Розбиття підпису на компоненти r і s
    let r = &signature[..32];
    let s = &signature[32..];

    // Перевірка, що s має низьке значення
    if !is_s_low(s) {
        return Err(SignatureError::InvalidS);
    }

    // Перевірка підпису за допомогою ed25519
    ed25519_verify(message, public_key, r, s)
}
```

<Callout>
  Низькі значення S застосовуються для всіх підписів, щоб уникнути випадкової
  пластичності підпису.
</Callout>

```rust
fn is_s_low(s: &[u8]) -> bool {
    // Перевірка, що s < L/2, де L - порядок базової точки ed25519
    // L = 2^252 + 27742317777372353535851937790883648493
    // L/2 = 2^251 + 13871158888686176767925968895441824246
    //
    // Представлення L/2 у вигляді масиву байтів (little-endian):
    // [0xf8, 0xa5, 0x85, 0x20, 0xa0, 0x0e, 0x4b, 0x1d,
    //  0xfe, 0xec, 0x8e, 0x26, 0x89, 0xc5, 0x1d, 0x4b,
    //  0x70, 0x15, 0x55, 0x7c, 0x97, 0xb4, 0x29, 0x28,
    //  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10]
    //
    // Примітка: Це спрощена реалізація. Повна реалізація повинна
    // порівнювати s з L/2 як великі цілі числа.
    s[31] < 0x10 || (s[31] == 0x10 && s[30] == 0 && s[29] == 0 && s[28] == 0 && s[27] == 0 && s[26] == 0 && s[25] == 0 && s[24] == 0)
}
```

### Основні програми

Програми у списку нижче забезпечують основну функціональність мережі.

| Програма                 | ID програми                                   | Опис                                                                                                                                                                                                                                                                                                                                                               | Інструкції                                                                                                                                            |
| ------------------------ | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| **System**               | `11111111111111111111111111111111`            | Створення нових облікових записів, виділення даних облікового запису, призначення облікових записів програмам-власникам, переказ лампортів з облікових записів, що належать системній програмі, та оплата комісій за транзакції                                                                                                                                    | [SystemInstruction](https://docs.rs/solana-program/latest/solana_program/system_instruction/enum.SystemInstruction.html)                              |
| **Vote**                 | `Vote111111111111111111111111111111111111111` | Створення та управління обліковими записами, які відстежують стан голосування validator та винагороди                                                                                                                                                                                                                                                              | [VoteInstruction](https://docs.rs/solana-vote-program/latest/solana_vote_program/vote_instruction/enum.VoteInstruction.html)                          |
| **Stake**                | `Stake11111111111111111111111111111111111111` | Створення та управління обліковими записами, що представляють стейк та винагороди за делегування validator                                                                                                                                                                                                                                                         | [StakeInstruction](https://docs.rs/solana-sdk/latest/solana_sdk/stake/instruction/enum.StakeInstruction.html)                                         |
| **Config**               | `Config1111111111111111111111111111111111111` | Додавання конфігураційних даних до ланцюга, за якими слідує список публічних ключів, яким дозволено їх змінювати. На відміну від інших програм, програма Config не визначає окремих інструкцій. Вона має лише одну неявну інструкцію: "store". Її дані інструкції — це набір ключів, які контролюють доступ до облікового запису та даних, що зберігаються в ньому | [ConfigInstruction](https://docs.rs/solana-config-program/latest/solana_config_program/config_instruction/index.html)                                 |
| **Compute Budget**       | `ComputeBudget111111111111111111111111111111` | Встановлення лімітів обчислювальних одиниць та цін для транзакцій, що дозволяє користувачам контролювати обчислювальні ресурси та комісії за пріоритет                                                                                                                                                                                                             | [ComputeBudgetInstruction](https://docs.rs/solana-compute-budget-interface/latest/solana_compute_budget_interface/enum.ComputeBudgetInstruction.html) |
| **Address Lookup Table** | `AddressLookupTab1e1111111111111111111111111` | Управління таблицями пошуку адрес, які дозволяють транзакціям посилатися на більше облікових записів, ніж могло б поміститися у списку облікових записів транзакції                                                                                                                                                                                                | [ProgramInstruction](https://docs.rs/solana-sdk/latest/solana_sdk/address_lookup_table/instruction/enum.ProgramInstruction.html)                      |
| **ZK ElGamal Proof**     | `ZkToken11111111111111111111111111111111111`  | Забезпечує верифікацію доказів з нульовим розголошенням для даних, зашифрованих за допомогою ElGamal                                                                                                                                                                                                                                                               | —                                                                                                                                                     |
