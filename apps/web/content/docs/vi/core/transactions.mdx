---
title: Giao dịch
description:
  Tìm hiểu về giao dịch Solana—các khối xây dựng cơ bản để tương tác với
  blockchain Solana. Hiểu cấu trúc giao dịch và cách tạo chỉ thị với các ví dụ
  thực tế.
---

Để tương tác với mạng Solana, bạn phải gửi một giao dịch. Bạn có thể coi giao
dịch như một phong bì chứa nhiều biểu mẫu. Mỗi biểu mẫu là một chỉ thị báo cho
mạng biết phải làm gì. Việc gửi giao dịch giống như gửi phong bì qua đường bưu
điện để các biểu mẫu có thể được xử lý.

Ví dụ dưới đây cho thấy phiên bản đơn giản hóa của hai giao dịch. Khi giao dịch
đầu tiên được xử lý, nó sẽ thực thi một chỉ thị duy nhất. Khi giao dịch thứ hai
được xử lý, nó sẽ thực thi ba chỉ thị **theo thứ tự tuần tự**: đầu tiên là chỉ
thị 1, tiếp theo là chỉ thị 2, và cuối cùng là chỉ thị 3.

<Callout type="warn">
  Giao dịch là **nguyên tử**: Nếu một chỉ thị đơn lẻ thất bại, toàn bộ giao dịch
  sẽ thất bại và không có thay đổi nào xảy ra.
</Callout>

![Sơ đồ đơn giản hóa hiển thị hai giao dịch](/assets/docs/core/transactions/transaction-simple.svg)

Một
[`Transaction`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/src/transaction/mod.rs#L207)
bao gồm các thông tin sau:

<WithMentions>

- [`signatures`](mention:signatures): Một mảng [chữ ký](#signatures)
- [`message`](mention:message): Thông tin giao dịch, bao gồm danh sách các chỉ
  thị sẽ được xử lý

```rust title="Transaction"
pub struct Transaction {
    #[wasm_bindgen(skip)]
    #[serde(with = "short_vec")]
    // !mention signatures
    pub signatures: Vec<Signature>,

    #[wasm_bindgen(skip)]
    // !mention message
    pub message: Message,
}
```

</WithMentions>

![Sơ đồ hiển thị hai phần của một giao dịch](/assets/docs/core/transactions/tx_format.png)

Giao dịch có giới hạn kích thước tổng cộng là
[1232](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/packet/src/lib.rs#L29)
byte. Giới hạn này bao gồm cả mảng [`signatures`](#signatures) và cấu trúc
[`message`](#message).

<Callout>
  Giới hạn này xuất phát từ kích thước Maximum Transmission Unit (MTU) của IPv6
  là 1280 byte, trừ đi 48 byte cho các header mạng (40 byte IPv6 + 8 byte
  header).
</Callout>

![Sơ đồ hiển thị định dạng giao dịch và giới hạn kích thước](/assets/docs/core/transactions/issues_with_legacy_txs.png)

## Chữ ký

Mảng `signatures` của giao dịch chứa các cấu trúc `Signature`. Mỗi
[`Signature`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/signature/src/lib.rs#L30)
có kích thước 64 byte và được tạo ra bằng cách ký `Message` của giao dịch với
khóa riêng tư của tài khoản. Một chữ ký phải được cung cấp cho mỗi
[tài khoản người ký](#account-addresses) được bao gồm trong bất kỳ chỉ thị nào
của giao dịch.

Chữ ký đầu tiên thuộc về tài khoản sẽ thanh toán
[phí cơ bản](docs/core/fees#base-fee) của giao dịch và là chữ ký giao dịch. Chữ
ký giao dịch có thể được sử dụng để tra cứu chi tiết giao dịch trên mạng.

## Thông điệp

`message` của giao dịch là một cấu trúc
[`Message`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L131)
chứa các thông tin sau:

<WithMentions>

- [`header`](mention:message-header): [Tiêu đề](#header) của thông điệp
- [`account_keys`](mention:account-addresses): Một mảng
  [địa chỉ tài khoản](#account-addresses) được yêu cầu bởi các chỉ thị của giao
  dịch
- [`recent_blockhash`](mention:recent-blockhash): Một
  [blockhash](#recent-blockhash) đóng vai trò như dấu thời gian cho giao dịch
- [`instructions`](mention:instructions): Một mảng [chỉ thị](#instructions)

<Callout>
  Để tiết kiệm không gian, giao dịch không lưu trữ quyền cho từng tài khoản
  riêng lẻ. Thay vào đó, quyền của tài khoản được xác định bằng cách sử dụng
  `header` và `account_keys`.
</Callout>

```rust title="Message"
pub struct Message {
    /// The message header, identifying signed and read-only `account_keys`.
    // !mention message-header
    pub header: MessageHeader,

    /// All the account keys used by this transaction.
    #[serde(with = "short_vec")]
    // !mention account-addresses
    pub account_keys: Vec<Pubkey>,

    /// The id of a recent ledger entry.
    // !mention recent-blockhash
    pub recent_blockhash: Hash,

    /// Programs that will be executed in sequence and committed in
    /// one atomic transaction if all succeed.
    #[serde(with = "short_vec")]
    // !mention instructions
    pub instructions: Vec<CompiledInstruction>,
}
```

</WithMentions>

### Tiêu đề

<WithMentions>

`header` của thông điệp là một cấu trúc
[`MessageHeader`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/mod.rs#L97).
Nó chứa các thông tin sau:

- [`num_required_signatures`](mention:num_required_signatures): Tổng số chữ ký
  được yêu cầu bởi giao dịch
- [`num_readonly_signed_accounts`](mention:num_readonly_signed_accounts): Tổng
  số tài khoản chỉ đọc yêu cầu chữ ký
- [`num_readonly_unsigned_accounts`](mention:num_readonly_unsigned_accounts):
  Tổng số tài khoản chỉ đọc không yêu cầu chữ ký

```rust title="MessageHeader"
pub struct MessageHeader {
    /// The number of signatures required for this message to be considered
    /// valid. The signers of those signatures must match the first
    /// `num_required_signatures` of [`Message::account_keys`].
    // !mention num_required_signatures
    pub num_required_signatures: u8,

    /// The last `num_readonly_signed_accounts` of the signed keys are read-only
    /// accounts.
    // !mention num_readonly_signed_accounts
    pub num_readonly_signed_accounts: u8,

    /// The last `num_readonly_unsigned_accounts` of the unsigned keys are
    /// read-only accounts.
    // !mention num_readonly_unsigned_accounts
    pub num_readonly_unsigned_accounts: u8,
}
```

</WithMentions>

![Sơ đồ hiển thị ba phần của tiêu đề thông điệp](/assets/docs/core/transactions/message_header.png)

### Địa chỉ tài khoản

[`account_keys`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L138)
của thông điệp là một mảng các địa chỉ tài khoản, được gửi ở
[định dạng mảng nhỏ gọn](/docs/references/terminology#compact-array-format).
Tiền tố của mảng chỉ ra độ dài của nó. Mỗi mục trong mảng là một khóa công khai,
trỏ đến một tài khoản được sử dụng bởi các chỉ thị của nó. Mảng `accounts_keys`
phải hoàn chỉnh và được sắp xếp nghiêm ngặt như sau:

1. Người ký + Có thể ghi
2. Người ký + Chỉ đọc
3. Không phải người ký + Có thể ghi
4. Không phải người ký + Chỉ đọc

<Callout>
  Việc sắp xếp nghiêm ngặt cho phép mảng `account_keys` được kết hợp với thông
  tin trong [`header`](#header) của thông điệp để xác định quyền cho mỗi tài
  khoản.
</Callout>

![Sơ đồ hiển thị thứ tự của mảng địa chỉ tài khoản](/assets/docs/core/transactions/compat_array_of_account_addresses.png)

### Blockhash gần đây

`recent_blockhash` của message là một giá trị băm hoạt động như dấu thời gian
của giao dịch và ngăn chặn các giao dịch trùng lặp. Một blockhash hết hạn sau
[150 khối](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/clock/src/lib.rs#L134).
(Tương đương với một phút—giả định mỗi khối là 400ms.) Sau khi khối hết hạn,
giao dịch cũng hết hạn và không thể được xử lý.

<Callout>
  Phương thức RPC [`getLatestBlockhash`](/docs/rpc/http/getlatestblockhash) cho
  phép bạn lấy blockhash hiện tại và chiều cao khối cuối cùng mà tại đó
  blockhash sẽ còn hiệu lực.
</Callout>

### Các chỉ thị

[`instructions`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/message/legacy.rs#L146)
của message là một mảng tất cả các chỉ thị cần được xử lý, được gửi ở
[định dạng mảng nhỏ gọn](/docs/references/terminology#compact-array-format).
Tiền tố của mảng chỉ ra độ dài của nó. Mỗi mục trong mảng là một cấu trúc
[`CompiledInstruction`](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/instruction.rs#L22)
và bao gồm các thông tin sau:

<WithMentions>

1. [`program_id_index`](mention:program-id-index): Một chỉ mục trỏ đến một địa
   chỉ trong mảng [`account_keys`](#account-addresses). Giá trị này chỉ ra địa
   chỉ của chương trình xử lý chỉ thị.
2. [`accounts`](mention:account-indexes): Một mảng các chỉ mục trỏ đến các địa
   chỉ trong mảng `account_keys`. Mỗi chỉ mục trỏ đến địa chỉ của một tài khoản
   cần thiết cho chỉ thị này.
3. [`data`](mention:instruction-data): Một mảng byte chỉ định chỉ thị nào cần
   gọi trên chương trình. Nó cũng bao gồm bất kỳ dữ liệu bổ sung nào cần thiết
   cho chỉ thị. (Ví dụ, các đối số hàm)

```rust title="CompiledInstruction"
pub struct CompiledInstruction {
    /// Index into the transaction keys array indicating the program account that executes this instruction.
    // !mention program-id-index
    pub program_id_index: u8,
    /// Ordered indices into the transaction keys array indicating which accounts to pass to the program.
    #[serde(with = "short_vec")]
    // !mention account-indexes
    pub accounts: Vec<u8>,
    /// The program input data.
    #[serde(with = "short_vec")]
    // !mention instruction-data
    pub data: Vec<u8>,
}
```

</WithMentions>

![Mảng nhỏ gọn của các Chỉ thị](/assets/docs/core/transactions/compact_array_of_ixs.png)

## Cấu trúc giao dịch mẫu

Ví dụ sau đây cho thấy cấu trúc của một giao dịch chứa một chỉ thị chuyển SOL
duy nhất.

<CodeTabs storage="sol-transfer" flags="r">

```ts !! title="Kit"
import {
  createSolanaRpc,
  generateKeyPairSigner,
  lamports,
  createTransactionMessage,
  setTransactionMessageFeePayerSigner,
  setTransactionMessageLifetimeUsingBlockhash,
  appendTransactionMessageInstructions,
  pipe,
  signTransactionMessageWithSigners,
  getCompiledTransactionMessageDecoder
} from "@solana/kit";
import { getTransferSolInstruction } from "@solana-program/system";

const rpc = createSolanaRpc("http://localhost:8899");
const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();

// Generate sender and recipient keypairs
const sender = await generateKeyPairSigner();
const recipient = await generateKeyPairSigner();

// Define the amount to transfer
const LAMPORTS_PER_SOL = 1_000_000_000n;
const transferAmount = lamports(LAMPORTS_PER_SOL / 100n); // 0.01 SOL

// Create a transfer instruction for transferring SOL from sender to recipient
const transferInstruction = getTransferSolInstruction({
  source: sender,
  destination: recipient.address,
  amount: transferAmount
});

// Create transaction message
const transactionMessage = pipe(
  createTransactionMessage({ version: 0 }),
  (tx) => setTransactionMessageFeePayerSigner(sender, tx),
  (tx) => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, tx),
  (tx) => appendTransactionMessageInstructions([transferInstruction], tx)
);

const signedTransaction =
  await signTransactionMessageWithSigners(transactionMessage);

// Decode the messageBytes
const compiledTransactionMessage =
  getCompiledTransactionMessageDecoder().decode(signedTransaction.messageBytes);

console.log(JSON.stringify(compiledTransactionMessage, null, 2));
```

```ts !! title="Legacy"
import {
  LAMPORTS_PER_SOL,
  SystemProgram,
  Transaction,
  Keypair,
  Connection
} from "@solana/web3.js";

const connection = new Connection("http://localhost:8899", "confirmed");
const { blockhash, lastValidBlockHeight } =
  await connection.getLatestBlockhash();

// Generate sender and recipient keypairs
const sender = Keypair.generate();
const recipient = new Keypair();

// Define the amount to transfer
const transferAmount = 0.01; // 0.01 SOL

// Create a transfer instruction for transferring SOL from sender to recipient
const transferInstruction = SystemProgram.transfer({
  fromPubkey: sender.publicKey,
  toPubkey: recipient.publicKey,
  lamports: transferAmount * LAMPORTS_PER_SOL // Convert transferAmount to lamports
});

const transaction = new Transaction({
  blockhash,
  lastValidBlockHeight,
  feePayer: sender.publicKey
}).add(transferInstruction);
transaction.sign(sender);

const compiledMessage = transaction.compileMessage();
console.log(JSON.stringify(compiledMessage, null, 2));
```

```rs !! title="Rust"
use anyhow::Result;
use solana_client::nonblocking::rpc_client::RpcClient;
use solana_commitment_config::CommitmentConfig;
use solana_sdk::{
    native_token::LAMPORTS_PER_SOL, signature::Signer, signer::keypair::Keypair,
    transaction::Transaction,
};
use solana_system_interface::instruction::transfer;

#[tokio::main]
async fn main() -> Result<()> {
    let connection = RpcClient::new_with_commitment(
        "http://localhost:8899".to_string(),
        CommitmentConfig::confirmed(),
    );

    // Fetch the latest blockhash and last valid block height
    let blockhash = connection.get_latest_blockhash().await?;

    // Generate sender and recipient keypairs
    let sender = Keypair::new();
    let recipient = Keypair::new();

    // Create a transfer instruction for transferring SOL from sender to recipient
    let transfer_instruction = transfer(
        &sender.pubkey(),
        &recipient.pubkey(),
        LAMPORTS_PER_SOL / 100, // 0.01 SOL
    );

    let mut transaction =
        Transaction::new_with_payer(&[transfer_instruction], Some(&sender.pubkey()));
    transaction.sign(&[&sender], blockhash);

    println!("{:#?}", transaction);

    Ok(())
}
```

</CodeTabs>

<WithMentions>
Đoạn mã dưới đây hiển thị đầu ra từ các đoạn mã trước đó.
Định dạng khác nhau giữa các SDK,
nhưng lưu ý rằng mỗi chỉ thị đều chứa cùng thông tin cần thiết.

<CodeTabs storage="sol-transfer">

```json !! title="Kit"
{
  "version": 0,
  // !mention header
  "header": {
    "numSignerAccounts": 1,
    "numReadonlySignerAccounts": 0,
    "numReadonlyNonSignerAccounts": 1
  },
  // !mention account_keys
  "staticAccounts": [
    "HoCy8p5xxDDYTYWEbQZasEjVNM5rxvidx8AfyqA4ywBa",
    "5T388jBjovy7d8mQ3emHxMDTbUF8b7nWvAnSiP3EAdFL",
    "11111111111111111111111111111111"
  ],
  // !mention recent_blockhash
  "lifetimeToken": "EGCWPUEXhqHJWYBfDirq3mHZb4qDpATmYqBZMBy9TBC1",
  // !mention instructions
  "instructions": [
    {
      "programAddressIndex": 2,
      "accountIndices": [0, 1],
      "data": {
        "0": 2,
        "1": 0,
        "2": 0,
        "3": 0,
        "4": 128,
        "5": 150,
        "6": 152,
        "7": 0,
        "8": 0,
        "9": 0,
        "10": 0,
        "11": 0
      }
    }
  ]
}
```

```json !! title="Legacy"
{
  // !mention header
  "header": {
    "numRequiredSignatures": 1,
    "numReadonlySignedAccounts": 0,
    "numReadonlyUnsignedAccounts": 1
  },
  // !mention account_keys
  "accountKeys": [
    "EPLUagqZZAuAtJ5LSbK7eeXjqeTdesd4q8WhoqVrfG3g",
    "9Txf5pi5jzm7FydFAsQafk7xn5wY9yN2UNm5LW15qvcK",
    "11111111111111111111111111111111"
  ],
  "recentBlockhash": "2qYPgehzMKXcMt4Ku1tKAk9DACKUbtYEY9EUEN42cseT",
  // !mention instructions
  "instructions": [
    {
      "programIdIndex": 2,
      "accounts": [0, 1],
      "data": "3Bxs4NN8M2Yn4TLb"
    }
  ],
  "indexToProgramIds": {}
}
```

```json !! title="Rust"
{
  "signatures": [
    "2fPXZtQGWWj6suxfc55FBQiexS8hEhNELqasSL5DRYa1RB1GChHz86Cyy8ukiVwA6qbq91P4cY1FuvTuYtmTHmJP"
  ],
  "message": {
    // !mention header
    "header": {
      "num_required_signatures": 1,
      "num_readonly_signed_accounts": 0,
      "num_readonly_unsigned_accounts": 1
    },
    "account_keys": [
      "9CpbtdXfUTgLMJL8DEAeEm8thERJPwDuruohjvUuzY7m",
      "6jELNgS8Q35sF4QZCvwgyKGaKrbcm8P5QcNWUyAb5ekJ",
      "11111111111111111111111111111111"
    ],
    "recent_blockhash": "3P7CVQ9nwXx4B37MvBzghzbcM9K9p5xo7ivDE8W78dCi",
    // !mention instructions
    "instructions": [
      {
        "program_id_index": 2,
        "accounts": [0, 1],
        "data": [2, 0, 0, 0, 128, 150, 152, 0, 0, 0, 0, 0]
      }
    ]
  }
}
```

</CodeTabs>
</WithMentions>

Sau khi một giao dịch được gửi đi, bạn có thể truy xuất chi tiết của nó bằng
cách sử dụng chữ ký giao dịch và phương thức RPC
[getTransaction](/docs/rpc/http/gettransaction). Phản hồi sẽ có cấu trúc tương
tự như đoạn mã dưới đây.

<Callout>
  Bạn cũng có thể tìm giao dịch bằng cách sử dụng [Solana
  Explorer](https://explorer.solana.com).
</Callout>

```json title="Transaction Data"
{
  "blockTime": 1745196488,
  "meta": {
    "computeUnitsConsumed": 150,
    "err": null,
    "fee": 5000,
    "innerInstructions": [],
    "loadedAddresses": {
      "readonly": [],
      "writable": []
    },
    "logMessages": [
      "Program 11111111111111111111111111111111 invoke [1]",
      "Program 11111111111111111111111111111111 success"
    ],
    "postBalances": [989995000, 10000000, 1],
    "postTokenBalances": [],
    "preBalances": [1000000000, 0, 1],
    "preTokenBalances": [],
    "rewards": [],
    "status": {
      "Ok": null
    }
  },
  "slot": 13049,
  "transaction": {
    "message": {
      "header": {
        "numReadonlySignedAccounts": 0,
        "numReadonlyUnsignedAccounts": 1,
        "numRequiredSignatures": 1
      },
      "accountKeys": [
        "8PLdpLxkuv9Nt8w3XcGXvNa663LXDjSrSNon4EK7QSjQ",
        "7GLg7bqgLBv1HVWXKgWAm6YoPf1LoWnyWGABbgk487Ma",
        "11111111111111111111111111111111"
      ],
      "recentBlockhash": "7ZCxc2SDhzV2bYgEQqdxTpweYJkpwshVSDtXuY7uPtjf",
      "instructions": [
        {
          "accounts": [0, 1],
          "data": "3Bxs4NN8M2Yn4TLb",
          "programIdIndex": 2,
          "stackHeight": null
        }
      ],
      "indexToProgramIds": {}
    },
    "signatures": [
      "3jUKrQp1UGq5ih6FTDUUt2kkqUfoG2o4kY5T1DoVHK2tXXDLdxJSXzuJGY4JPoRivgbi45U2bc7LZfMa6C4R3szX"
    ]
  },
  "version": "legacy"
}
```
