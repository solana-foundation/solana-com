---
title: Sponsor Transaction Fee
description: Learn how to sponsor transaction fees for payments on Solana.
---

## Demo

<CodeTabs flags="r">

```ts !! title="Kit"
import {
  airdropFactory,
  appendTransactionMessageInstructions,
  createSolanaRpc,
  createSolanaRpcSubscriptions,
  createTransactionMessage,
  generateKeyPairSigner,
  getSignatureFromTransaction,
  lamports,
  pipe,
  sendAndConfirmTransactionFactory,
  setTransactionMessageFeePayerSigner,
  setTransactionMessageLifetimeUsingBlockhash,
  signTransactionMessageWithSigners,
  KeyPairSigner
} from "@solana/kit";
import { getCreateAccountInstruction } from "@solana-program/system";
import {
  getCreateAssociatedTokenInstructionAsync,
  getInitializeMintInstruction,
  getMintSize,
  TOKEN_PROGRAM_ADDRESS,
  findAssociatedTokenPda,
  getMintToInstruction,
  getTransferInstruction
} from "@solana-program/token";

// Generate keypairs for sender, recipient, and fee payer
const sender = await generateKeyPairSigner();
const recipient = await generateKeyPairSigner();
// !mark
const feePayer = await generateKeyPairSigner();

console.log("Sender Address:", sender.address.toString());
console.log("Recipient Address:", recipient.address.toString());
console.log("Fee Payer Address:", feePayer.address.toString());

// Demo Setup: Create RPC connection, mint account, token accounts, and fund with initial tokens
const { rpc, rpcSubscriptions, mint } = await demoSetup(
  sender,
  recipient,
  feePayer
);

console.log("\nMint Address:", mint.address.toString());

// Derive the Associated Token Accounts (ATAs) for sender and recipient
const [senderAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: sender.address,
  tokenProgram: TOKEN_PROGRAM_ADDRESS
});

const [recipientAta] = await findAssociatedTokenPda({
  mint: mint.address,
  owner: recipient.address,
  tokenProgram: TOKEN_PROGRAM_ADDRESS
});

console.log("Sender Token Account:", senderAta.toString());
console.log("Recipient Token Account:", recipientAta.toString());

// =============================================================================
// Sponsor Transaction Fee Demo
// =============================================================================

// Get a fresh blockhash for the transaction
const { value: transferBlockhash } = await rpc.getLatestBlockhash().send();

// Create instruction to transfer tokens from sender to recipient
// Transferring 25 base units = 0.25 tokens (adjusted amount for mint account decimals)
const transferInstruction = getTransferInstruction({
  source: senderAta,
  destination: recipientAta,
  authority: sender,
  amount: 25n // 0.25 tokens
});

// Create transaction message for token transfer
const transactionMessage = pipe(
  createTransactionMessage({ version: 0 }),
  // !mark
  (tx) => setTransactionMessageFeePayerSigner(feePayer, tx),
  (tx) => setTransactionMessageLifetimeUsingBlockhash(transferBlockhash, tx),
  (tx) => appendTransactionMessageInstructions([transferInstruction], tx)
);

// Sign the transaction with the sender's keypair
const signedTransaction =
  await signTransactionMessageWithSigners(transactionMessage);

// Send and confirm the transaction
await sendAndConfirmTransactionFactory({ rpc, rpcSubscriptions })(
  signedTransaction,
  { commitment: "confirmed" }
);

// Get the transaction signature
const transactionSignature = getSignatureFromTransaction(signedTransaction);

console.log("\n=== Sponsor Transaction Complete ===");
console.log("Transaction Signature:", transactionSignature);

// Fetch final token account balances
const senderBalance = await rpc.getTokenAccountBalance(senderAta).send();
const recipientBalance = await rpc.getTokenAccountBalance(recipientAta).send();

console.log("\nSender Token Account Balance:", senderBalance.value);
console.log("Recipient Token Account Balance:", recipientBalance.value);

// Fetch transaction logs
const transactionLogs = await rpc.getTransaction(transactionSignature).send();

console.log(
  "\nTransaction Account Addresses:",
  JSON.stringify(transactionLogs!.transaction.message.accountKeys, null, 2)
);
console.log(
  "Note that the first address listed in the accountsKeys array of the transaction is always the fee payer"
);

// =============================================================================
// Demo Setup Helper Function
// =============================================================================
/**
 * Sets up for a token transfer demo:
 * - Creates RPC connections
 * - Airdrops SOL to sender for transaction fees
 * - Generates mint keypair and creates/initializes mint account
 * - Creates associated token accounts for sender and recipient
 * - Mints initial tokens to sender
 *
 * @param sender - The sender's keypair
 * @param recipient - The recipient's keypair
 * @param feePayer - The fee payer's keypair
 * @returns Return RPC connection and mint address
 */
// !collapse(1:1000) collapsed
async function demoSetup(
  sender: KeyPairSigner,
  recipient: KeyPairSigner,
  feePayer: KeyPairSigner
) {
  // Create Connection to local validator
  const rpc = createSolanaRpc("http://localhost:8899");
  const rpcSubscriptions = createSolanaRpcSubscriptions("ws://localhost:8900");

  // Fund sender with SOL for transaction fees
  await airdropFactory({ rpc, rpcSubscriptions })({
    recipientAddress: feePayer.address,
    lamports: lamports(1_000_000_000n),
    commitment: "confirmed"
  });

  // Generate keypair to use as address of mint
  const mint = await generateKeyPairSigner();

  // Get default mint account size (in bytes), no extensions enabled
  const space = BigInt(getMintSize());

  // Get minimum balance for rent exemption
  const rent = await rpc.getMinimumBalanceForRentExemption(space).send();

  // Get latest blockhash to include in transaction
  const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();

  // Instruction to create new account for mint (token program)
  // Invokes the system program
  const createAccountInstruction = getCreateAccountInstruction({
    payer: feePayer,
    newAccount: mint,
    lamports: rent,
    space,
    programAddress: TOKEN_PROGRAM_ADDRESS
  });

  // Instruction to initialize mint account data
  // Invokes the token program
  const initializeMintInstruction = getInitializeMintInstruction({
    mint: mint.address,
    decimals: 2,
    mintAuthority: sender.address
  });

  // Derive sender's associated token account address (ATA)
  const [senderAta] = await findAssociatedTokenPda({
    mint: mint.address,
    owner: sender.address,
    tokenProgram: TOKEN_PROGRAM_ADDRESS
  });

  // Create instruction for sender's ATA
  const createSenderAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: feePayer,
      mint: mint.address,
      owner: sender.address
    });

  // Create instruction for recipient's ATA
  const createRecipientAtaInstruction =
    await getCreateAssociatedTokenInstructionAsync({
      payer: feePayer,
      mint: mint.address,
      owner: recipient.address
    });

  // Create instruction to mint initial tokens to sender
  const mintToInstruction = getMintToInstruction({
    mint: mint.address,
    token: senderAta,
    mintAuthority: sender,
    amount: 100n // Mint 1.00 tokens (100 base units with 2 decimals)
  });

  // Combine all instructions in order
  const instructions = [
    createAccountInstruction, // Create mint account
    initializeMintInstruction, // Initialize mint
    createSenderAtaInstruction, // Create sender's ATA
    createRecipientAtaInstruction, // Create recipient's ATA
    mintToInstruction // Mint tokens to sender
  ];

  // Create transaction message
  const transactionMessage = pipe(
    createTransactionMessage({ version: 0 }),
    (tx) => setTransactionMessageFeePayerSigner(feePayer, tx),
    (tx) => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, tx),
    (tx) => appendTransactionMessageInstructions(instructions, tx)
  );

  // Sign transaction message with all required signers
  const signedTransaction =
    await signTransactionMessageWithSigners(transactionMessage);

  // Send and confirm transaction
  await sendAndConfirmTransactionFactory({ rpc, rpcSubscriptions })(
    signedTransaction,
    { commitment: "confirmed" }
  );

  return {
    rpc,
    rpcSubscriptions,
    mint
  };
}
```

</CodeTabs>
