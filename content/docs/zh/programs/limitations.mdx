---
title: "限制"
---

在Solana区块链上开发程序存在一些固有的限制。以下是您可能会遇到的常见限制列表。

## Rust库

由于基于Rust的链上程序必须在资源受限的单线程环境中确定性地运行，因此它们在各种库的使用上有一些限制。

链上Rust程序支持大部分Rust的libstd、libcore和liballoc，以及许多第三方crate。

由于这些程序在资源受限的单线程环境中运行，并且需要保持确定性，因此存在一些限制：

* 无法访问
  * `rand`
  * `std::fs`
  * `std::net`
  * `std::future`
  * `std::process`
  * `std::sync`
  * `std::task`
  * `std::thread`
  * `std::time`
* 有限访问：
  * `std::hash`
  * `std::os`
* Bincode在计算周期和调用深度方面都非常消耗资源，应当避免使用
* 应避免使用字符串格式化，因为它也会消耗大量计算资源。
* 不支持`println!`，`print!`，请使用
  [`msg!`](https://github.com/solana-labs/solana/blob/d9b0fc0e3eec67dfe4a97d9298b15969b2804fab/sdk/program/src/log.rs#L33)
  宏代替。
* 运行时对程序在处理一条指令期间可以执行的指令数量施加了限制。详见
  [计算预算](/docs/core/fees#compute-budget)获取更多信息。

## 计算预算

为了防止滥用区块链的计算资源，每个交易都被分配了一个[计算预算](/docs/references/terminology#compute-budget)。超出此计算预算将导致交易失败。

查看[计算约束](/docs/core/fees#compute-budget) 文档获取更具体的详情。

## 调用栈深度 - `CallDepthExceeded`错误

Solana程序被限制为快速运行，为了促进这一点，程序的调用栈深度被限制为最大**64帧**。

当程序超过允许的调用栈深度限制时，它将收到 `CallDepthExceeded`错误。

## CPI调用深度 - `CallDepth`错误

跨程序调用允许程序直接调用其他程序，但当前深度受到限制为`4`。

当程序超过允许的 [跨程序调用深度](/docs/core/cpi)时，它将收到 `CallDepth`错误

## Float Rust类型支持

程序支持Rust浮点操作的有限子集。如果程序尝试使用不受支持的浮点操作，运行时将报告未解析的符号错误。

浮点操作通过软件库执行，特别是LLVM的浮点内置函数。由于是软件模拟，它们比整数操作消耗更多的计算单元。一般来说，建议尽可能使用定点操作。

在
[Solana程序库数学](https://github.com/solana-labs/solana-program-library/tree/master/libraries/math)
测试中会报告一些数学操作的性能。要运行测试，同步仓库并运行：

```shell
cargo test-sbf -- --nocapture --test-threads=1
```

最近的结果显示，与整数等效操作相比，浮点操作需要更多指令。定点实现可能各不相同，但也会少于浮点等效操作：

```text
          u64   f32
乘法       8   176
除法       9   219
```

## 静态可写数据

程序共享对象不支持可写共享数据。程序在多个并行执行之间共享，使用相同的共享只读代码和数据。这意味着开发者不应在程序中包含任何静态可写或全局变量。未来可能会添加写时复制机制以支持可写数据。

## 有符号除法

SBF指令集不支持有符号除法。
