---
title: Solana账户模型
description: 了解Solana的账户模型，包括账户如何存储数据和程序、rent机制、账户所有权以及程序与数据账户之间的关系。理解Solana键值存储系统的核心概念。
---

在Solana上，所有数据都包含在我们称为"accounts"（账户）的结构中。你可以将Solana上的数据视为一个公共数据库，其中有一个单一的"Accounts"表，该表中的每个条目都是具有相同基本[Account类型](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/account/src/lib.rs#L48-L60)的独立账户。

![Accounts](/assets/docs/core/accounts/accounts.png)

## 要点

* 账户最多可以存储[10MiB](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/system_instruction.rs#L85)的数据，这些数据可以包含可执行程序代码或程序状态。
* 账户需要一笔与存储数据量成比例的lamport（SOL）[rent存款](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/rent/src/lib.rs#L93-L97)，当账户关闭时，这笔存款可以全额退还。
* 每个账户都有一个程序[owner](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/account/src/lib.rs#L55)（所有者）。只有拥有账户的程序才能修改其数据或扣除其lamport余额。但是，任何人都可以增加余额。
* **Sysvar账户**是存储网络集群状态的特殊账户。
* **Program账户**存储智能合约的可执行代码。
* **Data账户**由程序创建，用于存储和管理程序状态。

## 账户

Solana上的每个账户都由一个唯一的32字节地址标识，这通常显示为base58编码的字符串（例如`14grJpemFaf88c8tiVb77W7TYg2W3ir6pfkKz3YjhhZ5`）。

账户与其地址之间的关系可以被视为键值对，其中地址作为键，用于定位账户对应的链上数据。

![Account Address](/assets/docs/core/accounts/account-address.svg)

大多数Solana账户使用[Ed25519](https://ed25519.cr.yp.to/)公钥作为其地址。

虽然公钥通常用作账户地址，但Solana还支持一种称为Program Derived
Address（PDA）的功能。PDA是特殊地址，它们是从程序ID和可选输入（seed）确定性派生的。详细信息在[Program Derived Address](/docs/core/pda)页面中介绍。

### 账户类型

账户的最大大小为[10MiB](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/program/src/system_instruction.rs#L85)
而Solana上的每个账户都有相同的基本
[账户](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/account/src/lib.rs#L48-L60)
类型。

![Account Type](/assets/docs/core/accounts/account-type.svg)

并且Solana上的每个账户都具有相同的基本

* `data`: 存储账户任意数据的字节数组。对于非可执行账户，这通常存储只读状态。对于程序账户（智能合约），这包含可执行程序代码。数据字段通常被称为"账户数据"。
* `executable`: 这个布尔标志用于指示账户是否为程序。
* `lamports`: 账户中的lamport余额，SOL的最小单位（1 SOL = 10亿lamports）。
* `owner`: 拥有此账户的程序ID（公钥）。只有所有者程序可以修改账户数据或扣除其lamports余额。
* `rent_epoch`: 一个遗留字段，来自Solana曾经有一个机制定期从账户中扣除lamports的时期。虽然这个字段仍然存在于账户类型中，但自从rent收集被弃用后就不再使用了。

```rust title="Base Account Type"
pub struct Account {
    /// lamports in the account
    pub lamports: u64,
    /// data held in this account
    #[cfg_attr(feature = "serde", serde(with = "serde_bytes"))]
    pub data: Vec<u8>,
    /// the program that owns this account. If executable, the program that loads this account.
    pub owner: Pubkey,
    /// this account's data contains a loaded program (and is now read-only)
    pub executable: bool,
    /// the epoch at which this account will next owe rent
    pub rent_epoch: Epoch,
}
```

### Rent

Solana上的每个账户都有以下字段：[这里](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/rent/src/lib.rs#L93-L97)
使用这些
[常量](https://github.com/anza-xyz/agave/blob/v2.1.13/sdk/rent/src/lib.rs#L47-L70)。

"rent"一词源于一种已弃用的机制，该机制会定期从低于rent阈值的账户中扣除lamports。这种机制不再活跃。

### 程序所有者

Rent[程序](/docs/core/programs)。程序所有权是Solana账户模型的关键方面。每个账户都有一个指定的程序作为其所有者。只有所有者程序可以：

* 修改账户的`数据`字段
* 从账户余额中扣除lamport

## System Program

使用这些
[常量](https://github.com/anza-xyz/agave/tree/v2.1.13/programs/system/src)。

* [新账户创建](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/system/src/system_processor.rs#L146)：只有System
  Program可以创建新账户。
* [空间分配](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/system/src/system_processor.rs#L71)：为每个账户的数据字段设置字节容量。
* [转移/分配程序所有权](https://github.com/anza-xyz/agave/blob/v2.1.13/programs/system/src/system_processor.rs#L113)：一旦System
  Program创建了一个账户，它可以将指定的程序所有者重新分配给不同的程序账户。这就是自定义程序如何获得由System
  Program创建的新账户的所有权。

程序所有者

![System Account](/assets/docs/core/accounts/system-account.svg)

## Sysvar账户

系统程序[这里](https://docs.anza.xyz/runtime/sysvars)。

## 默认情况下，所有新账户都由

除了loader-v3之外，所有加载器都将它们管理的程序的可执行代码存储在所谓的程序账户中：
![Program Account](/assets/docs/core/accounts/program-account-simple.svg)

Solana上的所有"钱包"账户实际上都是由系统程序拥有的账户。存储在这些账户中的lamport余额代表钱包拥有的SOL数量。只有由系统程序拥有的账户才能用作交易费用支付者。

### 缓冲账户

Sysvar 账户

### Sysvar 账户是位于预定义地址的特殊账户，提供对集群状态数据的访问。这些账户会随着网络集群的数据动态更新。您可以在

程序账户![Programdata Account](/assets/docs/core/accounts/program-account-expanded.svg)

除了 loader-v3 之外，所有加载器都将它们管理的程序的可执行代码存储在所谓的程序账户中：

## Data账户

简单来说，您可以将程序账户视为程序本身。在调用程序的指令时，您需要指定程序账户的地址（通常称为"程序 ID"）。

缓冲区账户

![Data Account](/assets/docs/core/accounts/data-account.svg)

程序数据账户[System Program](/docs/core/accounts#system-program)可以创建新账户。一旦System
Program创建了一个账户，它就可以将新账户的所有权转移/分配给另一个程序。

Loader-v3 的工作方式与所有其他加载器不同，因为它为每个程序提供了一个间接层。程序账户只包含程序数据账户的地址，而程序数据账户则持有实际的可执行代码：

1. 调用System Program创建一个账户，然后将所有权转移给自定义程序
2. 调用现在拥有该账户的自定义程序，然后按照程序指令定义的方式初始化账户数据

这些程序数据账户不应与程序的数据账户（见下文）混淆。
