---
title: 向网络写入数据
description:
  学习如何通过发送交易和指令与Solana网络交互。按照逐步示例学习使用系统程序和代币扩展程序
  转移SOL代币和创建新代币。
---

在上一节中，您学习了如何从Solana网络读取数据。现在探索如何向其写入数据。向Solana网络写入数据涉及发送包含一个或多个指令的交易。

程序（智能合约）根据各自指令的业务逻辑处理这些指令。当您提交交易时，Solana运行时按顺序和原子性地执行每条指令（这意味着要么所有指令成功执行，要么整个交易失败）。

在本节中，您将看到两个基本示例：

1. 在账户之间转移SOL
2. 创建新代币

这些示例展示了如何构建和发送交易以调用Solana程序。有关更多详细信息，请参阅
[交易和指令](/docs/core/transactions) 和 [Solana上的费用](/docs/core/fees)
页面。

## 转移SOL

在此示例中，您将学习如何在两个账户之间转移SOL。

在Solana上，每个账户都有一个特定的程序作为其所有者。只有程序所有者才能扣除账户的SOL（lamport）余额。

系统程序是所有"钱包"账户的
[所有者](https://github.com/anza-xyz/agave/blob/v2.1.11/sdk/account/src/lib.rs#L55)
。要转移SOL，您必须调用系统程序的
[transfer](https://github.com/anza-xyz/agave/blob/v2.1.11/programs/system/src/system_processor.rs#L183-L213)
指令。

<WithNotes>
  <CodeTabs flags="r">
    ```ts !! title="Transfer SOL"
    import {
      LAMPORTS_PER_SOL,
      SystemProgram,
      Transaction,
      sendAndConfirmTransaction,
      Keypair,
      Connection
    } from "@solana/web3.js";

<CodeTabs flags="r">

```ts !! title="Transfer SOL"
import {
  LAMPORTS_PER_SOL,
  SystemProgram,
  Transaction,
  sendAndConfirmTransaction,
  Keypair,
  Connection
} from "@solana/web3.js";

// !tooltip[/connection/] connection
const connection = new Connection("http://localhost:8899", "confirmed");

// !tooltip[/sender/] sender
const sender = new Keypair();
// !tooltip[/receiver/] receiver
const receiver = new Keypair();

// !tooltip[/requestAirdrop/] airdrop
const signature = await connection.requestAirdrop(
  sender.publicKey,
  LAMPORTS_PER_SOL
);
await connection.confirmTransaction(signature, "confirmed");

// !tooltip[/transferInstruction/] instruction
const transferInstruction = SystemProgram.transfer({
  fromPubkey: sender.publicKey,
  toPubkey: receiver.publicKey,
  lamports: 0.01 * LAMPORTS_PER_SOL
});

// !tooltip[/transaction/] transaction
const transaction = new Transaction().add(transferInstruction);

// !tooltip[/sendAndConfirmTransaction/] sendAndConfirmTransaction
const transactionSignature = await sendAndConfirmTransaction(
  connection,
  transaction,
  [sender]
);

console.log("Transaction Signature:", `${transactionSignature}`);
```

</CodeTabs>

### 创建与Solana集群的连接。

!sender

### 生成一个新的密钥对用作

!receiver`sender`.

### 生成一个新的密钥对用作

!airdrop`receiver`.

### 请求SOL空投以为

!instruction`sender`。

### 构建指令以调用System Program的转账指令。

!transaction

### 创建新交易并添加转账指令。

!sendAndConfirmTransaction

### 发送交易。&#xA;

这些是构建交易以与Solana上任何程序交互的步骤。

<Steps>
  <Step>
    创建你想要调用的指令。

These are the steps for building transactions to interact with any program on
Solana.

  </Step>

Create the instruction you want to invoke.

```ts title="Instruction"
const transferInstruction = SystemProgram.transfer({
  fromPubkey: sender.publicKey,
  toPubkey: receiver.publicKey,
  // !mention one
  lamports: 0.01 * LAMPORTS_PER_SOL
});
```

  </Step>

Add the instruction to a transaction:

```ts title="Transaction"
const transaction = new Transaction().add(transferInstruction);
```

  </Step>
</Steps>

创建代币

```ts title="Send Transaction"
const transactionSignature = await sendAndConfirmTransaction(
  connection,
  transaction,
  [sender] // signer keypair
);
```

</Step>
</Steps>

## Create a Token

In this example, you'll learn how to create a new token on Solana using the
Token Extensions Program. This requires two instructions:

1. Invoke the System Program to create a new account.
2. Invoke the Token Extensions Program to initialize that account as a Mint.

<WithNotes>

<CodeTabs flags="r">

```ts !! title="Create Mint Account"
import {
  Connection,
  Keypair,
  SystemProgram,
  Transaction,
  sendAndConfirmTransaction,
  LAMPORTS_PER_SOL
} from "@solana/web3.js";
import {
  MINT_SIZE,
  TOKEN_2022_PROGRAM_ID,
  createInitializeMint2Instruction,
  getMinimumBalanceForRentExemptMint
} from "@solana/spl-token";

const connection = new Connection("http://localhost:8899", "confirmed");

// !tooltip[/wallet/] wallet
const wallet = new Keypair();
// Fund the wallet with SOL
const signature = await connection.requestAirdrop(
  wallet.publicKey,
  LAMPORTS_PER_SOL
);
await connection.confirmTransaction(signature, "confirmed");

// Generate keypair to use as address of mint account
// !tooltip[/mint/] mint
const mint = new Keypair();

// Calculate lamports required for rent exemption
// !tooltip[/rentExemptionLamports/] rentExemptionLamports
const rentExemptionLamports =
  await getMinimumBalanceForRentExemptMint(connection);

// Instruction to create new account with space for new mint account
// !tooltip[/createAccountInstruction/] createAccountInstruction
const createAccountInstruction = SystemProgram.createAccount({
  fromPubkey: wallet.publicKey,
  newAccountPubkey: mint.publicKey,
  space: MINT_SIZE,
  lamports: rentExemptionLamports,
  programId: TOKEN_2022_PROGRAM_ID
});

// Instruction to initialize mint account
// !tooltip[/initializeMintInstruction/] initializeMintInstruction
const initializeMintInstruction = createInitializeMint2Instruction(
  mint.publicKey,
  2, // decimals
  wallet.publicKey, // mint authority
  wallet.publicKey, // freeze authority
  TOKEN_2022_PROGRAM_ID
);

// Build transaction with instructions to create new account and initialize mint account
// !tooltip[/transaction/] transaction
const transaction = new Transaction().add(
  createAccountInstruction,
  initializeMintInstruction
);

// !tooltip[/sendAndConfirmTransaction/] sendAndConfirmTransaction
const transactionSignature = await sendAndConfirmTransaction(
  connection,
  transaction,
  [
    wallet, // payer
    mint // mint address keypair
  ]
);

console.log("Mint Account:", `${mint.publicKey}`);
console.log("Transaction Signature:", `${transactionSignature}`);
```

</CodeTabs>

### !rentLamports

计算铸币账户所需的lamports。

### !rentExemptionLamports

计算租金豁免所需的lamports

### !createAccountInstruction

构建指令以创建一个新账户，为铸币账户类型预留空间，并由Token扩展程序拥有。

### !initializeMintInstruction

构建指令以将新账户的数据初始化为铸币账户类型。

### !transaction

创建新交易并添加两条指令。

### 这里指令的顺序很重要。

!sendAndConfirmTransaction

### 发送交易。&#xA;

以下是示例的逐步分解：

The order of instructions matters here. The `createAccountInstruction` must come
before the `initializeMintInstruction`.

### !sendAndConfirmTransaction

Send the transaction.

  <Step>
    为铸币账户生成密钥对

Here's a step-by-step breakdown of what the example does:

  </Step>

Create a connection and fund the wallet

```ts title="Connection and Wallet"
const connection = new Connection("http://localhost:8899", "confirmed");
const wallet = new Keypair();
const signature = await connection.requestAirdrop(
  wallet.publicKey,
  LAMPORTS_PER_SOL
);
await connection.confirmTransaction(signature, "confirmed");
```

  </Step>

Generate a keypair for the Mint account

```ts title="Mint Keypair"
const mint = new Keypair();
```

  </Step>

Calculate the minimum lamports for rent exemption

```ts title="Rent Exemption"
const rentExemptionLamports =
  await getMinimumBalanceForRentExemptMint(connection);
```

  </Step>

Create an instruction to create a new account

<WithMentions>

1. [Allocate the required space](mention:one) for storing mint data
2. [Transfer lamports](mention:two) from the wallet to fund the new account
3. [Assign ownership](mention:three) of the account to the Token Extensions
   program (`TOKEN_2022_PROGRAM_ID`)

```ts title="Create Account Instruction"
const createAccountInstruction = SystemProgram.createAccount({
  fromPubkey: wallet.publicKey,
  newAccountPubkey: mint.publicKey,
  // !mention one
  space: MINT_SIZE,
  // !mention two
  lamports: rentExemptionLamports,
  // !mention three
  programId: TOKEN_2022_PROGRAM_ID
});
```

</WithMentions>

  </Step>

Create an instruction to initialize the Mint account

```ts title="Initialize Mint Instruction"
const initializeMintInstruction = createInitializeMint2Instruction(
  mint.publicKey,
  2, // decimals
  wallet.publicKey, // mint authority
  wallet.publicKey, // freeze authority
  TOKEN_2022_PROGRAM_ID
);
```

  </Step>
</Steps>

通过将两个指令合并到单个交易中，你可以确保账户创建和初始化原子性地发生。要么两个指令都成功，要么都不成功。这种方法在构建更复杂的Solana交易时很常见，因为它保证所有指令一起执行。

```ts title="Build Transaction"
const transaction = new Transaction().add(
  createAccountInstruction,
  initializeMintInstruction
);
```

</Step>
<Step>

Send and confirm the transaction with both required signers

```ts title="Send Transaction"
const transactionSignature = await sendAndConfirmTransaction(
  connection,
  transaction,
  [wallet, mint]
);
```

</Step>
<Step>

Print the Mint account and transaction signature

```ts title="Output"
console.log("Mint Account:", `${mint.publicKey}`);
console.log("Transaction Signature:", `${transactionSignature}`);
```

</Step>
</Steps>

By combining both instructions into a single transaction, you ensure that the
account creation and initialization happen atomically. Either both instructions
succeed, or neither does. This approach is common when building more complex
Solana transactions, as it guarantees that all instructions execute together.
