---
title: 向网络写入数据
description:
  学习如何通过发送交易和指令与Solana网络交互。按照逐步示例学习使用系统程序和代币扩展程序
  转移SOL代币和创建新代币。
---

在上一节中，您学习了如何从Solana网络读取数据。现在探索如何向其写入数据。向Solana网络写入数据涉及发送包含一个或多个指令的交易。

程序（智能合约）根据各自指令的业务逻辑处理这些指令。当您提交交易时，Solana运行时按顺序和原子性地执行每条指令（这意味着要么所有指令成功执行，要么整个交易失败）。

在本节中，您将看到两个基本示例：

1. 在账户之间转移SOL
2. 创建新代币

这些示例展示了如何构建和发送交易以调用Solana程序。有关更多详细信息，请参阅
[交易和指令](/docs/core/transactions) 和 [Solana上的费用](/docs/core/fees)
页面。

## 转移SOL

在此示例中，您将学习如何在两个账户之间转移SOL。

在Solana上，每个账户都有一个特定的程序作为其所有者。只有程序所有者才能扣除账户的SOL（lamport）余额。

系统程序是所有"钱包"账户的
[所有者](https://github.com/anza-xyz/agave/blob/v2.1.11/sdk/account/src/lib.rs#L55)
。要转移SOL，您必须调用系统程序的
[transfer](https://github.com/anza-xyz/agave/blob/v2.1.11/programs/system/src/system_processor.rs#L183-L213)
指令。

<WithNotes>
  <CodeTabs flags="r">
    ```ts !! title="Transfer SOL"
    import {
      LAMPORTS_PER_SOL,
      SystemProgram,
      Transaction,
      sendAndConfirmTransaction,
      Keypair,
      Connection
    } from "@solana/web3.js";

    // !tooltip[/connection/] connection
    const connection = new Connection("http://localhost:8899", "confirmed");

    // !tooltip[/sender/] sender
    const sender = new Keypair();
    // !tooltip[/receiver/] receiver
    const receiver = new Keypair();

    // !tooltip[/requestAirdrop/] airdrop
    const signature = await connection.requestAirdrop(
      sender.publicKey,
      LAMPORTS_PER_SOL
    );
    await connection.confirmTransaction(signature, "confirmed");

    // !tooltip[/transferInstruction/] instruction
    const transferInstruction = SystemProgram.transfer({
      fromPubkey: sender.publicKey,
      toPubkey: receiver.publicKey,
      lamports: 0.01 * LAMPORTS_PER_SOL
    });

    // !tooltip[/transaction/] transaction
    const transaction = new Transaction().add(transferInstruction);

    // !tooltip[/sendAndConfirmTransaction/] sendAndConfirmTransaction
    const transactionSignature = await sendAndConfirmTransaction(
      connection,
      transaction,
      [sender]
    );

    console.log("Transaction Signature:", `${transactionSignature}`);
    ```
  </CodeTabs>

  ### !connection

  创建与Solana集群的连接。

  ### !sender

  生成一个新的密钥对用作`发送方`。

  ### !receiver

  生成一个新的密钥对用作`接收方`。

  ### !airdrop

  请求SOL空投以为`发送方`提供资金。

  ### !instruction

  构建指令以调用System Program的转账指令。

  ### !transaction

  创建新交易并添加转账指令。

  ### !sendAndConfirmTransaction

  发送交易。
</WithNotes>

这些是构建交易以与Solana上任何程序交互的步骤。

<Steps>
  <Step>
    创建你想要调用的指令。

    ```ts title="Instruction"
    const transferInstruction = SystemProgram.transfer({
      fromPubkey: sender.publicKey,
      toPubkey: receiver.publicKey,
      // !mention one
      lamports: 0.01 * LAMPORTS_PER_SOL
    });
    ```
  </Step>

  <Step>
    将指令添加到交易中：

    ```ts title="Transaction"
    const transaction = new Transaction().add(transferInstruction);
    ```
  </Step>

  <Step>
    签名并发送交易：

    ```ts title="Send Transaction"
    const transactionSignature = await sendAndConfirmTransaction(
      connection,
      transaction,
      [sender] // signer keypair
    );
    ```
  </Step>
</Steps>

## 创建代币

在这个示例中，您将学习如何使用代币扩展程序在Solana上创建新代币。这需要两个指令：

1. 调用系统程序创建一个新账户。
2. 调用代币扩展程序将该账户初始化为铸币账户。

<WithNotes>
  <CodeTabs flags="r">
    ```ts !! title="Create Mint Account"
    import {
      Connection,
      Keypair,
      SystemProgram,
      Transaction,
      sendAndConfirmTransaction,
      LAMPORTS_PER_SOL
    } from "@solana/web3.js";
    import {
      MINT_SIZE,
      TOKEN_2022_PROGRAM_ID,
      createInitializeMint2Instruction,
      getMinimumBalanceForRentExemptMint
    } from "@solana/spl-token";

    const connection = new Connection("http://localhost:8899", "confirmed");

    // !tooltip[/wallet/] wallet
    const wallet = new Keypair();
    // Fund the wallet with SOL
    const signature = await connection.requestAirdrop(
      wallet.publicKey,
      LAMPORTS_PER_SOL
    );
    await connection.confirmTransaction(signature, "confirmed");

    // Generate keypair to use as address of mint account
    // !tooltip[/mint/] mint
    const mint = new Keypair();

    // Calculate lamports required for rent exemption
    // !tooltip[/rentExemptionLamports/] rentExemptionLamports
    const rentExemptionLamports =
      await getMinimumBalanceForRentExemptMint(connection);

    // Instruction to create new account with space for new mint account
    // !tooltip[/createAccountInstruction/] createAccountInstruction
    const createAccountInstruction = SystemProgram.createAccount({
      fromPubkey: wallet.publicKey,
      newAccountPubkey: mint.publicKey,
      space: MINT_SIZE,
      lamports: rentExemptionLamports,
      programId: TOKEN_2022_PROGRAM_ID
    });

    // Instruction to initialize mint account
    // !tooltip[/initializeMintInstruction/] initializeMintInstruction
    const initializeMintInstruction = createInitializeMint2Instruction(
      mint.publicKey,
      2, // decimals
      wallet.publicKey, // mint authority
      wallet.publicKey, // freeze authority
      TOKEN_2022_PROGRAM_ID
    );

    // Build transaction with instructions to create new account and initialize mint account
    // !tooltip[/transaction/] transaction
    const transaction = new Transaction().add(
      createAccountInstruction,
      initializeMintInstruction
    );

    // !tooltip[/sendAndConfirmTransaction/] sendAndConfirmTransaction
    const transactionSignature = await sendAndConfirmTransaction(
      connection,
      transaction,
      [
        wallet, // payer
        mint // mint address keypair
      ]
    );

    console.log("Mint Account:", `${mint.publicKey}`);
    console.log("Transaction Signature:", `${transactionSignature}`);
    ```
  </CodeTabs>

  ### !wallet

  生成一个新的密钥对作为钱包使用。

  ### !mint

  生成一个新的密钥对作为要创建的铸币账户的地址。

  ### !rentLamports

  计算铸币账户所需的lamports。

  ### !rentExemptionLamports

  计算租金豁免所需的lamports

  ### !createAccountInstruction

  构建指令以创建一个新账户，为铸币账户类型预留空间，并由Token扩展程序拥有。

  ### !initializeMintInstruction

  构建指令以将新账户的数据初始化为铸币账户类型。

  ### !transaction

  创建新交易并添加两条指令。

  这里指令的顺序很重要。`createAccountInstruction`必须在`initializeMintInstruction`之前。

  ### !sendAndConfirmTransaction

  发送交易。
</WithNotes>

以下是示例的逐步分解：

<Steps>
  <Step>
    创建连接并为钱包注资

    ```ts title="Connection and Wallet"
    const connection = new Connection("http://localhost:8899", "confirmed");
    const wallet = new Keypair();
    const signature = await connection.requestAirdrop(
      wallet.publicKey,
      LAMPORTS_PER_SOL
    );
    await connection.confirmTransaction(signature, "confirmed");
    ```
  </Step>

  <Step>
    为铸币账户生成密钥对

    ```ts title="Mint Keypair"
    const mint = new Keypair();
    ```
  </Step>

  <Step>
    计算免除租金所需的最小lamports

    ```ts title="Rent Exemption"
    const rentExemptionLamports =
      await getMinimumBalanceForRentExemptMint(connection);
    ```
  </Step>

  <Step>
    创建指令以创建新账户

    <WithMentions>
      1. [Allocate the required space](mention:one)
      2. [Transfer lamports](mention:two)以资助新账户
      3. [Assign ownership](mention:three)分配给Token Extensions程序（`TOKEN_2022_PROGRAM_ID`）

      ```ts title="Create Account Instruction"
      const createAccountInstruction = SystemProgram.createAccount({
        fromPubkey: wallet.publicKey,
        newAccountPubkey: mint.publicKey,
        // !mention one
        space: MINT_SIZE,
        // !mention two
        lamports: rentExemptionLamports,
        // !mention three
        programId: TOKEN_2022_PROGRAM_ID
      });
      ```
    </WithMentions>
  </Step>

  <Step>
    创建指令以初始化Mint账户

    ```ts title="Initialize Mint Instruction"
    const initializeMintInstruction = createInitializeMint2Instruction(
      mint.publicKey,
      2, // decimals
      wallet.publicKey, // mint authority
      wallet.publicKey, // freeze authority
      TOKEN_2022_PROGRAM_ID
    );
    ```
  </Step>

  <Step>
    将两个指令添加到交易中

    ```ts title="Build Transaction"
    const transaction = new Transaction().add(
      createAccountInstruction,
      initializeMintInstruction
    );
    ```
  </Step>

  <Step>
    发送并确认包含所有必需签名者的交易

    ```ts title="Send Transaction"
    const transactionSignature = await sendAndConfirmTransaction(
      connection,
      transaction,
      [wallet, mint]
    );
    ```
  </Step>

  <Step>
    打印Mint账户和交易签名

    ```ts title="Output"
    console.log("Mint Account:", `${mint.publicKey}`);
    console.log("Transaction Signature:", `${transactionSignature}`);
    ```
  </Step>
</Steps>

通过将两个指令合并到单个交易中，你可以确保账户创建和初始化原子性地发生。要么两个指令都成功，要么都不成功。这种方法在构建更复杂的Solana交易时很常见，因为它保证所有指令一起执行。
