---
title: 从网络读取数据
description:
  学习如何从Solana区块链网络读取数据。本指南涵盖了
  使用JavaScript/TypeScript获取钱包账户、程序账户和代币铸造账户的方法，
  并提供了使用Solana web3.js库的实用示例。
---

本节探讨如何通过获取不同类型的账户来从Solana网络读取数据，以理解Solana账户的结构。

在Solana上，所有数据都存在于"账户"中。你可以将Solana上的数据视为一个公共数据库，其中有一个单一的"账户"表，每个条目都是一个具有相同基础的账户[账户类型](https://github.com/anza-xyz/agave/blob/v2.1.11/sdk/account/src/lib.rs#L48-L60)。

![Accounts](/assets/docs/core/accounts/accounts.png)

Solana上的账户可以存储"状态"或"可执行"程序。每个账户都有一个"地址"（公钥），作为其唯一标识符，用于定位其对应的链上数据。

Solana账户包含以下内容之一：

* **状态**：用于读取和持久化的数据。例如，关于代币的信息、用户数据或程序内定义的其他数据。
* **可执行程序**：包含Solana程序实际代码的账户。这些账户存储用户可以调用的指令。

程序代码和程序状态的这种分离是Solana账户模型的一个关键特性。有关更多详细信息，请参阅[Solana账户模型](/docs/core/accounts)页面。

<Steps>
  <Step>
    ## 获取钱包账户

    此示例演示如何：

    1. 生成新的密钥对（公钥/私钥对）。
    2. 请求SOL空投以为新地址提供资金。
    3. 检索已资助地址的账户数据。

    在Solana上，用SOL为新地址提供资金会自动创建一个由系统程序拥有的账户。所有"钱包"账户实际上都是由系统程序拥有的账户，它们持有SOL并可以签署交易。

    <CodeTabs flags="r">
      ```ts !! title="Fetch Account"
      import { Keypair, Connection, LAMPORTS_PER_SOL } from "@solana/web3.js";

      // !mark
      const keypair = Keypair.generate();
      console.log(`Public Key: ${keypair.publicKey}`);

      const connection = new Connection("http://localhost:8899", "confirmed");

      // Funding an address with SOL automatically creates an account
      const signature = await connection.requestAirdrop(
        keypair.publicKey,
        LAMPORTS_PER_SOL
      );
      await connection.confirmTransaction(signature, "confirmed");

      // !mark
      const accountInfo = await connection.getAccountInfo(keypair.publicKey);
      console.log(JSON.stringify(accountInfo, null, 2));
      ```
    </CodeTabs>

    <Accordions>
      <Accordion title="解释">
        所有Solana账户共享相同的
        [账户类型](https://github.com/anza-xyz/agave/blob/v2.1.11/sdk/account/src/lib.rs#L48-L60)。

        Solana上的"钱包"是由
        [系统程序](https://github.com/anza-xyz/agave/tree/v2.1.11/programs/system)拥有的账户，
        这是Solana的内置程序之一。钱包账户主要用于
        持有SOL（在`lamports`字段中跟踪）和签署交易。

        当你获取钱包账户信息时，响应包括以下字段：

        | 字段           | 描述                                                            |
        | ------------ | ------------------------------------------------------------- |
        | `data`       | 账户的数据缓冲区。对于钱包账户，这是空的（0字节）。其他账户使用此字段存储数据。                      |
        | `executable` | 表示账户是否包含可执行程序代码。对于钱包和状态账户，这是`false`。                          |
        | `owner`      | 拥有该账户的程序。对于钱包，这始终是系统程序，地址为`11111111111111111111111111111111`。 |
        | `lamports`   | 账户的SOL余额，以lamports为单位（1 SOL = 1,000,000,000 lamports）。        |
        | `rentEpoch`  | 与Solana已弃用的租金机制相关的遗留字段（目前未使用）。                                |
        | `space`      | 以字节为单位的`data`字段的大小（注意：这不是*rs`Account`*&#x7C7B;型本身的字段）。        |
      </Accordion>
    </Accordions>
  </Step>

  <Step>
    ## 获取Token程序

    这个示例获取Token程序，用于演示钱包账户和程序账户之间的区别。

    <CodeTabs flags="r">
      ```ts !! title="Fetch Program Account"
      import { Connection, PublicKey } from "@solana/web3.js";

      const connection = new Connection(
        "https://api.mainnet-beta.solana.com",
        "confirmed"
      );
      // !mark(1:2)
      const address = new PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");
      const accountInfo = await connection.getAccountInfo(address);

      // !collapse(1:17) collapsed
      console.log(
        JSON.stringify(
          accountInfo,
          (key, value) => {
            if (key === "data" && value && value.length > 1) {
              return [
                value[0],
                "...truncated, total bytes: " + value.length + "...",
                value[value.length - 1]
              ];
            }
            return value;
          },
          2
        )
      );
      ```
    </CodeTabs>

    <Accordions>
      <Accordion title="Explanation">
        Token程序是Solana上的一个可执行程序账户。与钱包账户一样，程序具有相同的底层[Account](https://github.com/anza-xyz/agave/blob/v2.1.11/sdk/account/src/lib.rs#L48-L60)数据结构，但在字段上有关键差异：

        | 字段           | 描述                                                                                     |
        | ------------ | -------------------------------------------------------------------------------------- |
        | `executable` | 设置为`true`，表示此账户包含可执行程序代码。                                                              |
        | `data`       | 对于程序账户，此字段存储程序的可执行代码。相比之下，钱包账户的data字段为空。                                               |
        | `所有者`        | 该账户由加载器程序拥有，这是一类内置程序，在Solana上拥有可执行程序账户。（`BPFLoader2111111111111111111111111111111111`） |

        程序账户存储了代币程序的编译字节码
        [源代码](https://github.com/solana-program/token/tree/main/program)。您
        可以在
        [Solana浏览器](https://explorer.solana.com/address/TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA)上查看此程序账户。
      </Accordion>
    </Accordions>
  </Step>

  <Step>
    ## 获取铸币账户

    这个示例获取美元币（USDC）铸币账户，展示了Solana上的程序如何在单独的账户中存储状态。

    一个
    [铸币](https://github.com/solana-program/token/blob/program%40v8.0.0/program/src/state.rs#L16-L30)
    账户是由代币程序拥有的账户。它存储特定代币的全局元数据，包括总供应量、小数位数以及授权铸造或冻结代币的账户。铸币账户的地址在Solana网络上唯一标识一个代币。

    <CodeTabs flags="r">
      ```ts !! title="Fetch Program Account"
      import { Connection, PublicKey } from "@solana/web3.js";

      const connection = new Connection(
        "https://api.mainnet-beta.solana.com",
        "confirmed"
      );

      // !mark(1:2)
      const address = new PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v");
      const accountInfo = await connection.getAccountInfo(address);

      // !collapse(1:17) collapsed
      console.log(
        JSON.stringify(
          accountInfo,
          (key, value) => {
            if (key === "data" && value && value.length > 1) {
              return [
                value[0],
                "...truncated, total bytes: " + value.length + "...",
                value[value.length - 1]
              ];
            }
            return value;
          },
          2
        )
      );
      ```
    </CodeTabs>

    <Accordions>
      <Accordion title="解释">
        关于铸币账户数据，以下是需要注意的要点：

        | 字段           | 描述                                                         |
        | ------------ | ---------------------------------------------------------- |
        | `executable` | 此字段为`false`，因为铸币账户存储状态，而非可执行代码。                            |
        | `数据`         | 此字段包含序列化的账户状态，例如铸币权限、总供应量、小数位数                             |
        | `所有者`        | 代币程序（`TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA`）拥有铸币账户。 |
      </Accordion>
    </Accordions>
  </Step>

  <Step>
    ## 反序列化铸币账户

    Solana账户的`data`字段包含原始字节。要有意义地解释这些数据，你必须将其反序列化为拥有该账户的程序所定义的适当数据类型。

    大多数Solana程序提供客户端库，其中包含辅助函数，这些函数抽象了反序列化过程。这些函数将原始账户字节转换为结构化数据类型，使账户数据更易于使用。

    <WithMentions>
      例如，*shell`@solana/spl-token`*&#x5305;含了
      [*ts`getMint()`*](mention:one)函数，帮助将铸币账户的
      `data`字段反序列化为
      [Mint](https://github.com/solana-program/token/blob/program%40v8.0.0/program/src/state.rs#L16-L30)
      数据类型。

      <CodeTabs flags="r">
        ```ts !! title="Deserialize Mint Account Data"
        import { PublicKey, Connection } from "@solana/web3.js";
        import { getMint } from "@solana/spl-token";

        const connection = new Connection(
          "https://api.mainnet-beta.solana.com",
          "confirmed"
        );

        const address = new PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v");
        // !mention one
        const mintData = await getMint(connection, address, "confirmed");

        // !collapse(1:17) collapsed
        console.log(
          JSON.stringify(
            mintData,
            (key, value) => {
              // Convert BigInt to String
              if (typeof value === "bigint") {
                return value.toString();
              }
              // Handle Buffer objects
              if (Buffer.isBuffer(value)) {
                return `<Buffer ${value.toString("hex")}>`;
              }
              return value;
            },
            2
          )
        );
        ```
      </CodeTabs>
    </WithMentions>

    <Accordions>
      <Accordion title="解释">
        这个*ts`getMint()`* 函数将账户的 `data` 字段反序列化为
        [Mint](https://github.com/solana-program/token/blob/program%40v8.0.0/program/src/state.rs#L16-L30)
        代币程序定义的数据类型。

        | 字段                | 描述                   |
        | ----------------- | -------------------- |
        | `address`         | Mint 账户的地址           |
        | `mintAuthority`   | 允许铸造新代币的权限           |
        | `supply`          | 代币的总供应量              |
        | `decimals`        | 代币的小数位数              |
        | `isInitialized`   | 表示 Mint 账户是否已初始化     |
        | `freezeAuthority` | 允许冻结代币账户的权限          |
        | `tlvData`         | 代币扩展的额外数据（需要进一步反序列化） |

        你可以查看完全反序列化的
        [Mint 账户](https://explorer.solana.com/address/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v?cluster=mainnet-beta)
        在Solana Explorer上的数据。
      </Accordion>
    </Accordions>
  </Step>
</Steps>
