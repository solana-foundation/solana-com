---
title: 本地验证者
description: 如何运行 Solana 本地验证者以进行 Solana 本地测试
seoTitle: 如何运行 Solana 本地验证者进行测试
keywords:
  - solana 测试
  - solana localnet
  - solana 本地验证者
  - 本地测试
  - 本地程序测试
  - solana 程序测试
  - solana 程序开发
h1: 运行本地 Solana 验证者网络
---

> 这是 [Solana 工具包](/docs/toolkit/)
> 的测试版，仍在开发中。请将所有反馈作为 GitHub 问题发布在
> [这里](https://github.com/solana-foundation/mucho/issues/new?title=%5Btoolkit%5D%20)。

Solana 测试验证者是 Solana 区块链的本地模拟器，旨在为开发者提供一个私密且可控的环境，用于构建和测试 Solana 程序，而无需连接到公共测试网或主网。它还完全支持标准的
[Solana RPC 标准](/docs/rpc/http/)。

如果您已经安装了 Solana CLI 工具套件，可以通过以下命令运行测试验证者：

```shell
mucho validator --help
```

> 通过运行以下命令安装
> [Solana 工具包](/docs/toolkit/getting-started#installation)：
>
> ```shell
> npx -y mucho@latest install
> ```

## 优势

- 随时重置区块链状态的能力
- 模拟不同网络条件的能力
- 无 RPC 速率限制
- 无空投限制
- 直接部署链上程序
- 从公共集群（如 devnet、mainnet 等）克隆账户和程序的能力
- 从文件加载账户和程序的能力
- 可配置的交易历史保留
- 可配置的 epoch 长度

## 启动测试验证者

要启动您的本地验证者，只需运行：

```shell
mucho validator
```

此命令会初始化一个新的账本，并启动运行在 `http://localhost:8899` 的本地验证者，您可以将其用作 Solana
RPC 连接 URL。

## 连接到测试验证器

使用 Solana CLI 连接到本地测试验证器：

```shell
solana config set --url localhost
```

这将确保您的所有 Solana CLI 命令都将指向本地测试验证器。

## 检查测试验证器的状态

在与测试验证器交互之前，确认其状态并确保其正常运行是很有用的。

```shell
solana ping
```

此命令会 ping 本地测试验证器并返回当前的区块哈希和延迟，以验证其是否处于活动状态。

## 本地部署和管理程序

将已编译的程序（BPF）部署到测试验证器：

```shell
solana program deploy <PROGRAM_FILE_PATH>
```

这会将程序上传并部署到区块链上。

检查已部署程序的详细信息：

```shell
solana program show <ACCOUNT_ADDRESS>
```

## 发送交易

将 SOL 从一个账户转移到另一个账户：

```shell
solana transfer --from /path/to/keypair.json <RECIPIENT_ADDRESS> <AMOUNT>
```

这会将 `AMOUNT` 的 SOL 从源账户发送到 `RECIPIENT_ADDRESS`。

## 模拟和确认交易

在实际发送交易之前，您可以模拟它以查看是否可能成功：

```shell
solana transfer --from /path/to/keypair.json \
  --simulate <RECIPIENT_ADDRESS> <AMOUNT>
```

确认交易的详细信息和状态：

```shell
solana confirm <TRANSACTION_SIGNATURE>
```

## 查看最近的区块生产

查看最近区块生产的信息，这对于调试性能问题可能很有用：

```shell
solana block-production
```

## 验证器日志

为了调试，您可能需要更详细的日志：

```shell
solana logs
```

这会从验证器中流式传输日志消息。

### 日志记录提示

- 如果需要更详细的调试输出，可以使用 `-v` 标志增加日志详细程度。
- 使用 `--rpc-port` 和 `--rpc-bind-address` 选项自定义 RPC 服务器设置。
- 使用 `--gossip-host` 选项调整验证器使用的 CPU 核心数量，以更真实地模拟网络条件。

## 配置

查看 Solana 测试验证器可用的所有配置选项：

```shell
mucho validator --help
```

## 本地账本

默认情况下，账本数据存储在当前工作目录中名为 `test-ledger` 的目录中。

### 指定账本位置

启动测试验证器时，您可以使用 `--ledger` 选项指定账本数据的其他目录：

```shell
mucho validator --ledger /path/to/custom/ledger
```

## 重置账本

默认情况下，如果找到现有账本，验证器将继续使用它。要重置账本，您可以手动删除账本目录，或者使用 `--reset` 标志重新启动验证器：

```shell
mucho validator --reset
```

如果账本存在，此命令将重置账本到创世状态，这会通过删除所有现有账户/程序并重新开始来重置状态。

## 克隆程序

要将现有的链上程序添加到您的本地环境，您可以使用新的账本克隆该程序。这对于测试与其他集群上已存在的程序的交互非常有用。

从其他集群克隆一个账户：

```shell
mucho validator --reset \
  --url CLUSTER_PROGRAM_IS_DEPLOYED_TO \
  --clone PROGRAM_ADDRESS
```

从其他集群克隆一个可升级程序及其可执行数据：

```shell
mucho validator --reset \
  --url CLUSTER_PROGRAM_IS_DEPLOYED_TO \
  --clone-upgradeable-program PROGRAM_ADDRESS
```

> 如果您的工作目录中已经存在一个账本，您必须重置账本才能克隆程序或账户。

## 克隆账户

要将现有的链上账户添加到您的本地环境中，您可以从任何其他网络集群克隆账户并创建一个新的账本。

当账本已存在时，从集群克隆账户的方法：

```shell
mucho validator --reset \
  --url CLUSTER_PROGRAM_IS_DEPLOYED_TO \
  --clone ACCOUNT_ADDRESS
```

## 重置为特定账户数据

要在每次启动 validator 时重置特定账户的状态，您可以结合使用账户快照和 `--account` 标志。

首先，将账户的所需状态保存为一个 JSON 文件：

```shell
solana account ACCOUNT_ADDRESS --output json --output-file account_state.json
```

然后在每次重置 validator 时加载此状态：

```shell
mucho validator --reset \
  --account ACCOUNT_ADDRESS account_state.json
```

## 运行时功能

Solana 提供了一种功能集机制，允许您在运行测试 validator 时启用或禁用某些区块链功能。默认情况下，测试 validator 会激活所有运行时功能。

查看所有可用的运行时功能及其状态的方法：

```shell
solana feature status
```

查询特定运行时功能状态的方法：

```shell
solana feature status <ADDRESS>
```

在创世块中停用特定功能的方法：

> 这必须在一个新的账本上完成，因此如果您的工作目录中已经存在一个账本，您必须添加 `--reset` 标志以重置为创世块。

```shell
mucho validator --reset \
  --deactivate-feature <FEATURE_PUBKEY>
```

在创世块中停用多个功能的方法：

```shell
mucho validator --reset \
  --deactivate-feature <FEATURE_PUBKEY_1> <FEATURE_PUBKEY_2>
```

## 更改版本

检查您当前的 `solana-test-validator` 版本的方法：

```shell
mucho validator --version
```

您的测试 validator 运行的版本与已安装并配置使用的 Solana CLI 版本相同。

要针对不同版本的 Solana 运行时测试您的程序，您可以安装多个版本的 Solana
CLI，并使用以下命令在它们之间切换：

```shell
solana-install init <VERSION>
```

更改版本后，请确保重置您的 Solana 测试 validator 的账本，以确保运行有效且无损坏的账本。
