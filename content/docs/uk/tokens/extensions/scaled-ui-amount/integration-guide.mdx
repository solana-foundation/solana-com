---
title: Посібник з інтеграції масштабованої суми інтерфейсу
description:
  Дізнайтеся, як інтегрувати токен, що використовує розширення масштабованої
  суми інтерфейсу, у вашому додатку.
---

# Підтримка розширення масштабованої суми інтерфейсу на Solana

## Передумови

Нещодавно було запущено нове розширення токенів під назвою "Масштабована сума
інтерфейсу", яке дозволяє емітентам токенів вказувати множник для використання
при обчисленні суми в інтерфейсі для балансу токенів користувача. Це дозволяє
емітентам створювати токени з ребазингом та уможливлює такі речі, як дроблення
акцій. Це розширення, як і розширення токенів з нарахуванням відсотків,
забезпечує суто косметичну суму в інтерфейсі. Базові розрахунки та перекази
відбуваються з використанням необроблених сум у програмі.

### Ресурси:

- [Документація для розробників](https://www.solana-program.com/docs/token-2022/extensions#scaled-ui-amount)
- [Код розширення на Rust](https://github.com/solana-program/token-2022/tree/main/program/src/extension/scaled_ui_amount)
- [Код перетворення суми в суму інтерфейсу на Rust](https://github.com/solana-program/token-2022/blob/main/program/src/processor.rs#L1425)

## Цілі

- Забезпечити найкращий досвід користувача для кінцевих користувачів
- Надати чіткі та зрозумілі рекомендації для команд, щоб створити єдиний досвід
  використання токенів з нарахуванням відсотків у всій екосистемі
- Визначити та спланувати роботу для зменшення обсягу роботи, яку команди
  повинні виконати для інтеграції з розширенням масштабованої суми інтерфейсу

## Короткий підсумок

- Кінцеві користувачі повинні взаємодіяти з UIAmount (необроблена сума \*
  множник) для ціни токена, балансу токена та сум токенів, коли це можливо
- Децентралізовані додатки та постачальники послуг повинні використовувати
  необроблену суму та немасштабовані ціни для всіх розрахунків і конвертувати
  для користувачів на кінцевому етапі
- Історичні цінові потоки повинні надаватися як для масштабованих, так і для
  немасштабованих сум для полегшення інтеграції
- Історичні значення множника повинні бути доступними для точних історичних
  даних

## Визначення термінів

- Множник: статичний оновлюваний множник, який використовується для розрахунків
  суми в інтерфейсі користувача
- UIAmount: множник \* необроблена сума (також відома як: масштабована сума)
- Необроблена сума: сума (також відома як: немасштабована сума)

## Поточний баланс

### Поточна сума для відображення

- Щоразу, коли ви відображаєте суми токенів, які використовують розширення
  масштабованої суми інтерфейсу користувача для кінцевих користувачів, вам слід
  використовувати:
  - UIAmount/UIAmountString (**_рекомендовано_**)
  - Ручний розрахунок необробленої суми \* множник
  - Ми рекомендуємо обрізати це значення на основі кількості десяткових знаків,
    які має токен.
    - Наприклад: якщо yUSD має 6 десяткових знаків і користувач має UIAmount
      1.123456789, вам слід відображати "1.123456"

### Де отримати ці дані:

- Для актуального балансу користувача ви можете отримати оновлену інформацію про
  вищезазначені суми викликавши getTokenAccountBalance або getAccountInfo
- Якщо вам потрібно знати UI Amount для довільної суми, ви можете отримати цей
  розрахунок, викликавши функцію
  [`amountToUiAmountForMintWithoutSimulation`](https://github.com/solana-program/token-2022/blob/main/clients/js-legacy/src/actions/amountToUiAmount.ts#L164)
  (web3.js v1) або симулюючи транзакцію за допомогою amountToUiAmount.
  - Примітка: amountToUiAmount вимагає симуляції транзакції, що означає, що
    також потрібен дійсний платник комісії з балансом. Через це, це не повинно
    бути основним способом отримання балансу.

### Оновлення поточної суми

Оскільки емітенти можуть оновлювати множник у будь-який час, ви можете
розглянути можливість періодичного опитування, щоб підтримувати баланс рахунку в
актуальному стані. Емітенти навряд чи оновлюватимуть цей множник частіше, ніж
раз на день. Якщо множник встановлено на майбутню дату, ви можете автоматично
опитувати в цей час оновлення

## Суми токенів у транзакціях (перекази / обміни тощо)

- Користувачі повинні вводити суми, які інтерпретуються як масштабована
  "UIAmount". Додаток, який обробляє це, повинен конвертувати в необроблену суму
  токенів для транзакції.
  - Якщо виникають проблеми з округленням, округліть у меншу сторону і краще
    залиште невелику кількість пилу, ніж ризикуйте невдачею транзакції
  - Для цієї конвертації ви можете використовувати
    [`uiAmountToAmountForMintWithoutSimulation`](https://github.com/solana-program/token-2022/blob/main/clients/js-legacy/src/actions/amountToUiAmount.ts#L312C23-L312C63)
    (web3.js v1) функцію або симулювати транзакцію за допомогою
    amountToUiAmount.
- Додатки повинні використовувати загальну необроблену суму, коли користувач
  запитує виконати дію з "максимальним" або "всім" своїм балансом. Це гарантує,
  що не залишиться пилу.
  - Опціонально: ви можете розглянути можливість автоматичного закриття рахунку,
    коли використовується "максимум", щоб повернути користувачеві їхній депозит
    за зберігання

## Ціна токена

- Ціна токена завжди повинна відображатися як масштабована ціна, де це можливо.
- Якщо ви є постачальником сервісу цінових потоків, наприклад оракулом, ви
  повинні надавати як масштабовану, так і немасштабовану ціну.
  - Де можливо, надавайте SDK/API, який абстрагує складності розширення
    масштабованої UI суми.

## Поточний множник

- Поточний множник можна зчитати з токен-мінту в будь-який час, викликавши
  `getAccountInfo`. Крім того, якщо встановлено майбутній множник, ця інформація
  також доступна з токен-мінту. Ми рекомендуємо не показувати цей множник,
  оскільки він може заплутати UX.

## Історичні дані

### Історичні дані для цінового потоку

- Сервіси, які надають історичні дані, повинні зберігати та **показувати як
  масштабовані, так і немасштабовані ціни для розширення масштабованої UI
  суми**.
- Ми очікуємо, що масштабовані суми будуть використовуватися найчастіше,
  оскільки це відповідає тому, як традиційний фінансовий світ обробляє графіки,
  пов'язані з токенами зі спліт-акціями.

### Історичні дані для сум

- Якщо ви хочете показати баланс, переказаний у минулому, вам потрібен доступ до
  множника на той конкретний slot. Ви також можете зберігати UiAmount для
  переказів під час обробки транзакцій, щоб уникнути цього обчислення в
  майбутньому.

## Зворотна сумісність

- За замовчуванням гаманці та програми, які не розуміють розширення
  масштабованої UI суми, показуватимуть правильну загальну ціну активності
  шляхом множення немасштабованої ціни \* на необроблену суму.
- Однак вони відображатимуть немасштабовану ціну, що може спричинити плутанину
  для користувачів.
- Ми сподіваємося, що це заохотить команди оновити свої децентралізовані додатки
  для сумісності з токенами, які використовують розширення масштабованої UI
  суми, і ми раді надати підтримку під час цього процесу.

## Службові функції для додавання до бібліотеки SPL-Token:

- **\[Виконано\]** Amount to UIAmount: Функція для отримання UIAmount на
  поточний момент, враховуючи монету та необроблену суму
- **\[Виконано\]** UIAmount to Amount: Функція для отримання необробленої суми
  на поточний момент, враховуючи монету та UIAmount
- **\[Виконано\]** Amount to UIAmount for: Функція для отримання UIAmount для
  заданого множника, десяткового значення та необробленої суми
- **\[Виконано\]** UIAmount to Amount: Функція для отримання необробленої суми
  для заданого множника, десяткового значення та UIAmount
- **\[TODO\]** Усі вищезазначені допоміжні функції для @solana/kit

## Критерії прийняття для кожної платформи

### **Загальні вимоги**

| Вимога                                             | Опис                                                                                                                                                                                                                 | Пріоритет |
| :------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| Підтримка дій користувача з використанням UiAmount | Усі дії користувача повинні вводитися в UiAmount, коли UiAmount увімкнено в усьому додатку. Якщо UiAmount не відображається в додатку, вони повинні використовувати необроблені суми, доки додаток не буде оновлено. | **P0**    |

---

### **Гаманці**

| Вимога                                       | Опис                                                                                                                             | Пріоритет |
| :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| Відображення масштабованого балансу          | Показувати масштабовану суму (uiAmount) як основний баланс.                                                                      | **P0**    |
| Підтримка переказів токенів                  | Кінцеві користувачі повинні вводити суми переказів з їхніми масштабованими балансами (сира сума \* баланс).                      | **P0**    |
| Відображення спотової ціни                   | Відображати масштабовану спотову ціну для користувачів                                                                           | **P0**    |
| Метадані історії транзакцій                  | Показувати масштабовану суму (UIAmount) для кожного переказу, де це можливо.                                                     | **P1**    |
| Показ оновлень множника в історії транзакцій | Коли відбуваються оновлення множника, показувати це як подію в історії транзакцій користувача, включаючи отриману суму           | **P2**    |
| Відображення графіка історії цін             | Відображати масштабовані ціни на графіку цін                                                                                     | **P1**    |
| Онбординг/Підказки                           | Пропонувати підказки або онбординг для інформування користувачів про токени, які використовують розширення масштабованої суми ui | **P2**    |

---

### **Провідники**

| Вимога                                                         | Опис                                                                                             | Пріоритет |
| :------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :-------- |
| Покращення сторінки деталей токена                             | Відображення метаданих, таких як загальна масштабована ринкова капіталізація та поточний множник | **P0**    |
| Відображення масштабованого балансу для балансів               | Відображення масштабованих балансів (UiAmount) для поточних балансів.                            | **P0**    |
| Відображення масштабованого балансу для транзакцій             | Відображення масштабованих балансів (UiAmount) для сум переказів для історичних транзакцій.      | **P0**    |
| Відображення масштабованої ціни для транзакцій                 | Відображення масштабованих цін для попередніх транзакцій                                         | **P1**    |
| Правильний аналіз і відображення транзакцій оновлення множника | Правильно показувати деталі про оновлення множника                                               | **P2**    |

---

### **Агрегатори ринкових даних (наприклад: CoinGecko)**

| Вимога                                           | Опис                                                                                                       | Пріоритет |
| :----------------------------------------------- | :--------------------------------------------------------------------------------------------------------- | :-------- |
| Оновлення API для масштабованих даних            | Розширити функціональність API, щоб включити зміни множника з часом, а також масштабовану ціну.            | **P0**    |
| Загальна пропозиція з масштабованим коригуванням | При відображенні загальної пропозиції та загальної ринкової капіталізації враховувати масштабовані баланси | **P0**    |
| Відстеження історичних цін                       | Надавати історичний графік цін, використовуючи масштабовану ціну з часом.                                  | **P1**    |
| Відстеження історичних множників                 | Надавати історичні маркери оновлень множника для токенів, що приносять відсотки.                           | **P2**    |
| Освітній контент або пояснення                   | Включати короткі описи або підказки, що пояснюють, як працюють масштабовані токени.                        | **P2**    |

---

### **Постачальники цінових фідів**

| Вимога                                     | Опис                                                                                        | Пріоритет |
| :----------------------------------------- | :------------------------------------------------------------------------------------------ | :-------- |
| Масштабовані та немасштабовані цінові фіди | Надавати цінові фіди як для масштабованих, так і для немасштабованих цін.                   | **P0**    |
| Дані про історичні множники                | Пропонувати API з історичними змінами множника.                                             | **P0**    |
| Дані про історичні ціни                    | Пропонувати API з історичними цінами на основі як масштабованих, так і немасштабованих сум. | **P0**    |

---

### **DEX-и**

| Вимога                                    | Опис                                                                                                                             | Пріоритет |
| :---------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| Відображення ребазованих балансів токенів | Показувати масштабовані баланси для торгівлі або надання ліквідності в інтерфейсі (бекенд може використовувати необроблені суми) | **P0**    |
| Підтримка дій з токенами                  | Кінцеві користувачі повинні вводити суми дій зі своїми балансами UiAmount (множник \* необроблена сума).                         | **P0**    |
| Адаптація цінового фіду                   | Скрізь, де ціновий фід використовується для відображення поточної ціни, надавати масштабовану ціну кінцевим користувачам.        | **P1**    |
| Відображення графіка історії цін          | Відображати масштабовані ціни на графіку цін                                                                                     | **P1**    |
