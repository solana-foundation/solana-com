---
title: Руководство по интеграции Scaled UI Amount
description:
  Узнайте, как интегрировать токен, использующий расширение Scaled UI Amount, в
  ваше приложение.
---

# Поддержка расширения Scaled UI Amount на Solana

## Общая информация

Недавно было запущено новое расширение токенов под названием "Scaled UI Amount",
которое позволяет эмитентам токенов задавать множитель, используемый при расчете
UI-количества баланса токенов пользователя. Это дает возможность эмитентам
создавать токены с ребалансировкой и реализовывать такие функции, как дробление
акций. Это расширение, как и расширение для токенов с начислением процентов,
предоставляет исключительно косметическое UI-количество. Все основные расчеты и
переводы выполняются с использованием необработанных значений в программе.

### Ресурсы:

- [Документация для разработчиков](https://www.solana-program.com/docs/token-2022/extensions#scaled-ui-amount)
- [Код расширения на Rust](https://github.com/solana-program/token-2022/tree/main/program/src/extension/scaled_ui_amount)
- [Код для преобразования количества в UI Amount на Rust](https://github.com/solana-program/token-2022/blob/main/program/src/processor.rs#L1425)

## Цели

- Обеспечить лучший пользовательский опыт для конечных пользователей
- Предоставить четкие и понятные рекомендации для команд по созданию единого
  опыта работы с токенами с начислением процентов в экосистеме
- Определить и спланировать работу, чтобы сократить объем работы, которую
  командам необходимо выполнить для интеграции с расширением Scaled UI Amount

## Краткое содержание

- Конечные пользователи должны взаимодействовать с UIAmount (необработанное
  количество \* множитель) для цены токена, баланса токена и количества токенов,
  где это возможно
- dApps и поставщики услуг должны использовать необработанное количество и не
  масштабированные цены для всех расчетов и преобразовывать их для пользователей
  на конечном этапе
- Исторические данные о ценах должны быть предоставлены как для
  масштабированных, так и для не масштабированных значений для упрощения
  интеграции
- Исторические значения множителей должны быть доступны для точных исторических
  данных

## Определения терминов

- Множитель: статический обновляемый множитель, используемый для вычислений UI
  Amount
- UIAmount: множитель \* необработанная сумма (также известная как:
  масштабированная сумма)
- Необработанная сумма: сумма (также известная как: немасштабированная сумма)

## Текущий баланс

### Текущая сумма для отображения

- Каждый раз, когда вы отображаете суммы для токенов, использующих расширение
  масштабированной UI суммы, для конечных пользователей вы должны использовать
  либо:
  - UIAmount/UIAmountString (**_предпочтительно_**)
  - Ручной расчет необработанной суммы \* множитель
  - Мы рекомендуем усекать это значение в зависимости от количества десятичных
    знаков у токена.
    - Пример: если у yUSD 6 десятичных знаков, и у пользователя UIAmount равен
      1.123456789, вы должны отображать "1.123456"

### Где получить эти данные:

- Для получения актуального баланса пользователя вы можете получить обновленную
  информацию о вышеуказанных суммах, вызвав либо getTokenAccountBalance, либо
  getAccountInfo
- Если вам нужно узнать UI Amount для произвольной суммы, вы можете получить
  этот расчет, вызвав функцию
  [`amountToUiAmountForMintWithoutSimulation`](https://github.com/solana-program/token-2022/blob/main/clients/js-legacy/src/actions/amountToUiAmount.ts#L164)
  (web3.js v1) или симулируя транзакцию с использованием amountToUiAmount.
  - Примечание: amountToUiAmount требует симуляции транзакции, что означает, что
    также необходим действительный плательщик комиссии с балансом. Из-за этого
    это не должно быть основным способом получения баланса.

### Обновление текущей суммы

Поскольку эмитенты могут обновлять множитель в любое время, вы можете
рассмотреть возможность периодического опроса, чтобы поддерживать актуальность
баланса аккаунта. Эмитенты вряд ли будут обновлять этот множитель чаще одного
раза в день. Если множитель установлен на будущую дату, вы можете автоматически
опрашивать в это время обновления.

## Суммы токенов в транзакциях (переводы / обмены и т. д.)

- Пользователи должны вводить суммы, которые интерпретируются как
  масштабированные "UIAmount". Приложение, которое должно обработать это, должно
  преобразовать их в необработанную сумму токенов для транзакции.
  - Если возникают проблемы с округлением, округляйте в меньшую сторону и
    предпочтите оставить небольшое количество "пыли", чтобы избежать сбоя
    транзакции.
  - Для выполнения этого преобразования вы можете использовать функцию
    [`uiAmountToAmountForMintWithoutSimulation`](https://github.com/solana-program/token-2022/blob/main/clients/js-legacy/src/actions/amountToUiAmount.ts#L312C23-L312C63)
    (web3.js v1) или симулировать транзакцию с использованием amountToUiAmount.
- Приложения должны использовать общую необработанную сумму, когда пользователь
  запрашивает выполнение действия с "максимальной" или "всей" суммой своего
  баланса. Это гарантирует, что не останется "пыли".
  - Опционально: вы можете рассмотреть возможность автоматического закрытия
    аккаунта, когда используется "максимум", чтобы вернуть пользователю его
    депозит за хранение.

## Цена токена

- Цена токена всегда должна отображаться как масштабированная цена, где это
  возможно.
- Если вы являетесь поставщиком данных о ценах, например, оракулом, вы должны
  предоставлять как масштабированную, так и немасштабированную цену.
  - По возможности предоставляйте SDK/API, который абстрагирует сложности
    расширения масштабированного UIAmount.

## Текущий множитель

- Текущий множитель можно считать из токенового минта в любое время, вызвав
  `getAccountInfo`. Кроме того, если установлен будущий множитель, эта
  информация также доступна из токенового минта. Мы рекомендуем не отображать
  этот множитель, так как это может запутать пользовательский интерфейс.

## Исторические данные

### Исторические данные для ценового фида

- Сервисы, предоставляющие исторические данные, должны хранить и **предоставлять
  как масштабированные, так и немасштабированные цены для расширения
  масштабированного UIAmount**.
- Мы ожидаем, что масштабированные суммы будут использоваться чаще всего, так
  как это соответствует тому, как традиционный финансовый мир обрабатывает
  графики, связанные с токенами с дроблением акций.

### Исторические данные по суммам

- Если вы хотите отобразить баланс, переведённый в прошлом, вам нужно иметь
  доступ к множителю для данного slot. Вы также можете сохранить UiAmount для
  переводов, обрабатывая транзакции, чтобы избежать выполнения этого расчёта в
  будущем.

## Обратная совместимость

- По умолчанию кошельки и приложения, которые не поддерживают расширение
  масштабируемой UI суммы, будут показывать правильную общую стоимость
  активности, умножая немасштабированную цену на сырую сумму.
- Однако они будут отображать немасштабированную цену, что может вызвать
  путаницу у пользователей.
- Мы надеемся, что это побудит команды обновить свои dapps для совместимости с
  токенами, использующими расширение масштабируемой UI суммы, и будем рады
  предоставить поддержку в этом процессе.

## Утилитарные функции для добавления в библиотеку SPL-Token:

- **\[Выполнено\]** Amount to UIAmount: Предоставить функцию для получения
  UIAmount на текущий момент времени, учитывая mint и сырую сумму
- **\[Выполнено\]** UIAmount to Amount: Предоставить функцию для получения сырой
  суммы на текущий момент времени, учитывая mint и UIAmount
- **\[Выполнено\]** Amount to UIAmount for: Предоставить функцию для получения
  UIAmount для заданного множителя, десятичного значения и сырой суммы
- **\[Выполнено\]** UIAmount to Amount: Предоставить функцию для получения сырой
  суммы для заданного множителя, десятичного значения и UIAmount
- **\[TODO\]** Вся вышеуказанная вспомогательная функциональность для
  @solana/kit

## Критерии приёмки по платформам

### **Общие требования**

| Требование                                  | Описание                                                                                                                                                                                                | Приоритет |
| :------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------- |
| Поддержка действий пользователей с UiAmount | Все действия пользователей должны выполняться в UiAmount, если UiAmount включён в приложении. Если UiAmount не отображается в приложении, они должны использовать сырые суммы до обновления приложения. | **P0**    |

---

### **Кошельки**

| Требование                                            | Описание                                                                                                            | Приоритет |
| :---------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------ | :-------- |
| Отображение масштабированного баланса                 | Показывать масштабированную сумму (uiAmount) в качестве основного баланса.                                          | **P0**    |
| Поддержка переводов токенов                           | Пользователи должны вводить суммы перевода с учетом их масштабированных балансов (сырая сумма \* баланс).           | **P0**    |
| Отображение спотовой цены                             | Показывать масштабированную спотовую цену для пользователей                                                         | **P0**    |
| Метаданные истории транзакций                         | Показывать масштабированную сумму (UIAmount) для каждого перевода, где это возможно.                                | **P1**    |
| Отображение обновлений множителя в истории транзакций | При обновлении множителя показывать это событие в истории транзакций пользователя, включая полученную сумму         | **P2**    |
| Отображение графика истории цен                       | Отражать масштабированные цены на графике цен                                                                       | **P1**    |
| Обучение/подсказки                                    | Предоставлять подсказки или обучение, чтобы информировать пользователей о токенах, использующих расширение uiAmount | **P2**    |

---

### **Обозреватели**

| Требование                                                      | Описание                                                                                           | Приоритет |
| :-------------------------------------------------------------- | :------------------------------------------------------------------------------------------------- | :-------- |
| Улучшения страницы деталей токенов                              | Отображать метаданные, такие как общая масштабированная рыночная капитализация и текущий множитель | **P0**    |
| Отображение масштабированного баланса для балансов              | Показывать масштабированные балансы (UiAmount) для текущих балансов.                               | **P0**    |
| Отображение масштабированного баланса для транзакций            | Показывать масштабированные балансы (UiAmount) для сумм переводов в истории транзакций.            | **P0**    |
| Отображение масштабированной цены для транзакций                | Показывать масштабированные цены для предыдущих транзакций                                         | **P1**    |
| Корректный разбор и отображение транзакций обновления множителя | Корректно показывать детали об обновлении множителя                                                | **P2**    |

---

### **Агрегаторы рыночных данных (например, CoinGecko)**

| Требование                               | Описание                                                                                                                | Приоритет |
| :--------------------------------------- | :---------------------------------------------------------------------------------------------------------------------- | :-------- |
| Обновления API для масштабируемых данных | Расширить функциональность API, чтобы включить изменения множителя со временем, а также масштабированную ценовую ленту. | **P0**    |
| Общий объем с учетом масштабирования     | При отображении общего объема и общей рыночной капитализации учитывать масштабированные балансы.                        | **P0**    |
| Отслеживание исторических цен            | Предоставить исторический график цен с использованием масштабированных цен за определенный период.                      | **P1**    |
| Отслеживание исторических множителей     | Предоставить исторические маркеры обновлений множителей для токенов с начислением процентов.                            | **P2**    |
| Образовательный контент или объяснения   | Включить краткие описания или подсказки, объясняющие, как работают масштабированные токены.                             | **P2**    |

---

### **Поставщики ценовых данных**

| Требование                                          | Описание                                                                                                   | Приоритет |
| :-------------------------------------------------- | :--------------------------------------------------------------------------------------------------------- | :-------- |
| Масштабированные и немасштабированные ценовые ленты | Предоставить ценовые ленты как для масштабированных, так и для немасштабированных цен.                     | **P0**    |
| Исторические данные множителей                      | Предоставить API с историческими изменениями множителей.                                                   | **P0**    |
| Исторические данные цен                             | Предоставить API с историческими ценами на основе как масштабированных, так и немасштабированных значений. | **P0**    |

---

### **DEXы**

| Требование                                    | Описание                                                                                                                                                           | Приоритет |
| :-------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| Отображение масштабированных балансов токенов | Отображать масштабированные балансы для торговли или предоставления ликвидности в пользовательском интерфейсе (бэкенд может использовать необработанные значения). | **P0**    |
| Поддержка действий с токенами                 | Пользователи должны вводить суммы действий, используя их UiAmount балансы (множитель \* необработанное значение).                                                  | **P0**    |
| Адаптация ценовых лент                        | Везде, где используется ценовая лента для отображения текущей цены, предоставлять масштабированную цену пользователям.                                             | **P1**    |
| Отображение графика истории цен               | Отражать масштабированные цены на графике цен.                                                                                                                     | **P1**    |
